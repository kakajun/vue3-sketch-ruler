import{d as he,r as N,c as H,l as Ee,b as Q,p as Z,x as Me,e as j,y as J,k as be,n as V,z as _,f as xe,o as D,A as Ae,m as Le,F as Pe,q as We,j as Ye,u as O,t as Oe,a as Ie,B as De,g as de,C as Ve}from"./index-CM2c5knW.js";/*!vue3-sketch-ruler v2.2.72025年2月Fri Feb 07 2025 07:23:25 GMT+0000 (Coordinated Universal Time)制作*/const Qe=e=>e<=.25?40:e<=.5?20:e<=1?10:e<=2?5:e<=4?2:1;function Fe(e,t,n,a,r,i){i?r.moveTo(e,0):r.moveTo(0,e),r.save(),i?r.translate(e+5,a*.2):r.translate(n*.1,e+32),i||r.rotate(-Math.PI/2),r.fillText(Math.round(t).toString(),4,7),r.restore(),i?r.lineTo(e,a):r.lineTo(n,e),r.stroke(),r.closePath(),r.setTransform(1,0,0,1,0,0)}function re(e,t,n,a,r,i){a.fillStyle=r.fontShadowColor,a.strokeStyle=r.longfgColor,a.save(),a.translate(e,t),i||a.rotate(-Math.PI/2),a.font="bold 12px  Aria",a.fillText(String(n),0,0),a.restore()}const qe=(e,t,n,a,r,i)=>{const{scale:d,width:m,height:u,ratio:M,palette:S,gridRatio:A,showShadowText:k}=r,{bgColor:p,fontColor:h,shadowColor:L,longfgColor:X}=S,g=i?r.canvasWidth:r.canvasHeight;e.setTransform(1,0,0,1,0,0),e.scale(M,M),e.clearRect(0,0,m,u),e.fillStyle=p,e.fillRect(0,0,m,u);const w=Qe(d)*A*10,C=w*d,T=Math.floor(t/w)*w,U=(T-t)/w*C,z=t+Math.ceil((i?m:u)/d);if(a){const y=(n-t)*d,B=a*d;if(e.fillStyle=L,i?e.fillRect(y,0,B,u):e.fillRect(0,y,m,B),k)if(i){re(y,u*.4,Math.round(n),e,S,i);const E=(n+a-t)*d;re(E,u*.4,Math.round(n+a),e,S,i)}else{re(m*.4,y,Math.round(n),e,S,i);const E=(n+a-t)*d;re(m*.4,E,Math.round(n+a),e,S,i)}}e.beginPath(),e.fillStyle=h,e.strokeStyle=X;for(let y=T,B=0;y<z;y+=w,B++){const E=U+B*C+.5;if(y-w<g&&y>g||y==g){const I=U+B*C+.5+(g-y)*d;Fe(I,g,m,u,e,i);return}y>=0&&y<=g&&(y==0?i?(e.moveTo(E,0),e.lineTo(E,u)):(e.moveTo(0,E),e.lineTo(m,E)):i?(e.moveTo(E,20),e.lineTo(E,u/1.3)):(e.moveTo(20,E),e.lineTo(m/1.3,E)),e.save(),y==0?i?e.translate(E-15,u*.01):e.translate(m*.3,E-5):i?e.translate(E-12,u*.05):e.translate(m*.05,E+12),i||e.rotate(-Math.PI/2),g-y>w/2&&(!k||a==0||Math.abs(y-n)>w/2&&Math.abs(y-(n+a))>w/2)&&e.fillText(y.toString(),4,9),e.restore())}e.stroke(),e.closePath()};function Se(e,t=100){let n=null;const a=function(...r){n!==null&&clearTimeout(n),n=setTimeout(()=>{e(...r)},t)};return a.cancel=function(){n!==null&&(clearTimeout(n),n=null)},a}function Xe(e,t){const n=N(0),a=N(0),r=N(!1),i=H(()=>({backgroundColor:e.palette.hoverBg,color:e.palette.hoverColor,[t?"top":"left"]:"-8px",[t?"left":"top"]:`${n.value+10}px`})),d=({offsetX:p,offsetY:h})=>{n.value=t?p:h},m=(p,h)=>new Promise(L=>{if(e.lockLine)return;const X=t?p.clientY:p.clientX;d(p);const g=h||a.value;let w=g;const C=U=>{let z=((t?U.clientY:U.clientX)-X)/e.scale+g,y=z;const B=(t?e.snapsObj.h:e.snapsObj.v).slice().sort((E,I)=>Math.abs(y-E)-Math.abs(y-I));B.length&&Math.abs(B[0]-z)<e.snapThreshold/e.scale&&(y=B[0],z=y),w=Math.round(z),a.value=w},T=()=>{document.removeEventListener("mousemove",C),u(w,e.index),L()};document.addEventListener("mousemove",C),document.addEventListener("mouseup",T,{once:!0})}),u=(p,h)=>{var L,X;const g=t?(L=e.lines)==null?void 0:L.h:(X=e.lines)==null?void 0:X.v,w=M(p);if(g)if(w)if(typeof h=="number")g.splice(h,1);else return;else typeof h!="number"?g.push(p):g[h]=p},M=p=>{const h=t?e.canvasHeight:e.canvasWidth;return p<0||p>h},S=H(()=>M(a.value)?"放开删除":`${t?"Y":"X"}：${a.value*e.rate}`),A=Se(()=>{r.value=!1},200),k=Se(()=>{r.value=!0},200);return{showLabel:r,startValue:a,actionStyle:i,labelContent:S,handleMouseDown:m,handleMouseenter:p=>{e.lockLine||(d(p),k(),A.cancel())},handleMouseLeave:()=>{A()}}}const Ke={key:0,class:"value"},Ze=he({__name:"ruler-line",props:{scale:{},palette:{},index:{},start:{},vertical:{type:Boolean},value:{},canvasWidth:{},canvasHeight:{},lines:{},isShowReferLine:{type:Boolean},rate:{},snapThreshold:{},snapsObj:{},lockLine:{type:Boolean}},setup(e){const t=e,n=N(!1),{actionStyle:a,handleMouseDown:r,labelContent:i,startValue:d,showLabel:m,handleMouseenter:u,handleMouseLeave:M}=Xe(t,t.vertical),S=H(()=>d.value>=t.start),A=H(()=>{const{lineType:p,lockLineColor:h,lineColor:L}=t.palette,X=t.lockLine?h:L??"black",g=t.lockLine||n.value?"none":"auto",w=t.isShowReferLine&&!t.lockLine?t.vertical?"ns-resize":"ew-resize":"default",C=t.vertical?"borderTop":"borderLeft",T=(d.value-t.start)*t.scale;return{[C]:`1px ${p} ${X}`,pointerEvents:g,cursor:w,[t.vertical?"top":"left"]:`${T}px`}});Ee(()=>{d.value=t.value??0});const k=Se(()=>{n.value=!1},1e3);return Z([()=>t.scale],()=>{n.value=!0,k()}),(p,h)=>J((D(),Q("div",{class:"line",style:V(A.value),onMouseenter:h[0]||(h[0]=de((...L)=>O(u)&&O(u)(...L),["stop"])),onMouseleave:h[1]||(h[1]=de((...L)=>O(M)&&O(M)(...L),["stop"])),onMousedown:h[2]||(h[2]=de((...L)=>O(r)&&O(r)(...L),["stop"]))},[j("div",{class:"action",style:V(O(a))},[O(m)?(D(),Q("span",Ke,Oe(O(i)),1)):Ae("",!0)],4)],36)),[[_,S.value]])}}),$e=he({__name:"index",props:{scale:{},palette:{},vertical:{type:Boolean},showShadowText:{type:Boolean},start:{},width:{},height:{},selectStart:{},selectLength:{},canvasWidth:{},canvasHeight:{},rate:{},gridRatio:{}},emits:["handleDragStart"],setup(e,{emit:t}){const n=e,a=t,r=Ie({isDragging:!1,canvasContext:null});let i=window.devicePixelRatio;const d=N(null);Ee(()=>{window.addEventListener("resize",m),u(),S(i),A(i)});const m=()=>{i=window.devicePixelRatio,S(i),A(i)},u=()=>{var p;r.canvasContext=((p=d.value)==null?void 0:p.getContext("2d"))||null},M=H(()=>({width:n.width+"px",height:n.height+"px",cursor:n.vertical?"ew-resize":"ns-resize",[n.vertical?"borderRight":"borderBottom"]:`1px solid ${n.palette.borderColor||"#eeeeef"} `}));De(()=>{window.removeEventListener("resize",m)});const S=p=>{if(d.value){d.value.width=Math.round(n.width*p),d.value.height=Math.round(n.height*p);const h=r.canvasContext;h&&(h.font=`11px -apple-system,
                "Helvetica Neue", ".SFNSText-Regular",
                "SF UI Text", Arial, "PingFang SC", "Hiragino Sans GB",
                "Microsoft YaHei", "WenQuanYi Zen Hei", sans-serif`,h.lineWidth=1,h.textBaseline="middle")}},A=p=>{const h={scale:n.scale,width:n.width,height:n.height,palette:n.palette,canvasWidth:n.canvasWidth,canvasHeight:n.canvasHeight,ratio:p,rate:n.rate,gridRatio:n.gridRatio,showShadowText:n.showShadowText};h.scale=n.scale/n.rate,h.canvasWidth=n.canvasWidth*n.rate,h.canvasHeight=n.canvasHeight*n.rate,r.canvasContext&&qe(r.canvasContext,n.start*n.rate,n.selectStart,n.selectLength,h,!n.vertical)};Z([()=>n.width,()=>n.height,()=>n.start,()=>n.palette,()=>n.selectStart,()=>n.selectLength],()=>{A(i)}),Z([()=>n.width,()=>n.height],()=>{S(i)});const k=p=>{a("handleDragStart",p)};return(p,h)=>(D(),Q("canvas",{ref_key:"canvas",ref:d,class:"ruler",style:V(M.value),onMousedown:de(k,["stop"])},null,36))}}),Ge={class:"lines"},je={key:0,class:"value"},Be=he({__name:"ruler-wrapper",props:{scale:{},thick:{},canvasWidth:{},canvasHeight:{},palette:{},vertical:{type:Boolean},width:{},height:{},start:{},startOther:{},lines:{},selectStart:{},selectLength:{},isShowReferLine:{type:Boolean},rate:{},snapThreshold:{},snapsObj:{},gridRatio:{},lockLine:{type:Boolean},showShadowText:{type:Boolean}},emits:["changeLineState"],setup(e,{emit:t}){const n=e,{showLabel:a,actionStyle:r,handleMouseenter:i,handleMouseLeave:d,handleMouseDown:m,labelContent:u,startValue:M}=Xe(n,!n.vertical),S=N(!1),A=N(!1),k=H(()=>n.vertical?"v-container":"h-container"),p=t,h=H(()=>{var g,w;return n.vertical?(g=n.lines)==null?void 0:g.h:(w=n.lines)==null?void 0:w.v}),L=H(()=>{const g=n.palette.lineType;let w=n.vertical?"left":"top",C=n.vertical?"top":"left",T=n.vertical?"borderLeft":"borderBottom";const U=(M.value-n.startOther)*n.scale+n.thick;return{[w]:U+"px",[C]:-n.thick+"px",cursor:n.vertical?"ew-resize":"ns-resize",[T]:`1px ${g} ${n.palette.lineColor}`}}),X=async g=>{const{offsetX:w,offsetY:C}=g,{scale:T,vertical:U,thick:z,startOther:y}=n;A.value=!0,S.value=!1,p("changeLineState",!1);let B=Math.round(y-z/T+(U?w:C)/T);M.value=B,await m(g,B),A.value=!1};return Z([()=>n.lockLine],()=>{S.value=n.lockLine}),(g,w)=>(D(),Q("div",{class:be(k.value)},[xe($e,Le(g.$props,{onHandleDragStart:X}),null,16),J(j("div",Ge,[(D(!0),Q(Pe,null,We(h.value,(C,T)=>(D(),Ye(Ze,Le({key:C+T,index:T,value:C>>0,ref_for:!0},g.$props),null,16,["index","value"]))),128))],512),[[_,g.isShowReferLine]]),g.isShowReferLine?J((D(),Q("div",{key:0,class:"indicator",style:V(L.value),onMouseenter:w[0]||(w[0]=(...C)=>O(i)&&O(i)(...C)),onMouseleave:w[1]||(w[1]=(...C)=>O(d)&&O(d)(...C))},[j("div",{class:"action",style:V(O(r))},[O(a)?(D(),Q("span",je,Oe(O(u)),1)):Ae("",!0)],4)],36)),[[_,A.value]]):Ae("",!0)],2))}}),Je="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAopJREFUOE/FlE9IVEEcx7+/N9ouds1Mu0QUSFZYdIgoUqQoKPBQHsKozpXE7jbTO/U8xLJvn6usBHWQ6hBFXupSkQeVbh0KJEPp0sH+eLGTsKs77xcj78m0ax0E8cHjzZv5zef3/c33xxA24KENYGJzoEEQbNNaN4Zh2OQ4znwYhr9c1/39vwrXVDo0NNS0tLR0GYB5D64BmAMwzMyvlFKz1es10Hw+f4mZ7wHYBeA9gNdENFepVOaEEM3M3OI4Thczn41gt6WUgQ3+C+r7/h0AWQD3mXnYqPA8L9nQ0HCemduIaFpKOWoAhUJhT6VSuQXgOjP3K6W8GLwKzeVyp4jonR0QBEErM48w8zFLyayUsjX+z+VyHhHdZebTSqkxM78CHRgYOKS1/ghgVErZY214RkQ7ADyRUj72ff8qgCtmXUrZGcf5vv8CwEUhxOF0Ov1pBRpla5dSdseBhUJhpznH6tIsZb1KqacW+BGArUaUXX63UuplHJTNZjuEEONSyhozfd/n6mQ1RkXZL2itz7mu+80EDA4ONi8vL/8AcM2UbikyR2BU9cSmmTU70YqKIAj2hWFo2uenlHK/BRg3Y2aeNO5GyU8S0ZbFxcUuz/NKEXAGQKPjOCcymcyX1dIi8DSAiWQyeaavr68cbSgCuBknYubnQoj+TCYzUywWE6VS6S2ADsdx2gxw1X3L7SNENMbMnwE8qK+vf5NKpRaMaeVyeW8ikfiaSqW+R7BuZr5BRMe11p2u607U9Gk8kc/ntzPzQwCmExYATDLzVBiGE0KIowAOADDf3QA+aK2VDaxRajto3K+rq+tl5nYAzQBamHmeiOYBTGmtR6ph/1Rqg9c73pz7dD1qN0TpHyNQRCUDJXrAAAAAAElFTkSuQmCC",_e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAjtJREFUOE/NlD9oFEEUxn9v9ghC0hpRUogIAUmniGAT/5Q2FrETPSNRJILg7RwimI0ox85eQFCEBGIUO1PYpFM0jSConQoBEZGgGPsgl+w+2eM2bC57SopAFqYZ3v7m+977ZoQt+GQLmGxPaBiGgYiMWWvXBHZUGoZhH3BERPYC+4F+4Keq/urt7b1RLpf/ZEBVHa9Wq0HWyg3QKIoGVPU8cA7wgK/pUtXPQJ8xZk+pVBpuNBqXUoUiEvi+P56fzTpo6+SbwHNg1lo7WzTITGEKXFlZeeB53tVCpa3CK8AFa+1cBgvD8LKIXAQOJkkyICJDeYVBEJS6u7s/qeoLa+1o+l9TqXNuBLhmjDlbqVQ+5ICjInIfOBPH8W9jzGCR5YmJiRNxHM+papgqzqDvgSlr7VTernPuO3An3c9bBt74vv+yrdaKyLDv+/1Sq9UGPc97nY9EVuycU2AQOA7cAm4Dr4D5TvVxHB9rKo2iaEFVp621Ln96FEUngaOqGmSxabVqsh3a2h+x1h5qQjNrae/yE4+iaCwDJkky73neTuBZe129Xk+H+BS4l7ZqLVIZ2BhzuFKpvMsDVXXWGPMxFdAedOfcKeCRqj7MYrUhpz09PfXl5eXrectFWXXODQHpOq2qd/95o/JXr6ura3J1dXU6SZIfwKKIHAD2tVYMPBGRx77vN10UXtO85fTkmZmZHUtLSzUR2QXsBhaAL6r6DXhbrVYXi1yss59GqOgub/bN3Z7v6X/tb9Zmp/q/kN8s+lJb8oEAAAAASUVORK5CYII=";/*!simple-panzoom v1.0.72024年8月Sat Aug 10 2024 16:04:04 GMT+0800 (中国标准时间)制作*/typeof window<"u"&&(window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach),typeof window.CustomEvent!="function"&&(window.CustomEvent=function(e,t){t=t||{bubbles:!1,cancelable:!1,detail:null};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}));function Ne(e,t){let n=e.length;for(;n--;)if(e[n].pointerId===t.pointerId)return n;return-1}function Ce(e,t){let n;if(t.touches){n=0;for(const a of t.touches)a.pointerId=n++,Ce(e,a);return}n=Ne(e,t),n>-1&&e.splice(n,1),e.push(t)}function et(e,t){if(t.touches){for(;e.length;)e.pop();return}const n=Ne(e,t);n>-1&&e.splice(n,1)}function Te(e){e=e.slice(0);let t=e.pop(),n;for(;n=e.pop();)t={clientX:(n.clientX-t.clientX)/2+t.clientX,clientY:(n.clientY-t.clientY)/2+t.clientY};return t}function ge(e){if(e.length<2)return 0;const t=e[0],n=e[1];return Math.sqrt(Math.pow(Math.abs(n.clientX-t.clientX),2)+Math.pow(Math.abs(n.clientY-t.clientY),2))}let le={down:"mousedown",move:"mousemove",up:"mouseup mouseleave"};typeof window<"u"&&(typeof window.PointerEvent=="function"?le={down:"pointerdown",move:"pointermove",up:"pointerup pointerleave pointercancel"}:typeof window.TouchEvent=="function"&&(le={down:"touchstart",move:"touchmove",up:"touchend touchcancel"}));function we(e,t,n,a){le[e].split(" ").forEach(r=>{t.addEventListener(r,n,a)})}function ye(e,t,n){le[e].split(" ").forEach(a=>{t.removeEventListener(a,n)})}const tt=typeof document<"u"&&!!document.documentMode;let Re;function nt(){return Re||(Re=document.createElement("div").style)}const ze=["webkit","moz","ms"],se={};function ke(e){if(se[e])return se[e];const t=nt();if(e in t)return se[e]=e;const n=e[0].toUpperCase()+e.slice(1);let a=ze.length;for(;a--;){const r=`${ze[a]}${n}`;if(r in t)return se[e]=r}}function ie(e,t){return parseFloat(t[ke(e)])||0}function ce(e,t,n=window.getComputedStyle(e)){const a=t==="border"?"Width":"";return{left:ie(`${t}Left${a}`,n),right:ie(`${t}Right${a}`,n),top:ie(`${t}Top${a}`,n),bottom:ie(`${t}Bottom${a}`,n)}}function G(e,t,n){e.style[ke(t)]=n}function at(e,t){const n=ke("transform");G(e,"transition",`${n} ${t.duration}ms ${t.easing}`)}function ot(e,{x:t,y:n,scale:a,isSVG:r},i){if(G(e,"transform",`scale(${a}) translate(${t}px, ${n}px)`),r&&tt){const d=window.getComputedStyle(e).getPropertyValue("transform");e.setAttribute("transform",d)}}function ue(e){const t=e.parentNode,n=window.getComputedStyle(e),a=window.getComputedStyle(t),r=e.getBoundingClientRect(),i=t.getBoundingClientRect();return{elem:{style:n,width:r.width,height:r.height,top:r.top,bottom:r.bottom,left:r.left,right:r.right,margin:ce(e,"margin",n),border:ce(e,"border",n)},parent:{style:a,width:i.width,height:i.height,top:i.top,bottom:i.bottom,left:i.left,right:i.right,padding:ce(t,"padding",a),border:ce(t,"border",a)}}}function lt(e){let t=e;for(;t&&t.parentNode;){if(t.parentNode===document)return!0;t=t.parentNode instanceof ShadowRoot?t.parentNode.host:t.parentNode}return!1}function rt(e){return(e.getAttribute("class")||"").trim()}function st(e,t){return e.nodeType===1&&` ${rt(e)} `.indexOf(` ${t} `)>-1}function it(e,t){for(let n=e;n!=null;n=n.parentNode)if(st(n,t.excludeClass)||t.exclude.indexOf(n)>-1)return!0;return!1}const ct=/^http:[\w\.\/]+svg$/;function ut(e){return ct.test(e.namespaceURI)&&e.nodeName.toLowerCase()!=="svg"}function dt(e){const t={};for(const n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}const He={animate:!1,canvas:!1,cursor:"move",disablePan:!1,disableZoom:!1,disableXAxis:!1,disableYAxis:!1,duration:200,easing:"ease-in-out",exclude:[],excludeClass:"panzoom-exclude",handleStartEvent:e=>{e.preventDefault(),e.stopPropagation()},maxScale:4,minScale:.125,overflow:"hidden",panOnlyWhenZoomed:!1,pinchAndPan:!1,relative:!1,setTransform:ot,startX:0,startY:0,startScale:1,step:.3,touchAction:"none"};function Ue(e,t){if(!e)throw new Error("Panzoom requires an element as an argument");if(e.nodeType!==1)throw new Error("Panzoom requires an element with a nodeType of 1");if(!lt(e))throw new Error("Panzoom should be called on elements that have been attached to the DOM");t={...He,...t};const n=ut(e),a=e.parentNode;a.style.overflow=t.overflow,a.style.userSelect="none",a.style.touchAction=t.touchAction,(t.canvas?a:e).style.cursor=t.cursor,e.style.userSelect="none",e.style.touchAction=t.touchAction,G(e,"transformOrigin",typeof t.origin=="string"?t.origin:n?"0 0":"50% 50%");function r(){a.style.overflow="",a.style.userSelect="",a.style.touchAction="",a.style.cursor="",e.style.cursor="",e.style.userSelect="",e.style.touchAction="",G(e,"transformOrigin","")}function i(o={}){for(const c in o)o.hasOwnProperty(c)&&(t[c]=o[c]);(o.hasOwnProperty("cursor")||o.hasOwnProperty("canvas"))&&(a.style.cursor=e.style.cursor="",(t.canvas?a:e).style.cursor=t.cursor),o.hasOwnProperty("overflow")&&(a.style.overflow=o.overflow),o.hasOwnProperty("touchAction")&&(a.style.touchAction=o.touchAction,e.style.touchAction=o.touchAction)}let d=0,m=0,u=1,M=!1;L(t.startScale,{animate:!1,force:!0}),setTimeout(()=>{h(t.startX,t.startY,{animate:!1,force:!0})});function S(o,c,v){if(v.silent)return;const x=new CustomEvent(o,{detail:c});e.dispatchEvent(x)}function A(o,c,v){const x={x:d,y:m,scale:u,isSVG:n,originalEvent:v,dimsOut:{}};typeof c.animate=="boolean"&&(c.animate?at(e,c):G(e,"transition","none")),c.setTransform(e,x,c);function s(){const b=ue(e);x.dimsOut=b,S(o,x,c),S("panzoomchange",x,c)}return c.animate?setTimeout(()=>{s()},c.duration+50):requestAnimationFrame(()=>{s()}),x}function k(o,c,v,x){const s={...t,...x},b={x:d,y:m,opts:s};if(!s.force&&(s.disablePan||s.panOnlyWhenZoomed&&u===s.startScale))return b;if(o=parseFloat(o),c=parseFloat(c),s.disableXAxis||(b.x=(s.relative?d:0)+o),s.disableYAxis||(b.y=(s.relative?m:0)+c),s.contain){const f=ue(e),Y=f.elem.width/u,W=f.elem.height/u,ae=Y*v,oe=W*v,q=(ae-Y)/2,K=(oe-W)/2;if(s.contain==="inside"){const pe=(-f.elem.margin.left-f.parent.padding.left+q)/v,fe=(f.parent.width-ae-f.parent.padding.left-f.elem.margin.left-f.parent.border.left-f.parent.border.right+q)/v;b.x=Math.max(Math.min(b.x,fe),pe);const ve=(-f.elem.margin.top-f.parent.padding.top+K)/v,me=(f.parent.height-oe-f.parent.padding.top-f.elem.margin.top-f.parent.border.top-f.parent.border.bottom+K)/v;b.y=Math.max(Math.min(b.y,me),ve)}else if(s.contain==="outside"){const pe=(-(ae-f.parent.width)-f.parent.padding.left-f.parent.border.left-f.parent.border.right+q)/v,fe=(q-f.parent.padding.left)/v;b.x=Math.max(Math.min(b.x,fe),pe);const ve=(-(oe-f.parent.height)-f.parent.padding.top-f.parent.border.top-f.parent.border.bottom+K)/v,me=(K-f.parent.padding.top)/v;b.y=Math.max(Math.min(b.y,me),ve)}}return s.roundPixels&&(b.x=Math.round(b.x),b.y=Math.round(b.y)),b}function p(o,c){const v={...t,...c},x={scale:u,opts:v};if(!v.force&&v.disableZoom)return x;let s=t.minScale,b=t.maxScale;if(v.contain){const f=ue(e),Y=f.elem.width/u,W=f.elem.height/u;if(Y>1&&W>1){const ae=f.parent.width-f.parent.border.left-f.parent.border.right,oe=f.parent.height-f.parent.border.top-f.parent.border.bottom,q=ae/Y,K=oe/W;t.contain==="inside"?b=Math.min(b,q,K):t.contain==="outside"&&(s=Math.max(s,q,K))}}return x.scale=Math.min(Math.max(o,s),b),x}function h(o,c,v,x){const s=k(o,c,u,v);return d!==s.x||m!==s.y?(d=s.x,m=s.y,A("panzoompan",s.opts,x)):{x:d,y:m,scale:u,isSVG:n,originalEvent:x}}function L(o,c,v){const x=p(o,c),s=x.opts;if(!s.force&&s.disableZoom)return;o=x.scale;let b=d,f=m;if(s.focal){const W=s.focal;b=(W.x/o-W.x/u+d*o)/o,f=(W.y/o-W.y/u+m*o)/o}const Y=k(b,f,o,{relative:!1,force:!0});return d=Y.x,m=Y.y,u=o,A("panzoomzoom",s,v)}function X(o,c){const v={...t,animate:!0,...c};return L(u*Math.exp((o?1:-1)*v.step),v)}function g(o){return X(!0,o)}function w(o){return X(!1,o)}function C(o,c,v,x){const s=ue(e),b={width:s.parent.width-s.parent.padding.left-s.parent.padding.right-s.parent.border.left-s.parent.border.right,height:s.parent.height-s.parent.padding.top-s.parent.padding.bottom-s.parent.border.top-s.parent.border.bottom};let f=c.clientX-s.parent.left-s.parent.padding.left-s.parent.border.left-s.elem.margin.left,Y=c.clientY-s.parent.top-s.parent.padding.top-s.parent.border.top-s.elem.margin.top;n||(f-=s.elem.width/u/2,Y-=s.elem.height/u/2);const W={x:f/b.width*(b.width*o),y:Y/b.height*(b.height*o)};return L(o,{...v,animate:!1,focal:W},x)}function T(o,c){o.preventDefault();const v={...t,...c,animate:!1},x=(o.deltaY===0&&o.deltaX?o.deltaX:o.deltaY)<0?1:-1,s=p(u*Math.exp(x*v.step/3),v).scale;return C(s,o,v,o)}function U(o){const c={...t,animate:!0,force:!0,...o};u=p(c.startScale,c).scale;const v=k(c.startX,c.startY,u,c);return d=v.x,m=v.y,A("panzoomreset",c)}let z,y,B,E,I,F;const P=[];function ee(o){if(it(o.target,t))return;Ce(P,o),M=!0,t.handleStartEvent(o),z=d,y=m,S("panzoomstart",{x:d,y:m,scale:u,isSVG:n,originalEvent:o},t);const c=Te(P);B=c.clientX,E=c.clientY,I=u,F=ge(P)}function te(o){if(!M||z===void 0||y===void 0||B===void 0||E===void 0)return;Ce(P,o);const c=Te(P),v=P.length>1;let x=u;if(v){F===0&&(F=ge(P));const s=ge(P)-F;x=p(s*t.step/80+I).scale,C(x,c,{animate:!1},o)}(!v||t.pinchAndPan)&&h(z+(c.clientX-B)/x,y+(c.clientY-E)/x,{animate:!1},o)}function $(o){P.length===1&&S("panzoomend",{x:d,y:m,scale:u,isSVG:n,originalEvent:o},t),et(P,o),M&&(M=!1,z=y=B=E=void 0)}let ne=!1;function l(){ne||(ne=!0,we("down",t.canvas?a:e,ee),we("move",document,te,{passive:!0}),we("up",document,$,{passive:!0}))}function R(){ne=!1,ye("down",t.canvas?a:e,ee),ye("move",document,te),ye("up",document,$)}return t.noBind||l(),{bind:l,destroy:R,eventNames:le,getPan:()=>({x:d,y:m}),getScale:()=>u,getOptions:()=>dt(t),handleDown:ee,handleMove:te,handleUp:$,pan:h,reset:U,resetStyle:r,setOptions:i,setStyle:(o,c)=>G(e,o,c),zoom:L,zoomIn:g,zoomOut:w,zoomToPoint:C,zoomWithWheel:T}}Ue.defaultOptions=He;const ht={class:"sketch-ruler"},ft=he({__name:"index",props:{showRuler:{type:Boolean,default:!0},eyeIcon:{},closeEyeIcon:{},scale:{default:1},rate:{default:1},thick:{default:16},palette:{},width:{default:1400},height:{default:800},paddingRatio:{default:.2},autoCenter:{type:Boolean,default:!0},shadow:{default:()=>({x:0,y:0,width:0,height:0})},lines:{default:()=>({h:[],v:[]})},isShowReferLine:{type:Boolean,default:!0},canvasWidth:{default:700},canvasHeight:{default:700},snapsObj:{default:()=>({h:[],v:[]})},snapThreshold:{default:5},gridRatio:{default:1},lockLine:{type:Boolean,default:!1},selfHandle:{type:Boolean,default:!1},showShadowText:{type:Boolean,default:!0},panzoomOption:{}},emits:["onCornerClick","update:scale","zoomchange","update:lockLine"],setup(e,{expose:t,emit:n}){Ve(l=>({"2e1e919e":ne.value}));const a=e,r=n,i=N(null),d=N(0),m=N(0);let u=0,M=0;const S=N(1),A=N(a.isShowReferLine),k=N(null),p=N("defaultCursor"),h=H(()=>({bgColor:"#f6f7f9",longfgColor:"#BABBBC",fontColor:"#7D8694",fontShadowColor:"#106ebe",shadowColor:"#e9f7fe",lineColor:"#51d6a9",lineType:"solid",lockLineColor:"#d4d7dc",hoverBg:"#000",hoverColor:"#fff",borderColor:"#eeeeef",...a.palette})),L=H(()=>({backgroundImage:A.value?`url(${a.eyeIcon??Je})`:`url(${a.closeEyeIcon??_e})`,width:a.thick+"px",height:a.thick+"px",borderRight:`1px solid ${h.value.borderColor}`,borderBottom:`1px solid ${h.value.borderColor}`})),X=H(()=>({background:h.value.bgColor,width:g.value+"px",height:w.value+"px"})),g=H(()=>a.width-a.thick),w=H(()=>a.height-a.thick),C=l=>{var R;(l.ctrlKey||l.metaKey)&&((R=k.value)==null||R.zoomWithWheel(l))},T=l=>{var R;const o=document.activeElement;o!=null&&o.closest(".monaco-editor")||(o==null?void 0:o.tagName)==="INPUT"||(o==null?void 0:o.tagName)==="TEXTAREA"||(o==null?void 0:o.getAttribute("contenteditable"))==="true"||l.key===" "&&(p.value="grabCursor",(R=k.value)==null||R.bind(),l.preventDefault())},U=l=>{var R;const o=document.activeElement;o!=null&&o.closest(".monaco-editor")||(o==null?void 0:o.tagName)==="INPUT"||(o==null?void 0:o.tagName)==="TEXTAREA"||(o==null?void 0:o.getAttribute("contenteditable"))==="true"||l.key===" "&&((R=k.value)==null||R.destroy(),p.value="defaultCursor")};Ee(()=>{if(B(),!a.selfHandle&&i.value){const l=i.value.parentElement;if(!l)return;l.addEventListener("wheel",C),document.addEventListener("keydown",T),document.addEventListener("keyup",U)}});const z=l=>({noBind:!0,startScale:l,startX:u,startY:M,smoothScroll:!0,canvas:!0,...a.panzoomOption}),y=l=>{const{scale:R,dimsOut:o}=l.detail;if(o){r("update:scale",R),S.value=R;const c=(o.parent.left-o.elem.left)/R,v=(o.parent.top-o.elem.top)/R;d.value=c,r("zoomchange",l.detail),m.value=v}},B=()=>{if(i.value=document.querySelector(".canvasedit"),i.value){let l=a.scale;a.autoCenter&&(l=E()),k.value=Ue(i.value,z(l)),i.value&&i.value.addEventListener("panzoomchange",y)}},E=()=>{const l=g.value*(1-a.paddingRatio)/a.canvasWidth,R=w.value*(1-a.paddingRatio)/a.canvasHeight,o=Math.min(l,R);return u=g.value/2-a.canvasWidth/2,o<1?M=(a.canvasHeight*o/2-a.canvasHeight/2)/o-(a.canvasHeight*o-w.value)/o/2:o>1?M=(a.canvasHeight*o-a.canvasHeight)/2/o+(w.value-a.canvasHeight*o)/o/2:M=0,o},I=()=>{var l;return(l=k.value)==null?void 0:l.reset()},F=()=>{var l;return(l=k.value)==null?void 0:l.zoomIn()},P=()=>{var l;return(l=k.value)==null?void 0:l.zoomOut()},ee=()=>{var l;(l=k.value)==null||l.setOptions(z(a.scale))},te=()=>{A.value=!A.value,r("onCornerClick",A.value)},$=l=>{r("update:lockLine",l)},ne=H(()=>a.thick+"px");return Z([()=>a.isShowReferLine],()=>{A.value=a.isShowReferLine}),Z([()=>a.canvasWidth,()=>a.canvasHeight,()=>a.width,()=>a.height],()=>{B()}),Z(()=>a.panzoomOption,()=>{ee()},{deep:!0}),t({initPanzoom:B,panzoomInstance:k,reset:I,zoomIn:F,zoomOut:P,cursorClass:p}),(l,R)=>(D(),Q("div",ht,[Me(l.$slots,"btn",{reset:I,zoomIn:F,zoomOut:P}),j("div",{class:be(["canvasedit-parent",p.value]),style:V(X.value)},[j("div",{class:be(["canvasedit",p.value])},[Me(l.$slots,"default")],2)],6),J(xe(Be,{style:V({marginLeft:l.thick+"px",width:g.value+"px"}),vertical:!1,width:l.width,height:l.thick,"is-show-refer-line":A.value,thick:l.thick,start:d.value,"start-other":m.value,lines:l.lines,"select-start":l.shadow.x,"snap-threshold":l.snapThreshold,"snaps-obj":l.snapsObj,"select-length":l.shadow.width,scale:S.value,palette:h.value,"canvas-width":l.canvasWidth,"show-shadow-text":l.showShadowText,"canvas-height":l.canvasHeight,rate:l.rate,"grid-ratio":l.gridRatio,"lock-line":l.lockLine,onChangeLineState:$},null,8,["style","width","height","is-show-refer-line","thick","start","start-other","lines","select-start","snap-threshold","snaps-obj","select-length","scale","palette","canvas-width","show-shadow-text","canvas-height","rate","grid-ratio","lock-line"]),[[_,l.showRuler]]),J(xe(Be,{style:V({marginTop:l.thick+"px",top:0,height:w.value+"px"}),vertical:!0,width:l.thick,height:l.height,"is-show-refer-line":A.value,thick:l.thick,start:m.value,"start-other":d.value,lines:l.lines,"select-start":l.shadow.y,"select-length":l.shadow.height,"snap-threshold":l.snapThreshold,"snaps-obj":l.snapsObj,scale:S.value,palette:h.value,"canvas-width":l.canvasWidth,"canvas-height":l.canvasHeight,"show-shadow-text":l.showShadowText,rate:l.rate,"grid-ratio":l.gridRatio,"lock-line":l.lockLine,onChangeLineState:$},null,8,["style","width","height","is-show-refer-line","thick","start","start-other","lines","select-start","select-length","snap-threshold","snaps-obj","scale","palette","canvas-width","canvas-height","show-shadow-text","rate","grid-ratio","lock-line"]),[[_,l.showRuler]]),J(j("a",{class:"corner",style:V(L.value),onClick:te},null,4),[[_,l.showRuler]])]))}});export{ft as p};
