import{d as re,r as O,c as N,p as we,G as Ee,b as I,q as K,x as ye,e as Z,H as j,k as ve,n as P,I as $,f as fe,o as W,y as ge,m as be,F as Oe,s as Xe,u as X,t as ke,a as He,g as se,j as Ne,J as Ue}from"./index-UPowV2kH.js";const Ye=e=>e<=.25?40:e<=.5?20:e<=1?10:e<=2?5:e<=4?2:1;function We(e,a,t,o,i,s){s?i.moveTo(e,0):i.moveTo(0,e),i.save(),s?i.translate(e+5,o*.2):i.translate(t*.1,e+32),s||i.rotate(-Math.PI/2),i.fillText(Math.round(a).toString(),4,7),i.restore(),s?i.lineTo(e,o):i.lineTo(t,e),i.stroke(),i.closePath(),i.setTransform(1,0,0,1,0,0)}function ae(e,a,t,o,i,s){o.fillStyle=i.fontShadowColor,o.strokeStyle=i.longfgColor,o.save(),o.translate(e,a),s||o.rotate(-Math.PI/2),o.font="bold 12px  Aria",o.fillText(String(t),0,0),o.restore()}const Pe=(e,a,t,o,i,s)=>{const{scale:h,width:u,height:m,ratio:L,palette:S,gridRatio:C,showShadowText:T}=i,{bgColor:v,fontColor:c,shadowColor:y,longfgColor:R}=S,x=s?i.canvasWidth:i.canvasHeight;e.setTransform(1,0,0,1,0,0),e.scale(L,L),e.clearRect(0,0,u,m),e.fillStyle=v,e.fillRect(0,0,u,m);const w=Ye(h)*C*10,A=w*h,E=Math.floor(a/w)*w,M=(E-a)/w*A,z=a+Math.ceil((s?u:m)/h);if(o){const g=(t-a)*h,k=o*h;if(e.fillStyle=y,s?e.fillRect(g,0,k,m):e.fillRect(0,g,u,k),T)if(s){ae(g,m*.4,Math.round(t),e,S,s);const b=(t+o-a)*h;ae(b,m*.4,Math.round(t+o),e,S,s)}else{ae(u*.4,g,Math.round(t),e,S,s);const b=(t+o-a)*h;ae(u*.4,b,Math.round(t+o),e,S,s)}}e.beginPath(),e.fillStyle=c,e.strokeStyle=R;for(let g=E,k=0;g<z;g+=w,k++){const b=M+k*A+.5;if(g-w<x&&g>x||g==x){const Y=M+k*A+.5+(x-g)*h;We(Y,x,u,m,e,s);return}g>=0&&g<=x&&(g==0?s?(e.moveTo(b,0),e.lineTo(b,m)):(e.moveTo(0,b),e.lineTo(u,b)):s?(e.moveTo(b,20),e.lineTo(b,m/1.3)):(e.moveTo(20,b),e.lineTo(u/1.3,b)),e.save(),g==0?s?e.translate(b-15,m*.01):e.translate(u*.3,b-5):s?e.translate(b-12,m*.05):e.translate(u*.05,b+12),s||e.rotate(-Math.PI/2),x-g>w/2&&(!T||o==0||Math.abs(g-t)>w/2&&Math.abs(g-(t+o))>w/2)&&e.fillText(g.toString(),4,9),e.restore())}e.stroke(),e.closePath()};function me(e,a=100){let t=null;const o=function(...i){t!==null&&clearTimeout(t),t=setTimeout(()=>{e(...i)},a)};return o.cancel=function(){t!==null&&(clearTimeout(t),t=null)},o}function Le(e,a){const t=O(0),o=O(0),i=O(!1),s=N(()=>({backgroundColor:e.palette.hoverBg,color:e.palette.hoverColor,[a?"top":"left"]:"-8px",[a?"left":"top"]:`${t.value+10}px`})),h=({offsetX:v,offsetY:c})=>{t.value=a?v:c},u=(v,c)=>new Promise(y=>{if(e.lockLine)return;const R=a?v.clientY:v.clientX;h(v);const x=c||o.value;let w=x;const A=M=>{let z=((a?M.clientY:M.clientX)-R)/e.scale+x,g=z;const k=(a?e.snapsObj.h:e.snapsObj.v).slice().sort((b,Y)=>Math.abs(g-b)-Math.abs(g-Y));k.length&&Math.abs(k[0]-z)<e.snapThreshold/e.scale&&(g=k[0],z=g),w=Math.round(z),o.value=w},E=()=>{document.removeEventListener("mousemove",A),m(w,e.index),y()};document.addEventListener("mousemove",A),document.addEventListener("mouseup",E,{once:!0})}),m=(v,c)=>{const y=a?e.lines?.h:e.lines?.v,R=L(v);if(y)if(R)if(typeof c=="number")y.splice(c,1);else return;else typeof c!="number"?y.push(v):y[c]=v},L=v=>{const c=a?e.canvasHeight:e.canvasWidth;return v<0||v>c},S=N(()=>L(o.value)?"放开删除":`${a?"Y":"X"}：${o.value*e.rate}`),C=me(()=>{i.value=!1},200),T=me(()=>{i.value=!0},200);return{showLabel:i,startValue:o,actionStyle:s,labelContent:S,handleMouseDown:u,handleMouseenter:v=>{e.lockLine||(h(v),T(),C.cancel())},handleMouseLeave:()=>{C()}}}const Ie={key:0,class:"value"},De=re({__name:"ruler-line",props:{scale:{},palette:{},index:{},start:{},vertical:{type:Boolean},value:{},canvasWidth:{},canvasHeight:{},lines:{},isShowReferLine:{type:Boolean},rate:{},snapThreshold:{},snapsObj:{},lockLine:{type:Boolean}},setup(e){const a=e,t=O(!1),{actionStyle:o,handleMouseDown:i,labelContent:s,startValue:h,showLabel:u,handleMouseenter:m,handleMouseLeave:L}=Le(a,a.vertical),S=N(()=>h.value>=a.start),C=N(()=>{const{lineType:v,lockLineColor:c,lineColor:y}=a.palette,R=a.lockLine?c:y??"black",x=a.lockLine||t.value?"none":"auto",w=a.isShowReferLine&&!a.lockLine?a.vertical?"ns-resize":"ew-resize":"default",A=a.vertical?"borderTop":"borderLeft",E=(h.value-a.start)*a.scale;return{[A]:`1px ${v} ${R}`,pointerEvents:x,cursor:w,[a.vertical?"top":"left"]:`${E}px`}});we(()=>{h.value=a.value??0});const T=me(()=>{t.value=!1},1e3);return K([()=>a.scale],()=>{t.value=!0,T()}),(v,c)=>j((W(),I("div",{class:"line",style:P(C.value),onMouseenter:c[0]||(c[0]=se((...y)=>X(m)&&X(m)(...y),["stop"])),onMouseleave:c[1]||(c[1]=se((...y)=>X(L)&&X(L)(...y),["stop"])),onMousedown:c[2]||(c[2]=se((...y)=>X(i)&&X(i)(...y),["stop"]))},[Z("div",{class:"action",style:P(X(o))},[X(u)?(W(),I("span",Ie,ke(X(s)),1)):ge("",!0)],4)],36)),[[$,S.value]])}}),Fe=re({__name:"index",props:{scale:{},palette:{},vertical:{type:Boolean},showShadowText:{type:Boolean},start:{},width:{},height:{},selectStart:{},selectLength:{},canvasWidth:{},canvasHeight:{},rate:{},gridRatio:{}},emits:["handleDragStart"],setup(e,{emit:a}){const t=e,o=a,i=He({isDragging:!1,canvasContext:null});let s=window.devicePixelRatio;const h=O(null);we(()=>{window.addEventListener("resize",u),m(),S(s),C(s)});const u=()=>{s=window.devicePixelRatio,S(s),C(s)},m=()=>{i.canvasContext=h.value?.getContext("2d")||null},L=N(()=>({width:t.width+"px",height:t.height+"px",cursor:t.vertical?"ew-resize":"ns-resize",[t.vertical?"borderRight":"borderBottom"]:`1px solid ${t.palette.borderColor||"#eeeeef"} `}));Ee(()=>{window.removeEventListener("resize",u)});const S=v=>{if(h.value){h.value.width=Math.round(t.width*v),h.value.height=Math.round(t.height*v);const c=i.canvasContext;c&&(c.font=`11px -apple-system,
                "Helvetica Neue", ".SFNSText-Regular",
                "SF UI Text", Arial, "PingFang SC", "Hiragino Sans GB",
                "Microsoft YaHei", "WenQuanYi Zen Hei", sans-serif`,c.lineWidth=1,c.textBaseline="middle")}},C=v=>{const c={scale:t.scale,width:t.width,height:t.height,palette:t.palette,canvasWidth:t.canvasWidth,canvasHeight:t.canvasHeight,ratio:v,rate:t.rate,gridRatio:t.gridRatio,showShadowText:t.showShadowText};c.scale=t.scale/t.rate,c.canvasWidth=t.canvasWidth*t.rate,c.canvasHeight=t.canvasHeight*t.rate,i.canvasContext&&Pe(i.canvasContext,t.start*t.rate,t.selectStart,t.selectLength,c,!t.vertical)};K([()=>t.width,()=>t.height,()=>t.start,()=>t.palette,()=>t.selectStart,()=>t.selectLength],()=>{C(s)}),K([()=>t.width,()=>t.height],()=>{S(s)});const T=v=>{o("handleDragStart",v)};return(v,c)=>(W(),I("canvas",{ref_key:"canvas",ref:h,class:"ruler",style:P(L.value),onMousedown:se(T,["stop"])},null,36))}}),Qe={class:"lines"},Ke={key:0,class:"value"},Ae=re({__name:"ruler-wrapper",props:{scale:{},thick:{},canvasWidth:{},canvasHeight:{},palette:{},vertical:{type:Boolean},width:{},height:{},start:{},startOther:{},lines:{},selectStart:{},selectLength:{},isShowReferLine:{type:Boolean},rate:{},snapThreshold:{},snapsObj:{},gridRatio:{},lockLine:{type:Boolean},showShadowText:{type:Boolean}},emits:["changeLineState"],setup(e,{emit:a}){const t=e,{showLabel:o,actionStyle:i,handleMouseenter:s,handleMouseLeave:h,handleMouseDown:u,labelContent:m,startValue:L}=Le(t,!t.vertical),S=O(!1),C=O(!1),T=N(()=>t.vertical?"v-container":"h-container"),v=a,c=N(()=>t.vertical?t.lines?.h:t.lines?.v),y=N(()=>{const x=t.palette.lineType;let w=t.vertical?"left":"top",A=t.vertical?"top":"left",E=t.vertical?"borderLeft":"borderBottom";const M=(L.value-t.startOther)*t.scale+t.thick;return{[w]:M+"px",[A]:-t.thick+"px",cursor:t.vertical?"ew-resize":"ns-resize",[E]:`1px ${x} ${t.palette.lineColor}`}}),R=async x=>{const{offsetX:w,offsetY:A}=x,{scale:E,vertical:M,thick:z,startOther:g}=t;if(!S.value){C.value=!0,v("changeLineState",!1);let k=Math.round(g-z/E+(M?w:A)/E);L.value=k,await u(x,k),C.value=!1}};return K([()=>t.lockLine],()=>{S.value=t.lockLine}),(x,w)=>(W(),I("div",{class:ve(T.value)},[fe(Fe,be(x.$props,{onHandleDragStart:R}),null,16),j(Z("div",Qe,[(W(!0),I(Oe,null,Xe(c.value,(A,E)=>(W(),Ne(De,be({key:A+E,index:E,value:A>>0},{ref_for:!0},x.$props),null,16,["index","value"]))),128))],512),[[$,e.isShowReferLine]]),e.isShowReferLine?j((W(),I("div",{key:0,class:"indicator",style:P(y.value),onMouseenter:w[0]||(w[0]=(...A)=>X(s)&&X(s)(...A)),onMouseleave:w[1]||(w[1]=(...A)=>X(h)&&X(h)(...A))},[Z("div",{class:"action",style:P(X(i))},[X(o)?(W(),I("span",Ke,ke(X(m)),1)):ge("",!0)],4)],36)),[[$,C.value]]):ge("",!0)],2))}}),Ve="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAopJREFUOE/FlE9IVEEcx7+/N9ouds1Mu0QUSFZYdIgoUqQoKPBQHsKozpXE7jbTO/U8xLJvn6usBHWQ6hBFXupSkQeVbh0KJEPp0sH+eLGTsKs77xcj78m0ax0E8cHjzZv5zef3/c33xxA24KENYGJzoEEQbNNaN4Zh2OQ4znwYhr9c1/39vwrXVDo0NNS0tLR0GYB5D64BmAMwzMyvlFKz1es10Hw+f4mZ7wHYBeA9gNdENFepVOaEEM3M3OI4Thczn41gt6WUgQ3+C+r7/h0AWQD3mXnYqPA8L9nQ0HCemduIaFpKOWoAhUJhT6VSuQXgOjP3K6W8GLwKzeVyp4jonR0QBEErM48w8zFLyayUsjX+z+VyHhHdZebTSqkxM78CHRgYOKS1/ghgVErZY214RkQ7ADyRUj72ff8qgCtmXUrZGcf5vv8CwEUhxOF0Ov1pBRpla5dSdseBhUJhpznH6tIsZb1KqacW+BGArUaUXX63UuplHJTNZjuEEONSyhozfd/n6mQ1RkXZL2itz7mu+80EDA4ONi8vL/8AcM2UbikyR2BU9cSmmTU70YqKIAj2hWFo2uenlHK/BRg3Y2aeNO5GyU8S0ZbFxcUuz/NKEXAGQKPjOCcymcyX1dIi8DSAiWQyeaavr68cbSgCuBknYubnQoj+TCYzUywWE6VS6S2ADsdx2gxw1X3L7SNENMbMnwE8qK+vf5NKpRaMaeVyeW8ikfiaSqW+R7BuZr5BRMe11p2u607U9Gk8kc/ntzPzQwCmExYATDLzVBiGE0KIowAOADDf3QA+aK2VDaxRajto3K+rq+tl5nYAzQBamHmeiOYBTGmtR6ph/1Rqg9c73pz7dD1qN0TpHyNQRCUDJXrAAAAAAElFTkSuQmCC",qe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAjtJREFUOE/NlD9oFEEUxn9v9ghC0hpRUogIAUmniGAT/5Q2FrETPSNRJILg7RwimI0ox85eQFCEBGIUO1PYpFM0jSConQoBEZGgGPsgl+w+2eM2bC57SopAFqYZ3v7m+977ZoQt+GQLmGxPaBiGgYiMWWvXBHZUGoZhH3BERPYC+4F+4Keq/urt7b1RLpf/ZEBVHa9Wq0HWyg3QKIoGVPU8cA7wgK/pUtXPQJ8xZk+pVBpuNBqXUoUiEvi+P56fzTpo6+SbwHNg1lo7WzTITGEKXFlZeeB53tVCpa3CK8AFa+1cBgvD8LKIXAQOJkkyICJDeYVBEJS6u7s/qeoLa+1o+l9TqXNuBLhmjDlbqVQ+5ICjInIfOBPH8W9jzGCR5YmJiRNxHM+papgqzqDvgSlr7VTernPuO3An3c9bBt74vv+yrdaKyLDv+/1Sq9UGPc97nY9EVuycU2AQOA7cAm4Dr4D5TvVxHB9rKo2iaEFVp621Ln96FEUngaOqGmSxabVqsh3a2h+x1h5qQjNrae/yE4+iaCwDJkky73neTuBZe129Xk+H+BS4l7ZqLVIZ2BhzuFKpvMsDVXXWGPMxFdAedOfcKeCRqj7MYrUhpz09PfXl5eXrectFWXXODQHpOq2qd/95o/JXr6ura3J1dXU6SZIfwKKIHAD2tVYMPBGRx77vN10UXtO85fTkmZmZHUtLSzUR2QXsBhaAL6r6DXhbrVYXi1yss59GqOgub/bN3Z7v6X/tb9Zmp/q/kN8s+lJb8oEAAAAASUVORK5CYII=";function Be(e,a){let t=e.length;for(;t--;)if(e[t].pointerId===a.pointerId)return t;return-1}function xe(e,a){const t=Be(e,a);t>-1&&e.splice(t,1),e.push(a)}function Ze(e,a){const t=Be(e,a);t>-1&&e.splice(t,1)}function Se(e){const a=e.slice(0);let t=a.pop(),o;for(;o=a.pop();)t={clientX:(o.clientX-t.clientX)/2+t.clientX,clientY:(o.clientY-t.clientY)/2+t.clientY};return t}var Te={down:"pointerdown",move:"pointermove",up:"pointerup pointerleave pointercancel"};function de(e,a,t,o){Te[e].split(" ").forEach(i=>{a.addEventListener(i,t,o)})}function pe(e,a,t){Te[e].split(" ").forEach(o=>{a.removeEventListener(o,t)})}var Ce=["webkit","moz","ms"],oe={};function je(){return document.createElement("div").style}function Re(e){if(oe[e])return oe[e];const a=je();if(e in a)return oe[e]=e;const t=e[0].toUpperCase()+e.slice(1);for(let o=Ce.length-1;o>=0;o--){const i=`${Ce[o]}${t}`;if(i in a)return oe[e]=i}return e}function q(e,a,t){e.style[Re(a)]=t}function $e(e,a){const t=Re("transform");q(e,"transition",`${t} ${a.duration}ms ${a.easing}`)}function Ge(e,{x:a,y:t,scale:o},i){q(e,"transform",`scale(${o}) translate(${a}px, ${t}px)`)}function ne(e,a,t=window.getComputedStyle(e)){const o=a==="border"?"Width":"";return{left:parseFloat(t[`${a}Left${o}`])||0,right:parseFloat(t[`${a}Right${o}`])||0,top:parseFloat(t[`${a}Top${o}`])||0,bottom:parseFloat(t[`${a}Bottom${o}`])||0}}function Je(e){const a=e.parentNode,t=e.getBoundingClientRect(),o=a.getBoundingClientRect();return{elem:{width:t.width,height:t.height,left:t.left,top:t.top},parent:{width:o.width,height:o.height,left:o.left,top:o.top}}}function le(e){const a=e.parentNode,t=window.getComputedStyle(e),o=window.getComputedStyle(a),i=e.getBoundingClientRect(),s=a.getBoundingClientRect();return{elem:{width:i.width,height:i.height,left:i.left,top:i.top,margin:ne(e,"margin",t),border:ne(e,"border",t)},parent:{width:s.width,height:s.height,left:s.left,top:s.top,padding:ne(a,"padding",o),border:ne(a,"border",o)}}}function _e(e){let a=e;for(;a&&a.parentNode;){if(a.parentNode===document)return!0;a=a.parentNode instanceof ShadowRoot?a.parentNode.host:a.parentNode}return!1}function et(e){const a={};for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(a[t]=e[t]);return a}var Me={animate:!1,canvas:!1,cursor:"move",disablePan:!1,disableZoom:!1,duration:200,easing:"ease-in-out",handleStartEvent:e=>{e.preventDefault(),e.stopPropagation()},maxScale:4,minScale:.125,overflow:"hidden",setTransform:Ge,startX:0,startY:0,startScale:1,step:.3,touchAction:"none",origin:"50% 50%"};function ze(e,a){if(!e||e.nodeType!==1)throw new Error("Panzoom requires an element");if(!_e(e))throw new Error("Panzoom should be called on attached elements");a={...Me,...a};const t=e.parentNode;t.style.overflow=a.overflow,t.style.userSelect="none",t.style.touchAction=a.touchAction,(a.canvas?t:e).style.cursor=a.cursor,e.style.userSelect="none",e.style.touchAction=a.touchAction,q(e,"transformOrigin",typeof a.origin=="string"?a.origin:"50% 50%");function o(){t.style.overflow="",t.style.userSelect="",t.style.touchAction="",t.style.cursor="",e.style.cursor="",e.style.userSelect="",e.style.touchAction="",q(e,"transformOrigin","")}function i(l={}){for(const f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=l[f]);(l.hasOwnProperty("cursor")||l.hasOwnProperty("canvas"))&&(t.style.cursor=e.style.cursor="",(a.canvas?t:e).style.cursor=a.cursor),l.hasOwnProperty("overflow")&&(t.style.overflow=l.overflow),l.hasOwnProperty("touchAction")&&(t.style.touchAction=l.touchAction,e.style.touchAction=l.touchAction)}let s=0,h=0,u=1,m=!1;c(a.startScale,{animate:!1,force:!0}),setTimeout(()=>{v(a.startX,a.startY,{animate:!1,force:!0})});function L(l,f){if(f.silent)return;const d=new CustomEvent("panzoomchange",{detail:l});e.dispatchEvent(d)}function S(l,f){const d={x:s,y:h,scale:u};typeof l.animate=="boolean"&&(l.animate?$e(e,l):q(e,"transition","none")),l.setTransform(e,d,l);const B=()=>{const n=l.contain&&l.contain!=="none"?le(e):Je(e);L({x:s,y:h,scale:u,dimsOut:n,originalEvent:f},l)};return l.animate?setTimeout(B,l.duration+50):requestAnimationFrame(B),d}function C(l,f,d,B){const n={...a,...B},p={x:s,y:h,opts:n};if(!n.force&&n.disablePan===!0)return p;if(l=parseFloat(l),f=parseFloat(f),p.x=l,p.y=f,n.contain&&n.contain!=="none"){const r=le(e),U=r.elem.width/u,H=r.elem.height/u,_=U*d,ee=H*d,F=(_-U)/2,Q=(ee-H)/2;if(n.contain==="inside"){const ie=(-r.elem.margin.left-r.parent.padding.left+F)/d,ce=(r.parent.width-_-r.parent.padding.left-r.elem.margin.left-r.parent.border.left-r.parent.border.right+F)/d;p.x=Math.max(Math.min(p.x,ce),ie);const ue=(-r.elem.margin.top-r.parent.padding.top+Q)/d,he=(r.parent.height-ee-r.parent.padding.top-r.elem.margin.top-r.parent.border.top-r.parent.border.bottom+Q)/d;p.y=Math.max(Math.min(p.y,he),ue)}else if(n.contain==="outside"){const ie=(-(_-r.parent.width)-r.parent.padding.left-r.parent.border.left-r.parent.border.right+F)/d,ce=(F-r.parent.padding.left)/d;p.x=Math.max(Math.min(p.x,ce),ie);const ue=(-(ee-r.parent.height)-r.parent.padding.top-r.parent.border.top-r.parent.border.bottom+Q)/d,he=(Q-r.parent.padding.top)/d;p.y=Math.max(Math.min(p.y,he),ue)}}return p}function T(l,f){const d={...a,...f},B={scale:u,opts:d};if(!d.force&&d.disableZoom)return B;let n=a.minScale,p=a.maxScale;if(d.contain&&d.contain!=="none"){const r=le(e),U=r.elem.width/u,H=r.elem.height/u;if(U>1&&H>1){const _=r.parent.width-r.parent.border.left-r.parent.border.right,ee=r.parent.height-r.parent.border.top-r.parent.border.bottom,F=_/U,Q=ee/H;a.contain==="inside"?p=Math.min(p,F,Q):a.contain==="outside"&&(n=Math.max(n,F,Q))}}return B.scale=Math.min(Math.max(l,n),p),B}function v(l,f,d,B){const n=C(l,f,u,d);return s!==n.x||h!==n.y?(s=n.x,h=n.y,S(n.opts,B)):{x:s,y:h,scale:u}}function c(l,f,d){const B=T(l,f),n=B.opts;if(!n.force&&n.disableZoom)return{x:s,y:h,scale:u};l=B.scale;let p=s,r=h;if(n.focal){const H=n.focal;p=(H.x/l-H.x/u+s*l)/l,r=(H.y/l-H.y/u+h*l)/l}const U=C(p,r,l,{relative:!1,force:!0});return s=U.x,h=U.y,u=l,S(n,d)}function y(l,f){const d={...a,animate:!0,...f};return c(u*Math.exp((l?1:-1)*d.step),d)}function R(l){return y(!0,l)}function x(l){return y(!1,l)}function w(l,f,d,B){const n=le(e),p={width:n.parent.width-n.parent.padding.left-n.parent.padding.right-n.parent.border.left-n.parent.border.right,height:n.parent.height-n.parent.padding.top-n.parent.padding.bottom-n.parent.border.top-n.parent.border.bottom};let r=f.clientX-n.parent.left-n.parent.padding.left-n.parent.border.left-n.elem.margin.left,U=f.clientY-n.parent.top-n.parent.padding.top-n.parent.border.top-n.elem.margin.top;a.origin!=="0 0"&&(r-=n.elem.width/u/2,U-=n.elem.height/u/2);const H={x:r/p.width*(p.width*l),y:U/p.height*(p.height*l)};return c(l,{...d,animate:!1,focal:H},B)}function A(l,f){l.preventDefault();const d={...a,...f,animate:!1},B=(l.deltaY===0&&l.deltaX?l.deltaX:l.deltaY)<0?1:-1,n=T(u*Math.exp(B*d.step/3),d).scale;return w(n,l,d,l)}function E(l){const f={...a,animate:!0,force:!0,...l};u=T(f.startScale,f).scale;const d=C(f.startX,f.startY,u,f);return s=d.x,h=d.y,S(f)}let M,z,g,k;const b=[];function Y(l){xe(b,l),m=!0,a.handleStartEvent(l),M=s,z=h;const f=Se(b);g=f.clientX,k=f.clientY}function D(l){if(!m||M===void 0||z===void 0||g===void 0||k===void 0)return;xe(b,l);const f=Se(b),d=u;v(M+(f.clientX-g)/d,z+(f.clientY-k)/d,{animate:!1},l)}function G(l){Ze(b,l),m&&(m=!1,M=z=g=k=void 0)}let V=!1;function J(){V||(V=!0,de("down",a.canvas?t:e,Y),de("move",document,D,{passive:!0}),de("up",document,G,{passive:!0}))}function te(){V=!1,pe("down",a.canvas?t:e,Y),pe("move",document,D),pe("up",document,G)}return a.noBind||J(),{bind:J,destroy:te,getPan:()=>({x:s,y:h}),getScale:()=>u,getOptions:()=>et(a),handleDown:Y,handleMove:D,handleUp:G,pan:v,reset:E,resetStyle:o,setOptions:i,setStyle:(l,f)=>q(e,l,f),zoom:c,zoomIn:R,zoomOut:x,zoomToPoint:w,zoomWithWheel:A}}ze.defaultOptions=Me;var tt=ze;const at={class:"sketch-ruler"},nt=re({__name:"index",props:{showRuler:{type:Boolean,default:!0},eyeIcon:{},closeEyeIcon:{},scale:{default:1},rate:{default:1},thick:{default:16},palette:{},width:{default:1400},height:{default:800},paddingRatio:{default:.2},autoCenter:{type:Boolean,default:!0},shadow:{default:()=>({x:0,y:0,width:0,height:0})},lines:{default:()=>({h:[],v:[]})},isShowReferLine:{type:Boolean,default:!0},canvasWidth:{default:700},canvasHeight:{default:700},snapsObj:{default:()=>({h:[],v:[]})},snapThreshold:{default:5},gridRatio:{default:1},lockLine:{type:Boolean,default:!1},selfHandle:{type:Boolean,default:!1},showShadowText:{type:Boolean,default:!0},panzoomOption:{}},emits:["onCornerClick","update:scale","zoomchange","update:lockLine"],setup(e,{expose:a,emit:t}){Ue(n=>({v4071069c:B.value}));const o=e,i=t,s=O(null),h=O(null),u=O(null),m=O(0),L=O(0);let S=0,C=0;const T=O(1),v=O(o.isShowReferLine),c=O(null),y=O("defaultCursor"),R=N(()=>({bgColor:"#f6f7f9",longfgColor:"#BABBBC",fontColor:"#7D8694",fontShadowColor:"#106ebe",shadowColor:"#e9f7fe",lineColor:"#51d6a9",lineType:"solid",lockLineColor:"#d4d7dc",hoverBg:"#000",hoverColor:"#fff",borderColor:"#eeeeef",...o.palette})),x=N(()=>({backgroundImage:v.value?`url(${o.eyeIcon??Ve})`:`url(${o.closeEyeIcon??qe})`,width:o.thick+"px",height:o.thick+"px",borderRight:`1px solid ${R.value.borderColor}`,borderBottom:`1px solid ${R.value.borderColor}`})),w=N(()=>({background:R.value.bgColor,width:A.value+"px",height:E.value+"px"})),A=N(()=>o.width-o.thick),E=N(()=>o.height-o.thick),M=n=>{(n.ctrlKey||n.metaKey)&&(n.preventDefault(),c.value?.zoomWithWheel(n))},z=n=>{const p=document.activeElement;p?.closest(".monaco-editor")||p?.tagName==="INPUT"||p?.tagName==="TEXTAREA"||p?.getAttribute("contenteditable")==="true"||n.key===" "&&(y.value="grabCursor",c.value?.bind(),n.preventDefault())},g=n=>{const p=document.activeElement;p?.closest(".monaco-editor")||p?.tagName==="INPUT"||p?.tagName==="TEXTAREA"||p?.getAttribute("contenteditable")==="true"||n.key===" "&&(c.value?.destroy(),y.value="defaultCursor")};function k(n){n.preventDefault(),n.stopPropagation(),c.value?.bind()}we(()=>{if(D(),!o.selfHandle&&s.value){const n=s.value.parentElement;if(!n)return;h.value=n,n.addEventListener("wheel",M,{passive:!1}),document.addEventListener("keydown",z),document.addEventListener("keyup",g),n.addEventListener("touchstart",k,{passive:!1})}}),Ee(()=>{h.value&&(h.value.removeEventListener("wheel",M),h.value.removeEventListener("touchstart",k)),document.removeEventListener("keydown",z),document.removeEventListener("keyup",g),u.value&&u.value.removeEventListener("panzoomchange",Y),c.value?.destroy()});const b=n=>({noBind:!0,startScale:n,startX:S,startY:C,smoothScroll:!0,canvas:!0,...o.panzoomOption}),Y=n=>{const{scale:p,dimsOut:r}=n.detail;if(r){i("update:scale",p),T.value=p;const U=(r.parent.left-r.elem.left)/p,H=(r.parent.top-r.elem.top)/p;m.value=U,i("zoomchange",n.detail),L.value=H}},D=()=>{if(u.value&&u.value.removeEventListener("panzoomchange",Y),c.value?.destroy(),s.value=document.querySelector(".canvasedit"),s.value){let n=o.scale;o.autoCenter&&(n=G()),c.value=tt(s.value,b(n)),s.value.addEventListener("panzoomchange",Y),u.value=s.value}},G=()=>{const n=A.value*(1-o.paddingRatio)/o.canvasWidth,p=E.value*(1-o.paddingRatio)/o.canvasHeight,r=Math.min(n,p);return S=A.value/2-o.canvasWidth/2,r<1?C=(o.canvasHeight*r/2-o.canvasHeight/2)/r-(o.canvasHeight*r-E.value)/r/2:r>1?C=(o.canvasHeight*r-o.canvasHeight)/2/r+(E.value-o.canvasHeight*r)/r/2:C=0,r},V=()=>c.value?.reset(),J=()=>c.value?.zoomIn(),te=()=>c.value?.zoomOut(),l=()=>{c.value?.setOptions(b(o.scale))},f=()=>{v.value=!v.value,i("onCornerClick",v.value)},d=n=>{i("update:lockLine",n)},B=N(()=>o.thick+"px");return K([()=>o.isShowReferLine],()=>{v.value=o.isShowReferLine}),K([()=>o.canvasWidth,()=>o.canvasHeight,()=>o.width,()=>o.height],()=>{D()}),K(()=>o.panzoomOption,()=>{l()},{deep:!0}),a({initPanzoom:D,panzoomInstance:c,reset:V,zoomIn:J,zoomOut:te,cursorClass:y}),(n,p)=>(W(),I("div",at,[ye(n.$slots,"btn",{reset:V,zoomIn:J,zoomOut:te}),Z("div",{class:ve(["canvasedit-parent",y.value]),style:P(w.value)},[Z("div",{class:ve(["canvasedit",y.value])},[ye(n.$slots,"default")],2)],6),j(fe(Ae,{style:P({marginLeft:e.thick+"px",width:A.value+"px"}),vertical:!1,width:e.width,height:e.thick,"is-show-refer-line":v.value,thick:e.thick,start:m.value,"start-other":L.value,lines:e.lines,"select-start":e.shadow.x,"snap-threshold":e.snapThreshold,"snaps-obj":e.snapsObj,"select-length":e.shadow.width,scale:T.value,palette:R.value,"canvas-width":e.canvasWidth,"show-shadow-text":e.showShadowText,"canvas-height":e.canvasHeight,rate:e.rate,"grid-ratio":e.gridRatio,"lock-line":e.lockLine,onChangeLineState:d},null,8,["style","width","height","is-show-refer-line","thick","start","start-other","lines","select-start","snap-threshold","snaps-obj","select-length","scale","palette","canvas-width","show-shadow-text","canvas-height","rate","grid-ratio","lock-line"]),[[$,e.showRuler]]),j(fe(Ae,{style:P({marginTop:e.thick+"px",top:0,height:E.value+"px"}),vertical:!0,width:e.thick,height:e.height,"is-show-refer-line":v.value,thick:e.thick,start:L.value,"start-other":m.value,lines:e.lines,"select-start":e.shadow.y,"select-length":e.shadow.height,"snap-threshold":e.snapThreshold,"snaps-obj":e.snapsObj,scale:T.value,palette:R.value,"canvas-width":e.canvasWidth,"canvas-height":e.canvasHeight,"show-shadow-text":e.showShadowText,rate:e.rate,"grid-ratio":e.gridRatio,"lock-line":e.lockLine,onChangeLineState:d},null,8,["style","width","height","is-show-refer-line","thick","start","start-other","lines","select-start","select-length","snap-threshold","snaps-obj","scale","palette","canvas-width","canvas-height","show-shadow-text","rate","grid-ratio","lock-line"]),[[$,e.showRuler]]),j(Z("a",{class:"corner",style:P(x.value),onClick:f},null,4),[[$,e.showRuler]])]))}});export{nt as o};
