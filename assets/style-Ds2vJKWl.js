import{d as de,x as We,r as H,c as N,i as Ee,p as Z,o as D,b as Q,y as Me,e as j,l as be,n as V,z as J,A as _,f as xe,m as Le,F as Ye,q as Pe,k as Ie,u as O,t as Oe,B as Se,g as he,a as De,C as Ve}from"./index-BWrXYicV.js";/*!vue3-sketch-ruler v2.2.62024年10月Thu Oct 24 2024 10:57:15 GMT+0000 (Coordinated Universal Time)制作*/const Qe=e=>e<=.25?40:e<=.5?20:e<=1?10:e<=2?5:e<=4?2:1;function Fe(e,t,n,o,r,s){s?r.moveTo(e,0):r.moveTo(0,e),r.save(),s?r.translate(e+5,o*.2):r.translate(n*.1,e+32),s||r.rotate(-Math.PI/2),r.fillText(Math.round(t).toString(),4,7),r.restore(),s?r.lineTo(e,o):r.lineTo(n,e),r.stroke(),r.closePath(),r.setTransform(1,0,0,1,0,0)}function re(e,t,n,o,r,s){o.fillStyle=r.fontShadowColor,o.strokeStyle=r.longfgColor,o.save(),o.translate(e,t),s||o.rotate(-Math.PI/2),o.strokeText(String(n),0,0),o.fillText(String(n),0,0),o.restore()}const qe=(e,t,n,o,r,s)=>{const{scale:h,width:m,height:u,ratio:M,palette:A,gridRatio:S,showShadowText:k}=r,{bgColor:p,fontColor:d,shadowColor:L,longfgColor:X}=A,g=s?r.canvasWidth:r.canvasHeight;e.setTransform(1,0,0,1,0,0),e.scale(M,M),e.clearRect(0,0,m,u),e.fillStyle=p,e.fillRect(0,0,m,u);const w=Qe(h)*S*10,C=w*h,R=Math.floor(t/w)*w,U=(R-t)/w*C,z=t+Math.ceil((s?m:u)/h);if(o){const y=(n-t)*h,B=o*h;if(e.fillStyle=L,s?e.fillRect(y,0,B,u):e.fillRect(0,y,m,B),k)if(s){re(y,u*.4,Math.round(n),e,A,s);const E=(n+o-t)*h;re(E,u*.4,Math.round(n+o),e,A,s)}else{re(m*.4,y,Math.round(n),e,A,s);const E=(n+o-t)*h;re(m*.4,E,Math.round(n+o),e,A,s)}}e.beginPath(),e.fillStyle=d,e.strokeStyle=X;for(let y=R,B=0;y<z;y+=w,B++){const E=U+B*C+.5;if(y-w<g&&y>g||y==g){const I=U+B*C+.5+(g-y)*h;Fe(I,g,m,u,e,s);return}y>=0&&y<=g&&(y==0?s?(e.moveTo(E,0),e.lineTo(E,u)):(e.moveTo(0,E),e.lineTo(m,E)):s?(e.moveTo(E,20),e.lineTo(E,u/1.3)):(e.moveTo(20,E),e.lineTo(m/1.3,E)),e.save(),y==0?s?e.translate(E-15,u*.01):e.translate(m*.3,E-5):s?e.translate(E-12,u*.05):e.translate(m*.05,E+12),s||e.rotate(-Math.PI/2),g-y>w/2&&(!k||o==0||Math.abs(y-n)>w/2&&Math.abs(y-(n+o))>w/2)&&e.fillText(y.toString(),4,9),e.restore())}e.stroke(),e.closePath()};function Ae(e,t=100){let n=null;const o=function(...r){n!==null&&clearTimeout(n),n=setTimeout(()=>{e(...r)},t)};return o.cancel=function(){n!==null&&(clearTimeout(n),n=null)},o}function Xe(e,t){const n=H(0),o=H(0),r=H(!1),s=N(()=>({backgroundColor:e.palette.hoverBg,color:e.palette.hoverColor,[t?"top":"left"]:"-8px",[t?"left":"top"]:`${n.value+10}px`})),h=({offsetX:p,offsetY:d})=>{n.value=t?p:d},m=(p,d)=>new Promise(L=>{if(e.lockLine)return;const X=t?p.clientY:p.clientX;h(p);const g=d||o.value;let w=g;const C=U=>{let z=((t?U.clientY:U.clientX)-X)/e.scale+g,y=z;const B=(t?e.snapsObj.h:e.snapsObj.v).slice().sort((E,I)=>Math.abs(y-E)-Math.abs(y-I));B.length&&Math.abs(B[0]-z)<e.snapThreshold/e.scale&&(y=B[0],z=y),w=Math.round(z),o.value=w},R=()=>{document.removeEventListener("mousemove",C),u(w,e.index),L()};document.addEventListener("mousemove",C),document.addEventListener("mouseup",R,{once:!0})}),u=(p,d)=>{var L,X;const g=t?(L=e.lines)==null?void 0:L.h:(X=e.lines)==null?void 0:X.v,w=M(p);if(g)if(w)if(typeof d=="number")g.splice(d,1);else return;else typeof d!="number"?g.push(p):g.splice(d,1,p)},M=p=>{const d=t?e.canvasHeight:e.canvasWidth;return p<0||p>d},A=N(()=>M(o.value)?"放开删除":`${t?"Y":"X"}：${o.value*e.rate}`),S=Ae(()=>{r.value=!1},200),k=Ae(()=>{r.value=!0},200);return{showLabel:r,startValue:o,actionStyle:s,labelContent:A,handleMouseDown:m,handleMouseenter:p=>{e.lockLine||(h(p),k(),S.cancel())},handleMouseLeave:()=>{S()}}}const Ke={key:0,class:"value"},Ze=de({__name:"ruler-line",props:{scale:{},palette:{},index:{},start:{},vertical:{type:Boolean},value:{},canvasWidth:{},canvasHeight:{},lines:{},isShowReferLine:{type:Boolean},rate:{},snapThreshold:{},snapsObj:{},lockLine:{type:Boolean}},setup(e){const t=e,n=H(!1),{actionStyle:o,handleMouseDown:r,labelContent:s,startValue:h,showLabel:m,handleMouseenter:u,handleMouseLeave:M}=Xe(t,t.vertical),A=N(()=>h.value>=t.start),S=N(()=>{const{lineType:p,lockLineColor:d,lineColor:L}=t.palette,X=t.lockLine?d:L??"black",g=t.lockLine||n.value?"none":"auto",w=t.isShowReferLine&&!t.lockLine?t.vertical?"ns-resize":"ew-resize":"default",C=t.vertical?"borderTop":"borderLeft",R=(h.value-t.start)*t.scale;return{[C]:`1px ${p} ${X}`,pointerEvents:g,cursor:w,[t.vertical?"top":"left"]:`${R}px`}});Ee(()=>{h.value=t.value??0});const k=Ae(()=>{n.value=!1},1e3);return Z([()=>t.scale],()=>{n.value=!0,k()}),(p,d)=>J((D(),Q("div",{class:"line",style:V(S.value),onMouseenter:d[0]||(d[0]=he((...L)=>O(u)&&O(u)(...L),["stop"])),onMouseleave:d[1]||(d[1]=he((...L)=>O(M)&&O(M)(...L),["stop"])),onMousedown:d[2]||(d[2]=he((...L)=>O(r)&&O(r)(...L),["stop"]))},[j("div",{class:"action",style:V(O(o))},[O(m)?(D(),Q("span",Ke,Oe(O(s)),1)):Se("",!0)],4)],36)),[[_,A.value]])}}),$e=de({__name:"index",props:{scale:{},palette:{},vertical:{type:Boolean},showShadowText:{type:Boolean},start:{},width:{},height:{},selectStart:{},selectLength:{},canvasWidth:{},canvasHeight:{},rate:{},gridRatio:{}},emits:["handleDragStart"],setup(e,{emit:t}){const n=e,o=t,r=De({isDragging:!1,canvasContext:null});let s=window.devicePixelRatio;const h=H(null);Ee(()=>{window.addEventListener("resize",m),u(),A(s),S(s)});const m=()=>{s=window.devicePixelRatio,A(s),S(s)},u=()=>{var p;r.canvasContext=((p=h.value)==null?void 0:p.getContext("2d"))||null},M=N(()=>({width:n.width+"px",height:n.height+"px",cursor:n.vertical?"ew-resize":"ns-resize",[n.vertical?"borderRight":"borderBottom"]:`1px solid ${n.palette.borderColor||"#eeeeef"} `}));Ve(()=>{window.removeEventListener("resize",m)});const A=p=>{if(h.value){h.value.width=Math.round(n.width*p),h.value.height=Math.round(n.height*p);const d=r.canvasContext;d&&(d.font=`11px -apple-system,
                "Helvetica Neue", ".SFNSText-Regular",
                "SF UI Text", Arial, "PingFang SC", "Hiragino Sans GB",
                "Microsoft YaHei", "WenQuanYi Zen Hei", sans-serif`,d.lineWidth=1,d.textBaseline="middle")}},S=p=>{const d={scale:n.scale,width:n.width,height:n.height,palette:n.palette,canvasWidth:n.canvasWidth,canvasHeight:n.canvasHeight,ratio:p,rate:n.rate,gridRatio:n.gridRatio,showShadowText:n.showShadowText};d.scale=n.scale/n.rate,d.canvasWidth=n.canvasWidth*n.rate,d.canvasHeight=n.canvasHeight*n.rate,r.canvasContext&&qe(r.canvasContext,n.start*n.rate,n.selectStart,n.selectLength,d,!n.vertical)};Z([()=>n.width,()=>n.height,()=>n.start,()=>n.palette,()=>n.selectStart,()=>n.selectLength],()=>{S(s)}),Z([()=>n.width,()=>n.height],()=>{A(s)});const k=p=>{o("handleDragStart",p)};return(p,d)=>(D(),Q("canvas",{ref_key:"canvas",ref:h,class:"ruler",style:V(M.value),onMousedown:he(k,["stop"])},null,36))}}),Ge={class:"lines"},je={key:0,class:"value"},Be=de({__name:"ruler-wrapper",props:{scale:{},thick:{},canvasWidth:{},canvasHeight:{},palette:{},vertical:{type:Boolean},width:{},height:{},start:{},startOther:{},lines:{},selectStart:{},selectLength:{},isShowReferLine:{type:Boolean},rate:{},snapThreshold:{},snapsObj:{},gridRatio:{},lockLine:{type:Boolean},showShadowText:{type:Boolean}},emits:["changeLineState"],setup(e,{emit:t}){const n=e,{showLabel:o,actionStyle:r,handleMouseenter:s,handleMouseLeave:h,handleMouseDown:m,labelContent:u,startValue:M}=Xe(n,!n.vertical),A=H(!1),S=H(!1),k=N(()=>n.vertical?"v-container":"h-container"),p=t,d=N(()=>{var g,w;return n.vertical?(g=n.lines)==null?void 0:g.h:(w=n.lines)==null?void 0:w.v}),L=N(()=>{const g=n.palette.lineType;let w=n.vertical?"left":"top",C=n.vertical?"top":"left",R=n.vertical?"borderLeft":"borderBottom";const U=(M.value-n.startOther)*n.scale+n.thick;return{[w]:U+"px",[C]:-n.thick+"px",cursor:n.vertical?"ew-resize":"ns-resize",[R]:`1px ${g} ${n.palette.lineColor}`}}),X=async g=>{const{offsetX:w,offsetY:C}=g,{scale:R,vertical:U,thick:z,startOther:y}=n;S.value=!0,A.value=!1,p("changeLineState",!1);let B=Math.round(y-z/R+(U?w:C)/R);M.value=B,await m(g,B),S.value=!1};return Z([()=>n.lockLine],()=>{A.value=n.lockLine}),(g,w)=>(D(),Q("div",{class:be(k.value)},[xe($e,Le(g.$props,{onHandleDragStart:X}),null,16),J(j("div",Ge,[(D(!0),Q(Ye,null,Pe(d.value,(C,R)=>(D(),Ie(Ze,Le({key:C+R,index:R,value:C>>0,ref_for:!0},g.$props),null,16,["index","value"]))),128))],512),[[_,g.isShowReferLine]]),g.isShowReferLine?J((D(),Q("div",{key:0,class:"indicator",style:V(L.value),onMouseenter:w[0]||(w[0]=(...C)=>O(s)&&O(s)(...C)),onMouseleave:w[1]||(w[1]=(...C)=>O(h)&&O(h)(...C))},[j("div",{class:"action",style:V(O(r))},[O(o)?(D(),Q("span",je,Oe(O(u)),1)):Se("",!0)],4)],36)),[[_,S.value]]):Se("",!0)],2))}}),Je="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAopJREFUOE/FlE9IVEEcx7+/N9ouds1Mu0QUSFZYdIgoUqQoKPBQHsKozpXE7jbTO/U8xLJvn6usBHWQ6hBFXupSkQeVbh0KJEPp0sH+eLGTsKs77xcj78m0ax0E8cHjzZv5zef3/c33xxA24KENYGJzoEEQbNNaN4Zh2OQ4znwYhr9c1/39vwrXVDo0NNS0tLR0GYB5D64BmAMwzMyvlFKz1es10Hw+f4mZ7wHYBeA9gNdENFepVOaEEM3M3OI4Thczn41gt6WUgQ3+C+r7/h0AWQD3mXnYqPA8L9nQ0HCemduIaFpKOWoAhUJhT6VSuQXgOjP3K6W8GLwKzeVyp4jonR0QBEErM48w8zFLyayUsjX+z+VyHhHdZebTSqkxM78CHRgYOKS1/ghgVErZY214RkQ7ADyRUj72ff8qgCtmXUrZGcf5vv8CwEUhxOF0Ov1pBRpla5dSdseBhUJhpznH6tIsZb1KqacW+BGArUaUXX63UuplHJTNZjuEEONSyhozfd/n6mQ1RkXZL2itz7mu+80EDA4ONi8vL/8AcM2UbikyR2BU9cSmmTU70YqKIAj2hWFo2uenlHK/BRg3Y2aeNO5GyU8S0ZbFxcUuz/NKEXAGQKPjOCcymcyX1dIi8DSAiWQyeaavr68cbSgCuBknYubnQoj+TCYzUywWE6VS6S2ADsdx2gxw1X3L7SNENMbMnwE8qK+vf5NKpRaMaeVyeW8ikfiaSqW+R7BuZr5BRMe11p2u607U9Gk8kc/ntzPzQwCmExYATDLzVBiGE0KIowAOADDf3QA+aK2VDaxRajto3K+rq+tl5nYAzQBamHmeiOYBTGmtR6ph/1Rqg9c73pz7dD1qN0TpHyNQRCUDJXrAAAAAAElFTkSuQmCC",_e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAjtJREFUOE/NlD9oFEEUxn9v9ghC0hpRUogIAUmniGAT/5Q2FrETPSNRJILg7RwimI0ox85eQFCEBGIUO1PYpFM0jSConQoBEZGgGPsgl+w+2eM2bC57SopAFqYZ3v7m+977ZoQt+GQLmGxPaBiGgYiMWWvXBHZUGoZhH3BERPYC+4F+4Keq/urt7b1RLpf/ZEBVHa9Wq0HWyg3QKIoGVPU8cA7wgK/pUtXPQJ8xZk+pVBpuNBqXUoUiEvi+P56fzTpo6+SbwHNg1lo7WzTITGEKXFlZeeB53tVCpa3CK8AFa+1cBgvD8LKIXAQOJkkyICJDeYVBEJS6u7s/qeoLa+1o+l9TqXNuBLhmjDlbqVQ+5ICjInIfOBPH8W9jzGCR5YmJiRNxHM+papgqzqDvgSlr7VTernPuO3An3c9bBt74vv+yrdaKyLDv+/1Sq9UGPc97nY9EVuycU2AQOA7cAm4Dr4D5TvVxHB9rKo2iaEFVp621Ln96FEUngaOqGmSxabVqsh3a2h+x1h5qQjNrae/yE4+iaCwDJkky73neTuBZe129Xk+H+BS4l7ZqLVIZ2BhzuFKpvMsDVXXWGPMxFdAedOfcKeCRqj7MYrUhpz09PfXl5eXrectFWXXODQHpOq2qd/95o/JXr6ura3J1dXU6SZIfwKKIHAD2tVYMPBGRx77vN10UXtO85fTkmZmZHUtLSzUR2QXsBhaAL6r6DXhbrVYXi1yss59GqOgub/bN3Z7v6X/tb9Zmp/q/kN8s+lJb8oEAAAAASUVORK5CYII=";/*!simple-panzoom v1.0.72024年8月Sat Aug 10 2024 16:04:04 GMT+0800 (中国标准时间)制作*/typeof window<"u"&&(window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach),typeof window.CustomEvent!="function"&&(window.CustomEvent=function(e,t){t=t||{bubbles:!1,cancelable:!1,detail:null};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}));function He(e,t){let n=e.length;for(;n--;)if(e[n].pointerId===t.pointerId)return n;return-1}function Ce(e,t){let n;if(t.touches){n=0;for(const o of t.touches)o.pointerId=n++,Ce(e,o);return}n=He(e,t),n>-1&&e.splice(n,1),e.push(t)}function et(e,t){if(t.touches){for(;e.length;)e.pop();return}const n=He(e,t);n>-1&&e.splice(n,1)}function Re(e){e=e.slice(0);let t=e.pop(),n;for(;n=e.pop();)t={clientX:(n.clientX-t.clientX)/2+t.clientX,clientY:(n.clientY-t.clientY)/2+t.clientY};return t}function ge(e){if(e.length<2)return 0;const t=e[0],n=e[1];return Math.sqrt(Math.pow(Math.abs(n.clientX-t.clientX),2)+Math.pow(Math.abs(n.clientY-t.clientY),2))}let le={down:"mousedown",move:"mousemove",up:"mouseup mouseleave"};typeof window<"u"&&(typeof window.PointerEvent=="function"?le={down:"pointerdown",move:"pointermove",up:"pointerup pointerleave pointercancel"}:typeof window.TouchEvent=="function"&&(le={down:"touchstart",move:"touchmove",up:"touchend touchcancel"}));function we(e,t,n,o){le[e].split(" ").forEach(r=>{t.addEventListener(r,n,o)})}function ye(e,t,n){le[e].split(" ").forEach(o=>{t.removeEventListener(o,n)})}const tt=typeof document<"u"&&!!document.documentMode;let Te;function nt(){return Te||(Te=document.createElement("div").style)}const ze=["webkit","moz","ms"],ie={};function ke(e){if(ie[e])return ie[e];const t=nt();if(e in t)return ie[e]=e;const n=e[0].toUpperCase()+e.slice(1);let o=ze.length;for(;o--;){const r=`${ze[o]}${n}`;if(r in t)return ie[e]=r}}function se(e,t){return parseFloat(t[ke(e)])||0}function ce(e,t,n=window.getComputedStyle(e)){const o=t==="border"?"Width":"";return{left:se(`${t}Left${o}`,n),right:se(`${t}Right${o}`,n),top:se(`${t}Top${o}`,n),bottom:se(`${t}Bottom${o}`,n)}}function G(e,t,n){e.style[ke(t)]=n}function ot(e,t){const n=ke("transform");G(e,"transition",`${n} ${t.duration}ms ${t.easing}`)}function at(e,{x:t,y:n,scale:o,isSVG:r},s){if(G(e,"transform",`scale(${o}) translate(${t}px, ${n}px)`),r&&tt){const h=window.getComputedStyle(e).getPropertyValue("transform");e.setAttribute("transform",h)}}function ue(e){const t=e.parentNode,n=window.getComputedStyle(e),o=window.getComputedStyle(t),r=e.getBoundingClientRect(),s=t.getBoundingClientRect();return{elem:{style:n,width:r.width,height:r.height,top:r.top,bottom:r.bottom,left:r.left,right:r.right,margin:ce(e,"margin",n),border:ce(e,"border",n)},parent:{style:o,width:s.width,height:s.height,top:s.top,bottom:s.bottom,left:s.left,right:s.right,padding:ce(t,"padding",o),border:ce(t,"border",o)}}}function lt(e){let t=e;for(;t&&t.parentNode;){if(t.parentNode===document)return!0;t=t.parentNode instanceof ShadowRoot?t.parentNode.host:t.parentNode}return!1}function rt(e){return(e.getAttribute("class")||"").trim()}function it(e,t){return e.nodeType===1&&` ${rt(e)} `.indexOf(` ${t} `)>-1}function st(e,t){for(let n=e;n!=null;n=n.parentNode)if(it(n,t.excludeClass)||t.exclude.indexOf(n)>-1)return!0;return!1}const ct=/^http:[\w\.\/]+svg$/;function ut(e){return ct.test(e.namespaceURI)&&e.nodeName.toLowerCase()!=="svg"}function ht(e){const t={};for(const n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}const Ne={animate:!1,canvas:!1,cursor:"move",disablePan:!1,disableZoom:!1,disableXAxis:!1,disableYAxis:!1,duration:200,easing:"ease-in-out",exclude:[],excludeClass:"panzoom-exclude",handleStartEvent:e=>{e.preventDefault(),e.stopPropagation()},maxScale:4,minScale:.125,overflow:"hidden",panOnlyWhenZoomed:!1,pinchAndPan:!1,relative:!1,setTransform:at,startX:0,startY:0,startScale:1,step:.3,touchAction:"none"};function Ue(e,t){if(!e)throw new Error("Panzoom requires an element as an argument");if(e.nodeType!==1)throw new Error("Panzoom requires an element with a nodeType of 1");if(!lt(e))throw new Error("Panzoom should be called on elements that have been attached to the DOM");t={...Ne,...t};const n=ut(e),o=e.parentNode;o.style.overflow=t.overflow,o.style.userSelect="none",o.style.touchAction=t.touchAction,(t.canvas?o:e).style.cursor=t.cursor,e.style.userSelect="none",e.style.touchAction=t.touchAction,G(e,"transformOrigin",typeof t.origin=="string"?t.origin:n?"0 0":"50% 50%");function r(){o.style.overflow="",o.style.userSelect="",o.style.touchAction="",o.style.cursor="",e.style.cursor="",e.style.userSelect="",e.style.touchAction="",G(e,"transformOrigin","")}function s(a={}){for(const c in a)a.hasOwnProperty(c)&&(t[c]=a[c]);(a.hasOwnProperty("cursor")||a.hasOwnProperty("canvas"))&&(o.style.cursor=e.style.cursor="",(t.canvas?o:e).style.cursor=t.cursor),a.hasOwnProperty("overflow")&&(o.style.overflow=a.overflow),a.hasOwnProperty("touchAction")&&(o.style.touchAction=a.touchAction,e.style.touchAction=a.touchAction)}let h=0,m=0,u=1,M=!1;L(t.startScale,{animate:!1,force:!0}),setTimeout(()=>{d(t.startX,t.startY,{animate:!1,force:!0})});function A(a,c,f){if(f.silent)return;const x=new CustomEvent(a,{detail:c});e.dispatchEvent(x)}function S(a,c,f){const x={x:h,y:m,scale:u,isSVG:n,originalEvent:f,dimsOut:{}};typeof c.animate=="boolean"&&(c.animate?ot(e,c):G(e,"transition","none")),c.setTransform(e,x,c);function i(){const b=ue(e);x.dimsOut=b,A(a,x,c),A("panzoomchange",x,c)}return c.animate?setTimeout(()=>{i()},c.duration+50):requestAnimationFrame(()=>{i()}),x}function k(a,c,f,x){const i={...t,...x},b={x:h,y:m,opts:i};if(!i.force&&(i.disablePan||i.panOnlyWhenZoomed&&u===i.startScale))return b;if(a=parseFloat(a),c=parseFloat(c),i.disableXAxis||(b.x=(i.relative?h:0)+a),i.disableYAxis||(b.y=(i.relative?m:0)+c),i.contain){const v=ue(e),P=v.elem.width/u,Y=v.elem.height/u,oe=P*f,ae=Y*f,q=(oe-P)/2,K=(ae-Y)/2;if(i.contain==="inside"){const pe=(-v.elem.margin.left-v.parent.padding.left+q)/f,ve=(v.parent.width-oe-v.parent.padding.left-v.elem.margin.left-v.parent.border.left-v.parent.border.right+q)/f;b.x=Math.max(Math.min(b.x,ve),pe);const fe=(-v.elem.margin.top-v.parent.padding.top+K)/f,me=(v.parent.height-ae-v.parent.padding.top-v.elem.margin.top-v.parent.border.top-v.parent.border.bottom+K)/f;b.y=Math.max(Math.min(b.y,me),fe)}else if(i.contain==="outside"){const pe=(-(oe-v.parent.width)-v.parent.padding.left-v.parent.border.left-v.parent.border.right+q)/f,ve=(q-v.parent.padding.left)/f;b.x=Math.max(Math.min(b.x,ve),pe);const fe=(-(ae-v.parent.height)-v.parent.padding.top-v.parent.border.top-v.parent.border.bottom+K)/f,me=(K-v.parent.padding.top)/f;b.y=Math.max(Math.min(b.y,me),fe)}}return i.roundPixels&&(b.x=Math.round(b.x),b.y=Math.round(b.y)),b}function p(a,c){const f={...t,...c},x={scale:u,opts:f};if(!f.force&&f.disableZoom)return x;let i=t.minScale,b=t.maxScale;if(f.contain){const v=ue(e),P=v.elem.width/u,Y=v.elem.height/u;if(P>1&&Y>1){const oe=v.parent.width-v.parent.border.left-v.parent.border.right,ae=v.parent.height-v.parent.border.top-v.parent.border.bottom,q=oe/P,K=ae/Y;t.contain==="inside"?b=Math.min(b,q,K):t.contain==="outside"&&(i=Math.max(i,q,K))}}return x.scale=Math.min(Math.max(a,i),b),x}function d(a,c,f,x){const i=k(a,c,u,f);return h!==i.x||m!==i.y?(h=i.x,m=i.y,S("panzoompan",i.opts,x)):{x:h,y:m,scale:u,isSVG:n,originalEvent:x}}function L(a,c,f){const x=p(a,c),i=x.opts;if(!i.force&&i.disableZoom)return;a=x.scale;let b=h,v=m;if(i.focal){const Y=i.focal;b=(Y.x/a-Y.x/u+h*a)/a,v=(Y.y/a-Y.y/u+m*a)/a}const P=k(b,v,a,{relative:!1,force:!0});return h=P.x,m=P.y,u=a,S("panzoomzoom",i,f)}function X(a,c){const f={...t,animate:!0,...c};return L(u*Math.exp((a?1:-1)*f.step),f)}function g(a){return X(!0,a)}function w(a){return X(!1,a)}function C(a,c,f,x){const i=ue(e),b={width:i.parent.width-i.parent.padding.left-i.parent.padding.right-i.parent.border.left-i.parent.border.right,height:i.parent.height-i.parent.padding.top-i.parent.padding.bottom-i.parent.border.top-i.parent.border.bottom};let v=c.clientX-i.parent.left-i.parent.padding.left-i.parent.border.left-i.elem.margin.left,P=c.clientY-i.parent.top-i.parent.padding.top-i.parent.border.top-i.elem.margin.top;n||(v-=i.elem.width/u/2,P-=i.elem.height/u/2);const Y={x:v/b.width*(b.width*a),y:P/b.height*(b.height*a)};return L(a,{...f,animate:!1,focal:Y},x)}function R(a,c){a.preventDefault();const f={...t,...c,animate:!1},x=(a.deltaY===0&&a.deltaX?a.deltaX:a.deltaY)<0?1:-1,i=p(u*Math.exp(x*f.step/3),f).scale;return C(i,a,f,a)}function U(a){const c={...t,animate:!0,force:!0,...a};u=p(c.startScale,c).scale;const f=k(c.startX,c.startY,u,c);return h=f.x,m=f.y,S("panzoomreset",c)}let z,y,B,E,I,F;const W=[];function ee(a){if(st(a.target,t))return;Ce(W,a),M=!0,t.handleStartEvent(a),z=h,y=m,A("panzoomstart",{x:h,y:m,scale:u,isSVG:n,originalEvent:a},t);const c=Re(W);B=c.clientX,E=c.clientY,I=u,F=ge(W)}function te(a){if(!M||z===void 0||y===void 0||B===void 0||E===void 0)return;Ce(W,a);const c=Re(W),f=W.length>1;let x=u;if(f){F===0&&(F=ge(W));const i=ge(W)-F;x=p(i*t.step/80+I).scale,C(x,c,{animate:!1},a)}(!f||t.pinchAndPan)&&d(z+(c.clientX-B)/x,y+(c.clientY-E)/x,{animate:!1},a)}function $(a){W.length===1&&A("panzoomend",{x:h,y:m,scale:u,isSVG:n,originalEvent:a},t),et(W,a),M&&(M=!1,z=y=B=E=void 0)}let ne=!1;function l(){ne||(ne=!0,we("down",t.canvas?o:e,ee),we("move",document,te,{passive:!0}),we("up",document,$,{passive:!0}))}function T(){ne=!1,ye("down",t.canvas?o:e,ee),ye("move",document,te),ye("up",document,$)}return t.noBind||l(),{bind:l,destroy:T,eventNames:le,getPan:()=>({x:h,y:m}),getScale:()=>u,getOptions:()=>ht(t),handleDown:ee,handleMove:te,handleUp:$,pan:d,reset:U,resetStyle:r,setOptions:s,setStyle:(a,c)=>G(e,a,c),zoom:L,zoomIn:g,zoomOut:w,zoomToPoint:C,zoomWithWheel:R}}Ue.defaultOptions=Ne;const dt={class:"sketch-ruler"},vt=de({__name:"index",props:{showRuler:{type:Boolean,default:!0},eyeIcon:{},closeEyeIcon:{},scale:{default:1},rate:{default:1},thick:{default:16},palette:{},width:{default:1400},height:{default:800},paddingRatio:{default:.2},autoCenter:{type:Boolean,default:!0},shadow:{default:()=>({x:0,y:0,width:0,height:0})},lines:{default:()=>({h:[],v:[]})},isShowReferLine:{type:Boolean,default:!0},canvasWidth:{default:700},canvasHeight:{default:700},snapsObj:{default:()=>({h:[],v:[]})},snapThreshold:{default:5},gridRatio:{default:1},lockLine:{type:Boolean,default:!1},selfHandle:{type:Boolean,default:!1},showShadowText:{type:Boolean,default:!0},panzoomOption:{}},emits:["onCornerClick","update:scale","zoomchange","update:lockLine"],setup(e,{expose:t,emit:n}){We(l=>({"5de0e4ab":ne.value}));const o=e,r=n,s=H(null),h=H(0),m=H(0);let u=0,M=0;const A=H(1),S=H(o.isShowReferLine),k=H(null),p=H("defaultCursor"),d=N(()=>({bgColor:"#f6f7f9",longfgColor:"#BABBBC",fontColor:"#7D8694",fontShadowColor:"#106ebe",shadowColor:"#e9f7fe",lineColor:"#51d6a9",lineType:"solid",lockLineColor:"#d4d7dc",hoverBg:"#000",hoverColor:"#fff",borderColor:"#eeeeef",...o.palette})),L=N(()=>({backgroundImage:S.value?`url(${o.eyeIcon??Je})`:`url(${o.closeEyeIcon??_e})`,width:o.thick+"px",height:o.thick+"px",borderRight:`1px solid ${d.value.borderColor}`,borderBottom:`1px solid ${d.value.borderColor}`})),X=N(()=>({background:d.value.bgColor,width:g.value+"px",height:w.value+"px"})),g=N(()=>o.width-o.thick),w=N(()=>o.height-o.thick),C=l=>{var T;(l.ctrlKey||l.metaKey)&&((T=k.value)==null||T.zoomWithWheel(l))},R=l=>{var T;l.key===" "&&(p.value="grabCursor",(T=k.value)==null||T.bind(),l.preventDefault())},U=l=>{var T;l.key===" "&&((T=k.value)==null||T.destroy(),p.value="defaultCursor")};Ee(()=>{if(B(),!o.selfHandle&&s.value){const l=s.value.parentElement;if(!l)return;l.addEventListener("wheel",C),document.addEventListener("keydown",R),document.addEventListener("keyup",U)}});const z=l=>({noBind:!0,startScale:l,startX:u,startY:M,smoothScroll:!0,canvas:!0,...o.panzoomOption}),y=l=>{const{scale:T,dimsOut:a}=l.detail;if(a){r("update:scale",T),A.value=T;const c=(a.parent.left-a.elem.left)/T,f=(a.parent.top-a.elem.top)/T;h.value=c,r("zoomchange",l.detail),m.value=f}},B=()=>{if(s.value=document.querySelector(".canvasedit"),s.value){let l=o.scale;o.autoCenter&&(l=E()),k.value=Ue(s.value,z(l)),s.value&&s.value.addEventListener("panzoomchange",y)}},E=()=>{const l=g.value*(1-o.paddingRatio)/o.canvasWidth,T=w.value*(1-o.paddingRatio)/o.canvasHeight,a=Math.min(l,T);return u=g.value/2-o.canvasWidth/2,a<1?M=(o.canvasHeight*a/2-o.canvasHeight/2)/a-(o.canvasHeight*a-w.value)/a/2:a>1?M=(o.canvasHeight*a-o.canvasHeight)/2/a+(w.value-o.canvasHeight*a)/a/2:M=0,a},I=()=>{var l;return(l=k.value)==null?void 0:l.reset()},F=()=>{var l;return(l=k.value)==null?void 0:l.zoomIn()},W=()=>{var l;return(l=k.value)==null?void 0:l.zoomOut()},ee=()=>{var l;(l=k.value)==null||l.setOptions(z(o.scale))},te=()=>{S.value=!S.value,r("onCornerClick",S.value)},$=l=>{r("update:lockLine",l)},ne=N(()=>o.thick+"px");return Z([()=>o.isShowReferLine],()=>{S.value=o.isShowReferLine}),Z([()=>o.canvasWidth,()=>o.canvasHeight,()=>o.width,()=>o.height],()=>{B()}),Z(()=>o.panzoomOption,()=>{ee()},{deep:!0}),t({initPanzoom:B,panzoomInstance:k,reset:I,zoomIn:F,zoomOut:W,cursorClass:p}),(l,T)=>(D(),Q("div",dt,[Me(l.$slots,"btn",{reset:I,zoomIn:F,zoomOut:W}),j("div",{class:be(["canvasedit-parent",p.value]),style:V(X.value)},[j("div",{class:be(["canvasedit",p.value])},[Me(l.$slots,"default")],2)],6),J(xe(Be,{style:V({marginLeft:l.thick+"px",width:g.value+"px"}),vertical:!1,width:l.width,height:l.thick,"is-show-refer-line":S.value,thick:l.thick,start:h.value,"start-other":m.value,lines:l.lines,"select-start":l.shadow.x,"snap-threshold":l.snapThreshold,"snaps-obj":l.snapsObj,"select-length":l.shadow.width,scale:A.value,palette:d.value,"canvas-width":l.canvasWidth,"show-shadow-text":l.showShadowText,"canvas-height":l.canvasHeight,rate:l.rate,"grid-ratio":l.gridRatio,"lock-line":l.lockLine,onChangeLineState:$},null,8,["style","width","height","is-show-refer-line","thick","start","start-other","lines","select-start","snap-threshold","snaps-obj","select-length","scale","palette","canvas-width","show-shadow-text","canvas-height","rate","grid-ratio","lock-line"]),[[_,l.showRuler]]),J(xe(Be,{style:V({marginTop:l.thick+"px",top:0,height:w.value+"px"}),vertical:!0,width:l.thick,height:l.height,"is-show-refer-line":S.value,thick:l.thick,start:m.value,"start-other":h.value,lines:l.lines,"select-start":l.shadow.y,"select-length":l.shadow.height,"snap-threshold":l.snapThreshold,"snaps-obj":l.snapsObj,scale:A.value,palette:d.value,"canvas-width":l.canvasWidth,"canvas-height":l.canvasHeight,"show-shadow-text":l.showShadowText,rate:l.rate,"grid-ratio":l.gridRatio,"lock-line":l.lockLine,onChangeLineState:$},null,8,["style","width","height","is-show-refer-line","thick","start","start-other","lines","select-start","select-length","snap-threshold","snaps-obj","scale","palette","canvas-width","canvas-height","show-shadow-text","rate","grid-ratio","lock-line"]),[[_,l.showRuler]]),J(j("a",{class:"corner",style:V(L.value),onClick:te},null,4),[[_,l.showRuler]])]))}});export{vt as f};
