import{r as Y,c as V,d as he,i as ke,p as j,x as _,y as ee,o as K,b as F,e as te,u as P,t as Xe,z as be,n as $,g as de,a as Ve,A as We,f as Se,m as Le,F as xe,q as De,l as Ae,k as Ie,B as He,C as Be}from"./index-DicYKX8b.js";const Ke=e=>e<=.25?40:e<=.5?20:e<=1?10:e<=2?5:e<=4?2:1;function $e(e,t,n,o,r,l){l?r.moveTo(e,0):r.moveTo(0,e),r.save(),l?r.translate(e+5,o*.2):r.translate(n*.1,e+32),l||r.rotate(-Math.PI/2),r.fillText(Math.round(t).toString(),4,7),r.restore(),l?r.lineTo(e,o):r.lineTo(n,e),r.stroke(),r.closePath(),r.setTransform(1,0,0,1,0,0)}function re(e,t,n,o,r,l){o.fillStyle=r.fontShadowColor,o.strokeStyle=r.longfgColor,o.save(),o.translate(e,t),l||o.rotate(-Math.PI/2),o.strokeText(String(n),0,0),o.fillText(String(n),0,0),o.restore()}const Qe=(e,t,n,o,r,l)=>{const{scale:d,width:f,height:u,ratio:R,palette:M,gridRatio:E,showShadowText:L}=r,{bgColor:S,fontColor:m,shadowColor:w,longfgColor:T}=M,v=l?r.canvasWidth:r.canvasHeight;e.setTransform(1,0,0,1,0,0),e.scale(R,R),e.clearRect(0,0,f,u),e.fillStyle=S,e.fillRect(0,0,f,u);const g=Ke(d)*E*10,B=g*d,W=Math.floor(t/g)*g,X=(W-t)/g*B,x=t+Math.ceil((l?f:u)/d);if(o){const y=(n-t)*d,z=o*d;if(e.fillStyle=w,l?e.fillRect(y,0,z,u):e.fillRect(0,y,f,z),L)if(l){re(y,u*.4,Math.round(n),e,M,l);const C=(n+o-t)*d;re(C,u*.4,Math.round(n+o),e,M,l)}else{re(f*.4,y,Math.round(n),e,M,l);const C=(n+o-t)*d;re(f*.4,C,Math.round(n+o),e,M,l)}}e.beginPath(),e.fillStyle=m,e.strokeStyle=T;for(let y=W,z=0;y<x;y+=g,z++){const C=X+z*B+.5;if(y-g<v&&y>v||y==v){const N=X+z*B+.5+(v-y)*d;$e(N,v,f,u,e,l);return}y>=0&&y<=v&&(y==0?l?(e.moveTo(C,0),e.lineTo(C,u)):(e.moveTo(0,C),e.lineTo(f,C)):l?(e.moveTo(C,20),e.lineTo(C,u/1.3)):(e.moveTo(20,C),e.lineTo(f/1.3,C)),e.save(),y==0?l?e.translate(C-15,u*.01):e.translate(f*.3,C-5):l?e.translate(C-12,u*.05):e.translate(f*.05,C+12),l||e.rotate(-Math.PI/2),v-y>g/2&&(!L||o==0||Math.abs(y-n)>g/2&&Math.abs(y-(n+o))>g/2)&&e.fillText(y.toString(),4,9),e.restore())}e.stroke(),e.closePath()};function Ce(e,t=100){let n=null;const o=function(...r){n!==null&&clearTimeout(n),n=setTimeout(()=>{e(...r)},t)};return o.cancel=function(){n!==null&&(clearTimeout(n),n=null)},o}function ze(e,t){const n=Y(0),o=Y(0),r=Y(!1),l=V(()=>({backgroundColor:e.palette.hoverBg,color:e.palette.hoverColor,[t?"top":"left"]:"-8px",[t?"left":"top"]:`${n.value+10}px`})),d=({offsetX:w,offsetY:T})=>{n.value=t?w:T},f=(w,T)=>new Promise(v=>{if(e.lockLine)return;const k=t?w.clientY:w.clientX;d(w);const g=T||o.value;let B=g;const W=x=>{let C=((t?x.clientY:x.clientX)-k)/e.scale+g,N=C;const H=(t?e.snapsObj.h:e.snapsObj.v).slice().sort((G,Q)=>Math.abs(N-G)-Math.abs(N-Q));H.length&&Math.abs(H[0]-C)<e.snapThreshold/e.scale&&(N=H[0],C=N),B=Math.round(C),o.value=B},X=()=>{document.removeEventListener("mousemove",W),u(B,e.index),v()};document.addEventListener("mousemove",W),document.addEventListener("mouseup",X,{once:!0})}),u=(w,T)=>{var g,B;const v=t?(g=e.lines)==null?void 0:g.h:(B=e.lines)==null?void 0:B.v,k=R(w);if(v)if(k)if(typeof T=="number")v.splice(T,1);else return;else typeof T!="number"?v.push(w):v.splice(T,1,w)},R=w=>{const T=t?e.canvasHeight:e.canvasWidth;return w<0||w>T},M=V(()=>R(o.value)?"放开删除":`${t?"Y":"X"}：${o.value*e.rate}`),E=Ce(()=>{r.value=!1},200),L=Ce(()=>{r.value=!0},200);return{showLabel:r,startValue:o,actionStyle:l,labelContent:M,handleMouseDown:f,handleMouseenter:w=>{e.lockLine||(d(w),L(),E.cancel())},handleMouseLeave:()=>{E()}}}const Fe={key:0,class:"value"},Ge=he({__name:"ruler-line",props:{scale:{},palette:{},index:{},start:{},vertical:{type:Boolean},value:{},canvasWidth:{},canvasHeight:{},lines:{},isShowReferLine:{type:Boolean},rate:{},snapThreshold:{},snapsObj:{},lockLine:{type:Boolean}},setup(e){const t=e,n=Y(!1),{actionStyle:o,handleMouseDown:r,labelContent:l,startValue:d,showLabel:f,handleMouseenter:u,handleMouseLeave:R}=ze(t,t.vertical),M=V(()=>d.value>=t.start),E=V(()=>{const{lineType:S,lockLineColor:m,lineColor:w}=t.palette,T=t.lockLine?m:w??"black",v=t.lockLine||n.value?"none":"auto",k=t.isShowReferLine&&!t.lockLine?t.vertical?"ns-resize":"ew-resize":"default",g=t.vertical?"borderTop":"borderLeft",B=(d.value-t.start)*t.scale;return{[g]:`1px ${S} ${T}`,pointerEvents:v,cursor:k,[t.vertical?"top":"left"]:`${B}px`}});ke(()=>{d.value=t.value??0});const L=Ce(()=>{n.value=!1},1e3);return j([()=>t.scale],()=>{n.value=!0,L()}),(S,m)=>_((K(),F("div",{class:"line",style:$(E.value),onMouseenter:m[0]||(m[0]=de((...w)=>P(u)&&P(u)(...w),["stop"])),onMouseleave:m[1]||(m[1]=de((...w)=>P(R)&&P(R)(...w),["stop"])),onMousedown:m[2]||(m[2]=de((...w)=>P(r)&&P(r)(...w),["stop"]))},[te("div",{class:"action",style:$(P(o))},[P(f)?(K(),F("span",Fe,Xe(P(l)),1)):be("",!0)],4)],36)),[[ee,M.value]])}}),qe=he({__name:"index",props:{scale:{},palette:{},vertical:{type:Boolean},showShadowText:{type:Boolean},start:{},width:{},height:{},selectStart:{},selectLength:{},canvasWidth:{},canvasHeight:{},rate:{},gridRatio:{}},emits:["handleDragStart"],setup(e,{emit:t}){const n=e,o=t,r=Ve({isDragging:!1,canvasContext:null});let l=window.devicePixelRatio;const d=Y(null);ke(()=>{window.addEventListener("resize",f),u(),M(l),E(l)});const f=()=>{l=window.devicePixelRatio,M(l),E(l)},u=()=>{var S;r.canvasContext=((S=d.value)==null?void 0:S.getContext("2d"))||null},R=V(()=>({width:n.width+"px",height:n.height+"px",cursor:n.vertical?"ew-resize":"ns-resize",[n.vertical?"borderRight":"borderBottom"]:`1px solid ${n.palette.borderColor||"#eeeeef"} `}));We(()=>{window.removeEventListener("resize",f)});const M=S=>{if(d.value){d.value.width=Math.round(n.width*S),d.value.height=Math.round(n.height*S);const m=r.canvasContext;m&&(m.font=`11px -apple-system,
                "Helvetica Neue", ".SFNSText-Regular",
                "SF UI Text", Arial, "PingFang SC", "Hiragino Sans GB",
                "Microsoft YaHei", "WenQuanYi Zen Hei", sans-serif`,m.lineWidth=1,m.textBaseline="middle")}},E=S=>{const m={scale:n.scale,width:n.width,height:n.height,palette:n.palette,canvasWidth:n.canvasWidth,canvasHeight:n.canvasHeight,ratio:S,rate:n.rate,gridRatio:n.gridRatio,showShadowText:n.showShadowText};m.scale=n.scale/n.rate,m.canvasWidth=n.canvasWidth*n.rate,m.canvasHeight=n.canvasHeight*n.rate,r.canvasContext&&Qe(r.canvasContext,n.start*n.rate,n.selectStart,n.selectLength,m,!n.vertical)};j([()=>n.width,()=>n.height,()=>n.start,()=>n.palette,()=>n.selectStart,()=>n.selectLength],()=>{E(l)}),j([()=>n.width,()=>n.height],()=>{M(l)});const L=S=>{o("handleDragStart",S)};return(S,m)=>(K(),F("canvas",{ref_key:"canvas",ref:d,class:"ruler",style:$(R.value),onMousedown:de(L,["stop"])},null,36))}}),Ze={class:"lines"},je={key:0,class:"value"},Re=he({__name:"ruler-wrapper",props:{scale:{},thick:{},canvasWidth:{},canvasHeight:{},palette:{},vertical:{type:Boolean},width:{},height:{},start:{},startOther:{},lines:{},selectStart:{},selectLength:{},isShowReferLine:{type:Boolean},rate:{},snapThreshold:{},snapsObj:{},gridRatio:{},lockLine:{type:Boolean},showShadowText:{type:Boolean}},emits:["changeLineState"],setup(e,{emit:t}){const n=e,{showLabel:o,actionStyle:r,handleMouseenter:l,handleMouseLeave:d,handleMouseDown:f,labelContent:u,startValue:R}=ze(n,!n.vertical),M=Y(!1),E=Y(!1),L=V(()=>n.vertical?"v-container":"h-container"),S=t,m=V(()=>{var v,k;return n.vertical?(v=n.lines)==null?void 0:v.h:(k=n.lines)==null?void 0:k.v}),w=V(()=>{const v=n.palette.lineType;let k=n.vertical?"left":"top",g=n.vertical?"top":"left",B=n.vertical?"borderLeft":"borderBottom";const W=(R.value-n.startOther)*n.scale+n.thick;return{[k]:W+"px",[g]:-n.thick+"px",cursor:n.vertical?"ew-resize":"ns-resize",[B]:`1px ${v} ${n.palette.lineColor}`}}),T=async v=>{const{offsetX:k,offsetY:g}=v,{scale:B,vertical:W,thick:X,startOther:x}=n;E.value=!0,M.value=!1,S("changeLineState",!1);let y=Math.round(x-X/B+(W?k:g)/B);R.value=y,await f(v,y),E.value=!1};return j([()=>n.lockLine],()=>{M.value=n.lockLine}),(v,k)=>(K(),F("div",{class:Ae(L.value)},[Se(qe,Le(v.$props,{onHandleDragStart:T}),null,16),_(te("div",Ze,[(K(!0),F(xe,null,De(m.value,(g,B)=>(K(),Ie(Ge,Le({key:g+B,index:B,value:g>>0,ref_for:!0},v.$props),null,16,["index","value"]))),128))],512),[[ee,v.isShowReferLine]]),v.isShowReferLine?_((K(),F("div",{key:0,class:"indicator",style:$(w.value),onMouseenter:k[0]||(k[0]=(...g)=>P(l)&&P(l)(...g)),onMouseleave:k[1]||(k[1]=(...g)=>P(d)&&P(d)(...g))},[te("div",{class:"action",style:$(P(r))},[P(o)?(K(),F("span",je,Xe(P(u)),1)):be("",!0)],4)],36)),[[ee,E.value]]):be("",!0)],2))}}),Je="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAopJREFUOE/FlE9IVEEcx7+/N9ouds1Mu0QUSFZYdIgoUqQoKPBQHsKozpXE7jbTO/U8xLJvn6usBHWQ6hBFXupSkQeVbh0KJEPp0sH+eLGTsKs77xcj78m0ax0E8cHjzZv5zef3/c33xxA24KENYGJzoEEQbNNaN4Zh2OQ4znwYhr9c1/39vwrXVDo0NNS0tLR0GYB5D64BmAMwzMyvlFKz1es10Hw+f4mZ7wHYBeA9gNdENFepVOaEEM3M3OI4Thczn41gt6WUgQ3+C+r7/h0AWQD3mXnYqPA8L9nQ0HCemduIaFpKOWoAhUJhT6VSuQXgOjP3K6W8GLwKzeVyp4jonR0QBEErM48w8zFLyayUsjX+z+VyHhHdZebTSqkxM78CHRgYOKS1/ghgVErZY214RkQ7ADyRUj72ff8qgCtmXUrZGcf5vv8CwEUhxOF0Ov1pBRpla5dSdseBhUJhpznH6tIsZb1KqacW+BGArUaUXX63UuplHJTNZjuEEONSyhozfd/n6mQ1RkXZL2itz7mu+80EDA4ONi8vL/8AcM2UbikyR2BU9cSmmTU70YqKIAj2hWFo2uenlHK/BRg3Y2aeNO5GyU8S0ZbFxcUuz/NKEXAGQKPjOCcymcyX1dIi8DSAiWQyeaavr68cbSgCuBknYubnQoj+TCYzUywWE6VS6S2ADsdx2gxw1X3L7SNENMbMnwE8qK+vf5NKpRaMaeVyeW8ikfiaSqW+R7BuZr5BRMe11p2u607U9Gk8kc/ntzPzQwCmExYATDLzVBiGE0KIowAOADDf3QA+aK2VDaxRajto3K+rq+tl5nYAzQBamHmeiOYBTGmtR6ph/1Rqg9c73pz7dD1qN0TpHyNQRCUDJXrAAAAAAElFTkSuQmCC",_e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAjtJREFUOE/NlD9oFEEUxn9v9ghC0hpRUogIAUmniGAT/5Q2FrETPSNRJILg7RwimI0ox85eQFCEBGIUO1PYpFM0jSConQoBEZGgGPsgl+w+2eM2bC57SopAFqYZ3v7m+977ZoQt+GQLmGxPaBiGgYiMWWvXBHZUGoZhH3BERPYC+4F+4Keq/urt7b1RLpf/ZEBVHa9Wq0HWyg3QKIoGVPU8cA7wgK/pUtXPQJ8xZk+pVBpuNBqXUoUiEvi+P56fzTpo6+SbwHNg1lo7WzTITGEKXFlZeeB53tVCpa3CK8AFa+1cBgvD8LKIXAQOJkkyICJDeYVBEJS6u7s/qeoLa+1o+l9TqXNuBLhmjDlbqVQ+5ICjInIfOBPH8W9jzGCR5YmJiRNxHM+papgqzqDvgSlr7VTernPuO3An3c9bBt74vv+yrdaKyLDv+/1Sq9UGPc97nY9EVuycU2AQOA7cAm4Dr4D5TvVxHB9rKo2iaEFVp621Ln96FEUngaOqGmSxabVqsh3a2h+x1h5qQjNrae/yE4+iaCwDJkky73neTuBZe129Xk+H+BS4l7ZqLVIZ2BhzuFKpvMsDVXXWGPMxFdAedOfcKeCRqj7MYrUhpz09PfXl5eXrectFWXXODQHpOq2qd/95o/JXr6ura3J1dXU6SZIfwKKIHAD2tVYMPBGRx77vN10UXtO85fTkmZmZHUtLSzUR2QXsBhaAL6r6DXhbrVYXi1yss59GqOgub/bN3Z7v6X/tb9Zmp/q/kN8s+lJb8oEAAAAASUVORK5CYII=";/*!simple-panzoom v1.0.72024年8月Sat Aug 10 2024 16:04:04 GMT+0800 (中国标准时间)制作*/typeof window<"u"&&(window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach),typeof window.CustomEvent!="function"&&(window.CustomEvent=function(e,t){t=t||{bubbles:!1,cancelable:!1,detail:null};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}));function Ne(e,t){let n=e.length;for(;n--;)if(e[n].pointerId===t.pointerId)return n;return-1}function Ee(e,t){let n;if(t.touches){n=0;for(const o of t.touches)o.pointerId=n++,Ee(e,o);return}n=Ne(e,t),n>-1&&e.splice(n,1),e.push(t)}function et(e,t){if(t.touches){for(;e.length;)e.pop();return}const n=Ne(e,t);n>-1&&e.splice(n,1)}function Te(e){e=e.slice(0);let t=e.pop(),n;for(;n=e.pop();)t={clientX:(n.clientX-t.clientX)/2+t.clientX,clientY:(n.clientY-t.clientY)/2+t.clientY};return t}function ge(e){if(e.length<2)return 0;const t=e[0],n=e[1];return Math.sqrt(Math.pow(Math.abs(n.clientX-t.clientX),2)+Math.pow(Math.abs(n.clientY-t.clientY),2))}let se={down:"mousedown",move:"mousemove",up:"mouseup mouseleave"};typeof window<"u"&&(typeof window.PointerEvent=="function"?se={down:"pointerdown",move:"pointermove",up:"pointerup pointerleave pointercancel"}:typeof window.TouchEvent=="function"&&(se={down:"touchstart",move:"touchmove",up:"touchend touchcancel"}));function we(e,t,n,o){se[e].split(" ").forEach(r=>{t.addEventListener(r,n,o)})}function ye(e,t,n){se[e].split(" ").forEach(o=>{t.removeEventListener(o,n)})}const tt=typeof document<"u"&&!!document.documentMode;let Oe;function nt(){return Oe||(Oe=document.createElement("div").style)}const Pe=["webkit","moz","ms"],ie={};function Me(e){if(ie[e])return ie[e];const t=nt();if(e in t)return ie[e]=e;const n=e[0].toUpperCase()+e.slice(1);let o=Pe.length;for(;o--;){const r=`${Pe[o]}${n}`;if(r in t)return ie[e]=r}}function le(e,t){return parseFloat(t[Me(e)])||0}function ce(e,t,n=window.getComputedStyle(e)){const o=t==="border"?"Width":"";return{left:le(`${t}Left${o}`,n),right:le(`${t}Right${o}`,n),top:le(`${t}Top${o}`,n),bottom:le(`${t}Bottom${o}`,n)}}function J(e,t,n){e.style[Me(t)]=n}function ot(e,t){const n=Me("transform");J(e,"transition",`${n} ${t.duration}ms ${t.easing}`)}function at(e,{x:t,y:n,scale:o,isSVG:r},l){if(J(e,"transform",`scale(${o}) translate(${t}px, ${n}px)`),r&&tt){const d=window.getComputedStyle(e).getPropertyValue("transform");e.setAttribute("transform",d)}}function ue(e){const t=e.parentNode,n=window.getComputedStyle(e),o=window.getComputedStyle(t),r=e.getBoundingClientRect(),l=t.getBoundingClientRect();return{elem:{style:n,width:r.width,height:r.height,top:r.top,bottom:r.bottom,left:r.left,right:r.right,margin:ce(e,"margin",n),border:ce(e,"border",n)},parent:{style:o,width:l.width,height:l.height,top:l.top,bottom:l.bottom,left:l.left,right:l.right,padding:ce(t,"padding",o),border:ce(t,"border",o)}}}function st(e){let t=e;for(;t&&t.parentNode;){if(t.parentNode===document)return!0;t=t.parentNode instanceof ShadowRoot?t.parentNode.host:t.parentNode}return!1}function rt(e){return(e.getAttribute("class")||"").trim()}function it(e,t){return e.nodeType===1&&` ${rt(e)} `.indexOf(` ${t} `)>-1}function lt(e,t){for(let n=e;n!=null;n=n.parentNode)if(it(n,t.excludeClass)||t.exclude.indexOf(n)>-1)return!0;return!1}const ct=/^http:[\w\.\/]+svg$/;function ut(e){return ct.test(e.namespaceURI)&&e.nodeName.toLowerCase()!=="svg"}function dt(e){const t={};for(const n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}const Ue={animate:!1,canvas:!1,cursor:"move",disablePan:!1,disableZoom:!1,disableXAxis:!1,disableYAxis:!1,duration:200,easing:"ease-in-out",exclude:[],excludeClass:"panzoom-exclude",handleStartEvent:e=>{e.preventDefault(),e.stopPropagation()},maxScale:4,minScale:.125,overflow:"hidden",panOnlyWhenZoomed:!1,pinchAndPan:!1,relative:!1,setTransform:at,startX:0,startY:0,startScale:1,step:.3,touchAction:"none"};function Ye(e,t){if(!e)throw new Error("Panzoom requires an element as an argument");if(e.nodeType!==1)throw new Error("Panzoom requires an element with a nodeType of 1");if(!st(e))throw new Error("Panzoom should be called on elements that have been attached to the DOM");t={...Ue,...t};const n=ut(e),o=e.parentNode;o.style.overflow=t.overflow,o.style.userSelect="none",o.style.touchAction=t.touchAction,(t.canvas?o:e).style.cursor=t.cursor,e.style.userSelect="none",e.style.touchAction=t.touchAction,J(e,"transformOrigin",typeof t.origin=="string"?t.origin:n?"0 0":"50% 50%");function r(){o.style.overflow="",o.style.userSelect="",o.style.touchAction="",o.style.cursor="",e.style.cursor="",e.style.userSelect="",e.style.touchAction="",J(e,"transformOrigin","")}function l(a={}){for(const c in a)a.hasOwnProperty(c)&&(t[c]=a[c]);(a.hasOwnProperty("cursor")||a.hasOwnProperty("canvas"))&&(o.style.cursor=e.style.cursor="",(t.canvas?o:e).style.cursor=t.cursor),a.hasOwnProperty("overflow")&&(o.style.overflow=a.overflow),a.hasOwnProperty("touchAction")&&(o.style.touchAction=a.touchAction,e.style.touchAction=a.touchAction)}let d=0,f=0,u=1,R=!1;w(t.startScale,{animate:!1,force:!0}),setTimeout(()=>{m(t.startX,t.startY,{animate:!1,force:!0})});function M(a,c,p){if(p.silent)return;const A=new CustomEvent(a,{detail:c});e.dispatchEvent(A)}function E(a,c,p){const A={x:d,y:f,scale:u,isSVG:n,originalEvent:p,dimsOut:{}};typeof c.animate=="boolean"&&(c.animate?ot(e,c):J(e,"transition","none")),c.setTransform(e,A,c);function i(){const b=ue(e);A.dimsOut=b,M(a,A,c),M("panzoomchange",A,c)}return c.animate?setTimeout(()=>{i()},c.duration+50):requestAnimationFrame(()=>{i()}),A}function L(a,c,p,A){const i={...t,...A},b={x:d,y:f,opts:i};if(!i.force&&(i.disablePan||i.panOnlyWhenZoomed&&u===i.startScale))return b;if(a=parseFloat(a),c=parseFloat(c),i.disableXAxis||(b.x=(i.relative?d:0)+a),i.disableYAxis||(b.y=(i.relative?f:0)+c),i.contain){const h=ue(e),I=h.elem.width/u,D=h.elem.height/u,oe=I*p,ae=D*p,q=(oe-I)/2,Z=(ae-D)/2;if(i.contain==="inside"){const pe=(-h.elem.margin.left-h.parent.padding.left+q)/p,fe=(h.parent.width-oe-h.parent.padding.left-h.elem.margin.left-h.parent.border.left-h.parent.border.right+q)/p;b.x=Math.max(Math.min(b.x,fe),pe);const ve=(-h.elem.margin.top-h.parent.padding.top+Z)/p,me=(h.parent.height-ae-h.parent.padding.top-h.elem.margin.top-h.parent.border.top-h.parent.border.bottom+Z)/p;b.y=Math.max(Math.min(b.y,me),ve)}else if(i.contain==="outside"){const pe=(-(oe-h.parent.width)-h.parent.padding.left-h.parent.border.left-h.parent.border.right+q)/p,fe=(q-h.parent.padding.left)/p;b.x=Math.max(Math.min(b.x,fe),pe);const ve=(-(ae-h.parent.height)-h.parent.padding.top-h.parent.border.top-h.parent.border.bottom+Z)/p,me=(Z-h.parent.padding.top)/p;b.y=Math.max(Math.min(b.y,me),ve)}}return i.roundPixels&&(b.x=Math.round(b.x),b.y=Math.round(b.y)),b}function S(a,c){const p={...t,...c},A={scale:u,opts:p};if(!p.force&&p.disableZoom)return A;let i=t.minScale,b=t.maxScale;if(p.contain){const h=ue(e),I=h.elem.width/u,D=h.elem.height/u;if(I>1&&D>1){const oe=h.parent.width-h.parent.border.left-h.parent.border.right,ae=h.parent.height-h.parent.border.top-h.parent.border.bottom,q=oe/I,Z=ae/D;t.contain==="inside"?b=Math.min(b,q,Z):t.contain==="outside"&&(i=Math.max(i,q,Z))}}return A.scale=Math.min(Math.max(a,i),b),A}function m(a,c,p,A){const i=L(a,c,u,p);return d!==i.x||f!==i.y?(d=i.x,f=i.y,E("panzoompan",i.opts,A)):{x:d,y:f,scale:u,isSVG:n,originalEvent:A}}function w(a,c,p){const A=S(a,c),i=A.opts;if(!i.force&&i.disableZoom)return;a=A.scale;let b=d,h=f;if(i.focal){const D=i.focal;b=(D.x/a-D.x/u+d*a)/a,h=(D.y/a-D.y/u+f*a)/a}const I=L(b,h,a,{relative:!1,force:!0});return d=I.x,f=I.y,u=a,E("panzoomzoom",i,p)}function T(a,c){const p={...t,animate:!0,...c};return w(u*Math.exp((a?1:-1)*p.step),p)}function v(a){return T(!0,a)}function k(a){return T(!1,a)}function g(a,c,p,A){const i=ue(e),b={width:i.parent.width-i.parent.padding.left-i.parent.padding.right-i.parent.border.left-i.parent.border.right,height:i.parent.height-i.parent.padding.top-i.parent.padding.bottom-i.parent.border.top-i.parent.border.bottom};let h=c.clientX-i.parent.left-i.parent.padding.left-i.parent.border.left-i.elem.margin.left,I=c.clientY-i.parent.top-i.parent.padding.top-i.parent.border.top-i.elem.margin.top;n||(h-=i.elem.width/u/2,I-=i.elem.height/u/2);const D={x:h/b.width*(b.width*a),y:I/b.height*(b.height*a)};return w(a,{...p,animate:!1,focal:D},A)}function B(a,c){a.preventDefault();const p={...t,...c,animate:!1},A=(a.deltaY===0&&a.deltaX?a.deltaX:a.deltaY)<0?1:-1,i=S(u*Math.exp(A*p.step/3),p).scale;return g(i,a,p,a)}function W(a){const c={...t,animate:!0,force:!0,...a};u=S(c.startScale,c).scale;const p=L(c.startX,c.startY,u,c);return d=p.x,f=p.y,E("panzoomreset",c)}let X,x,y,z,C,N;const U=[];function H(a){if(lt(a.target,t))return;Ee(U,a),R=!0,t.handleStartEvent(a),X=d,x=f,M("panzoomstart",{x:d,y:f,scale:u,isSVG:n,originalEvent:a},t);const c=Te(U);y=c.clientX,z=c.clientY,C=u,N=ge(U)}function G(a){if(!R||X===void 0||x===void 0||y===void 0||z===void 0)return;Ee(U,a);const c=Te(U),p=U.length>1;let A=u;if(p){N===0&&(N=ge(U));const i=ge(U)-N;A=S(i*t.step/80+C).scale,g(A,c,{animate:!1},a)}(!p||t.pinchAndPan)&&m(X+(c.clientX-y)/A,x+(c.clientY-z)/A,{animate:!1},a)}function Q(a){U.length===1&&M("panzoomend",{x:d,y:f,scale:u,isSVG:n,originalEvent:a},t),et(U,a),R&&(R=!1,X=x=y=z=void 0)}let ne=!1;function s(){ne||(ne=!0,we("down",t.canvas?o:e,H),we("move",document,G,{passive:!0}),we("up",document,Q,{passive:!0}))}function O(){ne=!1,ye("down",t.canvas?o:e,H),ye("move",document,G),ye("up",document,Q)}return t.noBind||s(),{bind:s,destroy:O,eventNames:se,getPan:()=>({x:d,y:f}),getScale:()=>u,getOptions:()=>dt(t),handleDown:H,handleMove:G,handleUp:Q,pan:m,reset:W,resetStyle:r,setOptions:l,setStyle:(a,c)=>J(e,a,c),zoom:w,zoomIn:v,zoomOut:k,zoomToPoint:g,zoomWithWheel:B}}Ye.defaultOptions=Ue;const ht={class:"sketch-ruler"},ft=he({__name:"index",props:{showRuler:{type:Boolean,default:!0},eyeIcon:{},closeEyeIcon:{},scale:{default:1},rate:{default:1},thick:{default:16},palette:{},width:{default:1400},height:{default:800},paddingRatio:{default:.2},autoCenter:{type:Boolean,default:!0},shadow:{default:()=>({x:0,y:0,width:0,height:0})},lines:{default:()=>({h:[],v:[]})},isShowReferLine:{type:Boolean,default:!0},canvasWidth:{default:700},canvasHeight:{default:700},snapsObj:{default:()=>({h:[],v:[]})},snapThreshold:{default:5},gridRatio:{default:1},lockLine:{type:Boolean,default:!1},selfHandle:{type:Boolean,default:!1},showShadowText:{type:Boolean,default:!0},panzoomOption:{}},emits:["onCornerClick","update:scale","zoomchange","update:lockLine"],setup(e,{expose:t,emit:n}){He(s=>({"6372c7a1":ne.value}));const o=e,r=n,l=Y(null),d=Y(0),f=Y(0);let u=0,R=0;const M=Y(1),E=Y(o.isShowReferLine),L=Y(null),S=Y("defaultCursor"),m=V(()=>({bgColor:"#f6f7f9",longfgColor:"#BABBBC",fontColor:"#7D8694",fontShadowColor:"#106ebe",shadowColor:"#e9f7fe",lineColor:"#51d6a9",lineType:"solid",lockLineColor:"#d4d7dc",hoverBg:"#000",hoverColor:"#fff",borderColor:"#eeeeef",...o.palette})),w=V(()=>({backgroundImage:E.value?`url(${o.eyeIcon??Je})`:`url(${o.closeEyeIcon??_e})`,width:o.thick+"px",height:o.thick+"px",borderRight:`1px solid ${m.value.borderColor}`,borderBottom:`1px solid ${m.value.borderColor}`})),T=V(()=>({background:m.value.bgColor,width:v.value+"px",height:k.value+"px"})),v=V(()=>o.width-o.thick),k=V(()=>o.height-o.thick),g=s=>{var O;(s.ctrlKey||s.metaKey)&&((O=L.value)==null||O.zoomWithWheel(s))},B=s=>{var O;s.key===" "&&(S.value="grabCursor",(O=L.value)==null||O.bind(),s.preventDefault())},W=s=>{var O;s.key===" "&&((O=L.value)==null||O.destroy(),S.value="defaultCursor")};ke(()=>{if(y(),!o.selfHandle&&l.value){const s=l.value.parentElement;if(!s)return;s.addEventListener("wheel",g),document.addEventListener("keydown",B),document.addEventListener("keyup",W)}});const X=s=>({noBind:!0,startScale:s,startX:u,startY:R,smoothScroll:!0,canvas:!0,...o.panzoomOption}),x=s=>{const{scale:O,dimsOut:a}=s.detail;if(a){r("update:scale",O),M.value=O;const c=(a.parent.left-a.elem.left)/O,p=(a.parent.top-a.elem.top)/O;d.value=c,r("zoomchange",s.detail),f.value=p}},y=()=>{if(l.value=document.querySelector(".canvasedit"),l.value){let s=o.scale;o.autoCenter&&(s=z()),L.value=Ye(l.value,X(s)),l.value&&l.value.addEventListener("panzoomchange",x)}},z=()=>{const s=v.value*(1-o.paddingRatio)/o.canvasWidth,O=k.value*(1-o.paddingRatio)/o.canvasHeight,a=Math.min(s,O);return u=v.value/2-o.canvasWidth/2,a<1?R=(o.canvasHeight*a/2-o.canvasHeight/2)/a-(o.canvasHeight*a-k.value)/a/2:a>1?R=(o.canvasHeight*a-o.canvasHeight)/2/a+(k.value-o.canvasHeight*a)/a/2:R=0,a},C=()=>{var s;return(s=L.value)==null?void 0:s.reset()},N=()=>{var s;return(s=L.value)==null?void 0:s.zoomIn()},U=()=>{var s;return(s=L.value)==null?void 0:s.zoomOut()},H=()=>{var s;(s=L.value)==null||s.setOptions(X(o.scale))},G=()=>{E.value=!E.value,r("onCornerClick",E.value)},Q=s=>{r("update:lockLine",s)},ne=V(()=>o.thick+"px");return j([()=>o.isShowReferLine],()=>{E.value=o.isShowReferLine}),j([()=>o.canvasWidth,()=>o.canvasHeight,()=>o.width,()=>o.height],()=>{y()}),j(()=>o.panzoomOption,()=>{H()},{deep:!0}),t({initPanzoom:y,panzoomInstance:L,reset:C,zoomIn:N,zoomOut:U,cursorClass:S}),(s,O)=>(K(),F("div",ht,[Be(s.$slots,"btn",{reset:C,zoomIn:N,zoomOut:U}),te("div",{class:Ae(["canvasedit-parent",S.value]),style:$(T.value)},[te("div",{class:Ae(["canvasedit",S.value])},[Be(s.$slots,"default")],2)],6),_(Se(Re,{style:$({marginLeft:s.thick+"px",width:v.value+"px"}),vertical:!1,width:s.width,height:s.thick,"is-show-refer-line":E.value,thick:s.thick,start:d.value,"start-other":f.value,lines:s.lines,"select-start":s.shadow.x,"snap-threshold":s.snapThreshold,"snaps-obj":s.snapsObj,"select-length":s.shadow.width,scale:M.value,palette:m.value,"canvas-width":s.canvasWidth,"show-shadow-text":s.showShadowText,"canvas-height":s.canvasHeight,rate:s.rate,"grid-ratio":s.gridRatio,"lock-line":s.lockLine,onChangeLineState:Q},null,8,["style","width","height","is-show-refer-line","thick","start","start-other","lines","select-start","snap-threshold","snaps-obj","select-length","scale","palette","canvas-width","show-shadow-text","canvas-height","rate","grid-ratio","lock-line"]),[[ee,s.showRuler]]),_(Se(Re,{style:$({marginTop:s.thick+"px",top:0,height:k.value+"px"}),vertical:!0,width:s.thick,height:s.height,"is-show-refer-line":E.value,thick:s.thick,start:f.value,"start-other":d.value,lines:s.lines,"select-start":s.shadow.y,"select-length":s.shadow.height,"snap-threshold":s.snapThreshold,"snaps-obj":s.snapsObj,scale:M.value,palette:m.value,"canvas-width":s.canvasWidth,"canvas-height":s.canvasHeight,"show-shadow-text":s.showShadowText,rate:s.rate,"grid-ratio":s.gridRatio,"lock-line":s.lockLine,onChangeLineState:Q},null,8,["style","width","height","is-show-refer-line","thick","start","start-other","lines","select-start","select-length","snap-threshold","snaps-obj","scale","palette","canvas-width","canvas-height","show-shadow-text","rate","grid-ratio","lock-line"]),[[ee,s.showRuler]]),_(te("a",{class:"corner",style:$(w.value),onClick:G},null,4),[[ee,s.showRuler]])]))}});export{ft as _};
