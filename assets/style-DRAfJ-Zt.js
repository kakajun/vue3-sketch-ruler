import{d as ie,r as O,c as N,p as we,G as Ee,b as D,q as K,x as ye,f as Z,H as $,k as ve,n as W,I as G,e as fe,o as H,y as ge,m as be,F as Oe,s as Ue,u as U,t as ke,a as Xe,g as le,j as Ne,J as Ye}from"./index-D3Mk6K2d.js";const Pe=e=>e<=.25?40:e<=.5?20:e<=1?10:e<=2?5:e<=4?2:1;function He(e,a,t,o,c,i){i?c.moveTo(e,0):c.moveTo(0,e),c.save(),i?c.translate(e+5,o*.2):c.translate(t*.1,e+32),i||c.rotate(-Math.PI/2),c.fillText(Math.round(a).toString(),4,7),c.restore(),i?c.lineTo(e,o):c.lineTo(t,e),c.stroke(),c.closePath(),c.setTransform(1,0,0,1,0,0)}function oe(e,a,t,o,c,i){o.fillStyle=c.fontShadowColor,o.strokeStyle=c.longfgColor,o.save(),o.translate(e,a),i||o.rotate(-Math.PI/2),o.font="bold 12px  Aria",o.fillText(String(t),0,0),o.restore()}const We=(e,a,t,o,c,i)=>{const{scale:v,width:h,height:w,ratio:B,palette:S,gridRatio:E,showShadowText:T}=c,{bgColor:f,fontColor:u,shadowColor:y,longfgColor:M}=S,A=i?c.canvasWidth:c.canvasHeight;e.setTransform(1,0,0,1,0,0),e.scale(B,B),e.clearRect(0,0,h,w),e.fillStyle=f,e.fillRect(0,0,h,w);const m=Pe(v)*E*10,x=m*v,k=Math.floor(a/m)*m,R=(k-a)/m*x,z=a+Math.ceil((i?h:w)/v);if(o){const g=(t-a)*v,L=o*v;if(e.fillStyle=y,i?e.fillRect(g,0,L,w):e.fillRect(0,g,h,L),T)if(i){oe(g,w*.4,Math.round(t),e,S,i);const b=(t+o-a)*v;oe(b,w*.4,Math.round(t+o),e,S,i)}else{oe(h*.4,g,Math.round(t),e,S,i);const b=(t+o-a)*v;oe(h*.4,b,Math.round(t+o),e,S,i)}}e.beginPath(),e.fillStyle=u,e.strokeStyle=M;for(let g=k,L=0;g<z;g+=m,L++){const b=R+L*x+.5;if(g-m<A&&g>A||g==A){const P=R+L*x+.5+(A-g)*v;He(P,A,h,w,e,i);return}g>=0&&g<=A&&(g==0?i?(e.moveTo(b,0),e.lineTo(b,w)):(e.moveTo(0,b),e.lineTo(h,b)):i?(e.moveTo(b,20),e.lineTo(b,w/1.3)):(e.moveTo(20,b),e.lineTo(h/1.3,b)),e.save(),g==0?i?e.translate(b-15,w*.01):e.translate(h*.3,b-5):i?e.translate(b-12,w*.05):e.translate(h*.05,b+12),i||e.rotate(-Math.PI/2),A-g>m/2&&(!T||o==0||Math.abs(g-t)>m/2&&Math.abs(g-(t+o))>m/2)&&e.fillText(g.toString(),4,9),e.restore())}e.stroke(),e.closePath()};function me(e,a=100){let t=null;const o=function(...c){t!==null&&clearTimeout(t),t=setTimeout(()=>{e(...c)},a)};return o.cancel=function(){t!==null&&(clearTimeout(t),t=null)},o}function Le(e,a){const t=O(0),o=O(0),c=O(!1),i=N(()=>({backgroundColor:e.palette.hoverBg,color:e.palette.hoverColor,[a?"top":"left"]:"-8px",[a?"left":"top"]:`${t.value+10}px`})),v=({offsetX:f,offsetY:u})=>{t.value=a?f:u},h=(f,u)=>new Promise(y=>{if(e.lockLine)return;const M=a?f.clientY:f.clientX;v(f);const A=u||o.value;let m=A;const x=R=>{let z=((a?R.clientY:R.clientX)-M)/e.scale+A,g=z;const L=(a?e.snapsObj.h:e.snapsObj.v).slice().sort((b,P)=>Math.abs(g-b)-Math.abs(g-P));L.length&&Math.abs(L[0]-z)<e.snapThreshold/e.scale&&(g=L[0],z=g),m=Math.round(z),o.value=m},k=()=>{document.removeEventListener("mousemove",x),w(m,e.index),y()};document.addEventListener("mousemove",x),document.addEventListener("mouseup",k,{once:!0})}),w=(f,u)=>{const y=a?e.lines?.h:e.lines?.v,M=B(f);if(y)if(M)if(typeof u=="number")y.splice(u,1);else return;else typeof u!="number"?y.push(f):y[u]=f},B=f=>{const u=a?e.canvasHeight:e.canvasWidth;return f<0||f>u},S=N(()=>B(o.value)?"放开删除":`${a?"Y":"X"}：${o.value*e.rate}`),E=me(()=>{c.value=!1},200),T=me(()=>{c.value=!0},200);return{showLabel:c,startValue:o,actionStyle:i,labelContent:S,handleMouseDown:h,handleMouseenter:f=>{e.lockLine||(v(f),T(),E.cancel())},handleMouseLeave:()=>{E()}}}const De={key:0,class:"value"},Ie=ie({__name:"ruler-line",props:{scale:{},palette:{},index:{},start:{},vertical:{type:Boolean},value:{},canvasWidth:{},canvasHeight:{},lines:{},isShowReferLine:{type:Boolean},rate:{},snapThreshold:{},snapsObj:{},lockLine:{type:Boolean}},setup(e){const a=e,t=O(!1),{actionStyle:o,handleMouseDown:c,labelContent:i,startValue:v,showLabel:h,handleMouseenter:w,handleMouseLeave:B}=Le(a,a.vertical),S=N(()=>v.value>=a.start),E=N(()=>{const{lineType:f,lockLineColor:u,lineColor:y}=a.palette,M=a.lockLine?u:y??"black",A=a.lockLine||t.value?"none":"auto",m=a.isShowReferLine&&!a.lockLine?a.vertical?"ns-resize":"ew-resize":"default",x=a.vertical?"borderTop":"borderLeft",k=(v.value-a.start)*a.scale;return{[x]:`1px ${f} ${M}`,pointerEvents:A,cursor:m,[a.vertical?"top":"left"]:`${k}px`}});we(()=>{v.value=a.value??0});const T=me(()=>{t.value=!1},1e3);return K([()=>a.scale],()=>{t.value=!0,T()}),(f,u)=>$((H(),D("div",{class:"line",style:W(E.value),onMouseenter:u[0]||(u[0]=le((...y)=>U(w)&&U(w)(...y),["stop"])),onMouseleave:u[1]||(u[1]=le((...y)=>U(B)&&U(B)(...y),["stop"])),onMousedown:u[2]||(u[2]=le((...y)=>U(c)&&U(c)(...y),["stop"]))},[Z("div",{class:"action",style:W(U(o))},[U(h)?(H(),D("span",De,ke(U(i)),1)):ge("",!0)],4)],36)),[[G,S.value]])}}),Fe=ie({__name:"index",props:{scale:{},palette:{},vertical:{type:Boolean},showShadowText:{type:Boolean},start:{},width:{},height:{},selectStart:{},selectLength:{},canvasWidth:{},canvasHeight:{},rate:{},gridRatio:{}},emits:["handleDragStart"],setup(e,{emit:a}){const t=e,o=a,c=Xe({isDragging:!1,canvasContext:null});let i=window.devicePixelRatio;const v=O(null);we(()=>{window.addEventListener("resize",h),w(),S(i),E(i)});const h=()=>{i=window.devicePixelRatio,S(i),E(i)},w=()=>{c.canvasContext=v.value?.getContext("2d")||null},B=N(()=>({width:t.width+"px",height:t.height+"px",cursor:t.vertical?"ew-resize":"ns-resize",[t.vertical?"borderRight":"borderBottom"]:`1px solid ${t.palette.borderColor||"#eeeeef"} `}));Ee(()=>{window.removeEventListener("resize",h)});const S=f=>{if(v.value){v.value.width=Math.round(t.width*f),v.value.height=Math.round(t.height*f);const u=c.canvasContext;u&&(u.font=`11px -apple-system,
                "Helvetica Neue", ".SFNSText-Regular",
                "SF UI Text", Arial, "PingFang SC", "Hiragino Sans GB",
                "Microsoft YaHei", "WenQuanYi Zen Hei", sans-serif`,u.lineWidth=1,u.textBaseline="middle")}},E=f=>{const u={scale:t.scale,width:t.width,height:t.height,palette:t.palette,canvasWidth:t.canvasWidth,canvasHeight:t.canvasHeight,ratio:f,rate:t.rate,gridRatio:t.gridRatio,showShadowText:t.showShadowText};u.scale=t.scale/t.rate,u.canvasWidth=t.canvasWidth*t.rate,u.canvasHeight=t.canvasHeight*t.rate,c.canvasContext&&We(c.canvasContext,t.start*t.rate,t.selectStart,t.selectLength,u,!t.vertical)};K([()=>t.width,()=>t.height,()=>t.start,()=>t.palette,()=>t.selectStart,()=>t.selectLength],()=>{E(i)}),K([()=>t.width,()=>t.height],()=>{S(i)});const T=f=>{o("handleDragStart",f)};return(f,u)=>(H(),D("canvas",{ref_key:"canvas",ref:v,class:"ruler",style:W(B.value),onMousedown:le(T,["stop"])},null,36))}}),Qe={class:"lines"},Ke={key:0,class:"value"},xe=ie({__name:"ruler-wrapper",props:{scale:{},thick:{},canvasWidth:{},canvasHeight:{},palette:{},vertical:{type:Boolean},width:{},height:{},start:{},startOther:{},lines:{},selectStart:{},selectLength:{},isShowReferLine:{type:Boolean},rate:{},snapThreshold:{},snapsObj:{},gridRatio:{},lockLine:{type:Boolean},showShadowText:{type:Boolean}},emits:["changeLineState"],setup(e,{emit:a}){const t=e,{showLabel:o,actionStyle:c,handleMouseenter:i,handleMouseLeave:v,handleMouseDown:h,labelContent:w,startValue:B}=Le(t,!t.vertical),S=O(!1),E=O(!1),T=N(()=>t.vertical?"v-container":"h-container"),f=a,u=N(()=>t.vertical?t.lines?.h:t.lines?.v),y=N(()=>{const A=t.palette.lineType;let m=t.vertical?"left":"top",x=t.vertical?"top":"left",k=t.vertical?"borderLeft":"borderBottom";const R=(B.value-t.startOther)*t.scale+t.thick;return{[m]:R+"px",[x]:-t.thick+"px",cursor:t.vertical?"ew-resize":"ns-resize",[k]:`1px ${A} ${t.palette.lineColor}`}}),M=async A=>{const{offsetX:m,offsetY:x}=A,{scale:k,vertical:R,thick:z,startOther:g}=t;if(!S.value){E.value=!0,f("changeLineState",!1);let L=Math.round(g-z/k+(R?m:x)/k);B.value=L,await h(A,L),E.value=!1}};return K([()=>t.lockLine],()=>{S.value=t.lockLine}),(A,m)=>(H(),D("div",{class:ve(T.value)},[fe(Fe,be(A.$props,{onHandleDragStart:M}),null,16),$(Z("div",Qe,[(H(!0),D(Oe,null,Ue(u.value,(x,k)=>(H(),Ne(Ie,be({key:x+k,index:k,value:x>>0},{ref_for:!0},A.$props),null,16,["index","value"]))),128))],512),[[G,e.isShowReferLine]]),e.isShowReferLine?$((H(),D("div",{key:0,class:"indicator",style:W(y.value),onMouseenter:m[0]||(m[0]=(...x)=>U(i)&&U(i)(...x)),onMouseleave:m[1]||(m[1]=(...x)=>U(v)&&U(v)(...x))},[Z("div",{class:"action",style:W(U(c))},[U(o)?(H(),D("span",Ke,ke(U(w)),1)):ge("",!0)],4)],36)),[[G,E.value]]):ge("",!0)],2))}}),Ve="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAopJREFUOE/FlE9IVEEcx7+/N9ouds1Mu0QUSFZYdIgoUqQoKPBQHsKozpXE7jbTO/U8xLJvn6usBHWQ6hBFXupSkQeVbh0KJEPp0sH+eLGTsKs77xcj78m0ax0E8cHjzZv5zef3/c33xxA24KENYGJzoEEQbNNaN4Zh2OQ4znwYhr9c1/39vwrXVDo0NNS0tLR0GYB5D64BmAMwzMyvlFKz1es10Hw+f4mZ7wHYBeA9gNdENFepVOaEEM3M3OI4Thczn41gt6WUgQ3+C+r7/h0AWQD3mXnYqPA8L9nQ0HCemduIaFpKOWoAhUJhT6VSuQXgOjP3K6W8GLwKzeVyp4jonR0QBEErM48w8zFLyayUsjX+z+VyHhHdZebTSqkxM78CHRgYOKS1/ghgVErZY214RkQ7ADyRUj72ff8qgCtmXUrZGcf5vv8CwEUhxOF0Ov1pBRpla5dSdseBhUJhpznH6tIsZb1KqacW+BGArUaUXX63UuplHJTNZjuEEONSyhozfd/n6mQ1RkXZL2itz7mu+80EDA4ONi8vL/8AcM2UbikyR2BU9cSmmTU70YqKIAj2hWFo2uenlHK/BRg3Y2aeNO5GyU8S0ZbFxcUuz/NKEXAGQKPjOCcymcyX1dIi8DSAiWQyeaavr68cbSgCuBknYubnQoj+TCYzUywWE6VS6S2ADsdx2gxw1X3L7SNENMbMnwE8qK+vf5NKpRaMaeVyeW8ikfiaSqW+R7BuZr5BRMe11p2u607U9Gk8kc/ntzPzQwCmExYATDLzVBiGE0KIowAOADDf3QA+aK2VDaxRajto3K+rq+tl5nYAzQBamHmeiOYBTGmtR6ph/1Rqg9c73pz7dD1qN0TpHyNQRCUDJXrAAAAAAElFTkSuQmCC",qe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAjtJREFUOE/NlD9oFEEUxn9v9ghC0hpRUogIAUmniGAT/5Q2FrETPSNRJILg7RwimI0ox85eQFCEBGIUO1PYpFM0jSConQoBEZGgGPsgl+w+2eM2bC57SopAFqYZ3v7m+977ZoQt+GQLmGxPaBiGgYiMWWvXBHZUGoZhH3BERPYC+4F+4Keq/urt7b1RLpf/ZEBVHa9Wq0HWyg3QKIoGVPU8cA7wgK/pUtXPQJ8xZk+pVBpuNBqXUoUiEvi+P56fzTpo6+SbwHNg1lo7WzTITGEKXFlZeeB53tVCpa3CK8AFa+1cBgvD8LKIXAQOJkkyICJDeYVBEJS6u7s/qeoLa+1o+l9TqXNuBLhmjDlbqVQ+5ICjInIfOBPH8W9jzGCR5YmJiRNxHM+papgqzqDvgSlr7VTernPuO3An3c9bBt74vv+yrdaKyLDv+/1Sq9UGPc97nY9EVuycU2AQOA7cAm4Dr4D5TvVxHB9rKo2iaEFVp621Ln96FEUngaOqGmSxabVqsh3a2h+x1h5qQjNrae/yE4+iaCwDJkky73neTuBZe129Xk+H+BS4l7ZqLVIZ2BhzuFKpvMsDVXXWGPMxFdAedOfcKeCRqj7MYrUhpz09PfXl5eXrectFWXXODQHpOq2qd/95o/JXr6ura3J1dXU6SZIfwKKIHAD2tVYMPBGRx77vN10UXtO85fTkmZmZHUtLSzUR2QXsBhaAL6r6DXhbrVYXi1yss59GqOgub/bN3Z7v6X/tb9Zmp/q/kN8s+lJb8oEAAAAASUVORK5CYII=";function Be(e,a){let t=e.length;for(;t--;)if(e[t].pointerId===a.pointerId)return t;return-1}function Ae(e,a){const t=Be(e,a);t>-1&&e.splice(t,1),e.push(a)}function je(e,a){const t=Be(e,a);t>-1&&e.splice(t,1)}function Se(e){const a=e.slice(0);let t=a.pop(),o;for(;o=a.pop();)t={clientX:(o.clientX-t.clientX)/2+t.clientX,clientY:(o.clientY-t.clientY)/2+t.clientY};return t}var Te={down:"pointerdown",move:"pointermove",up:"pointerup pointerleave pointercancel"};function de(e,a,t,o){Te[e].split(" ").forEach(c=>{a.addEventListener(c,t,o)})}function pe(e,a,t){Te[e].split(" ").forEach(o=>{a.removeEventListener(o,t)})}var Ce=["webkit","moz","ms"],ne={};function Ze(){return document.createElement("div").style}function Me(e){if(ne[e])return ne[e];const a=Ze();if(e in a)return ne[e]=e;const t=e[0].toUpperCase()+e.slice(1);for(let o=Ce.length-1;o>=0;o--){const c=`${Ce[o]}${t}`;if(c in a)return ne[e]=c}return e}function j(e,a,t){e.style[Me(a)]=t}function $e(e,a){const t=Me("transform");j(e,"transition",`${t} ${a.duration}ms ${a.easing}`)}function Ge(e,{x:a,y:t,scale:o},c){j(e,"transform",`scale(${o}) translate(${a}px, ${t}px)`)}function re(e,a,t=window.getComputedStyle(e)){const o=a==="border"?"Width":"";return{left:parseFloat(t[`${a}Left${o}`])||0,right:parseFloat(t[`${a}Right${o}`])||0,top:parseFloat(t[`${a}Top${o}`])||0,bottom:parseFloat(t[`${a}Bottom${o}`])||0}}function Je(e){const a=e.parentNode,t=e.getBoundingClientRect(),o=a.getBoundingClientRect();return{elem:{width:t.width,height:t.height,left:t.left,top:t.top},parent:{width:o.width,height:o.height,left:o.left,top:o.top}}}function q(e){const a=e.parentNode,t=window.getComputedStyle(e),o=window.getComputedStyle(a),c=e.getBoundingClientRect(),i=a.getBoundingClientRect();return{elem:{width:c.width,height:c.height,left:c.left,top:c.top,margin:re(e,"margin",t),border:re(e,"border",t)},parent:{width:i.width,height:i.height,left:i.left,top:i.top,padding:re(a,"padding",o),border:re(a,"border",o)}}}function _e(e){let a=e;for(;a&&a.parentNode;){if(a.parentNode===document)return!0;a=a.parentNode instanceof ShadowRoot?a.parentNode.host:a.parentNode}return!1}function et(e){const a={};for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(a[t]=e[t]);return a}var Re={animate:!1,canvas:!1,cursor:"move",disablePan:!1,disableZoom:!1,duration:200,easing:"ease-in-out",handleStartEvent:e=>{e.preventDefault(),e.stopPropagation()},maxScale:4,minScale:.125,overflow:"hidden",setTransform:Ge,startX:0,startY:0,startScale:1,step:.3,touchAction:"none",origin:"50% 50%"};function ze(e,a){if(!e||e.nodeType!==1)throw new Error("Panzoom requires an element");if(!_e(e))throw new Error("Panzoom should be called on attached elements");a={...Re,...a};const t=e.parentNode;t.style.overflow=a.overflow,t.style.userSelect="none",t.style.touchAction=a.touchAction,(a.canvas?t:e).style.cursor=a.cursor,e.style.userSelect="none",e.style.touchAction=a.touchAction,j(e,"transformOrigin",typeof a.origin=="string"?a.origin:"50% 50%");function o(){t.style.overflow="",t.style.userSelect="",t.style.touchAction="",t.style.cursor="",e.style.cursor="",e.style.userSelect="",e.style.touchAction="",j(e,"transformOrigin","")}function c(r={}){for(const d in r)Object.prototype.hasOwnProperty.call(r,d)&&(a[d]=r[d]);(r.hasOwnProperty("cursor")||r.hasOwnProperty("canvas"))&&(t.style.cursor=e.style.cursor="",(a.canvas?t:e).style.cursor=a.cursor),r.hasOwnProperty("overflow")&&(t.style.overflow=r.overflow),r.hasOwnProperty("touchAction")&&(t.style.touchAction=r.touchAction,e.style.touchAction=r.touchAction)}let i=0,v=0,h=1,w=!1;u(a.startScale,{animate:!1,force:!0}),setTimeout(()=>{f(a.startX,a.startY,{animate:!1,force:!0})});function B(r,d){if(d.silent)return;const l=new CustomEvent("panzoomchange",{detail:r});e.dispatchEvent(l)}function S(r,d){const l={x:i,y:v,scale:h};typeof r.animate=="boolean"&&(r.animate?$e(e,r):j(e,"transition","none")),r.setTransform(e,l,r);const C=()=>{const n=r.contain&&r.contain!=="none"?q(e):Je(e);B({x:i,y:v,scale:h,dimsOut:n,originalEvent:d},r)};return r.animate?setTimeout(C,r.duration+50):requestAnimationFrame(C),l}function E(r,d,l,C){const n={...a,...C},p={x:i,y:v,opts:n};if(!n.force&&n.disablePan===!0)return p;if(r=parseFloat(r),d=parseFloat(d),p.x=r,p.y=d,n.contain&&n.contain!=="none"){const s=q(e),Y=s.elem.width/h,X=s.elem.height/h,ee=Y*l,te=X*l,F=(ee-Y)/2,Q=(te-X)/2;if(n.contain==="inside"){const se=(-s.elem.margin.left-s.parent.padding.left+F)/l,ce=(s.parent.width-ee-s.parent.padding.left-s.elem.margin.left-s.parent.border.left-s.parent.border.right+F)/l;p.x=Math.max(Math.min(p.x,ce),se);const ue=(-s.elem.margin.top-s.parent.padding.top+Q)/l,he=(s.parent.height-te-s.parent.padding.top-s.elem.margin.top-s.parent.border.top-s.parent.border.bottom+Q)/l;p.y=Math.max(Math.min(p.y,he),ue)}else if(n.contain==="outside"){const se=(-(ee-s.parent.width)-s.parent.padding.left-s.parent.border.left-s.parent.border.right+F)/l,ce=(F-s.parent.padding.left)/l;p.x=Math.max(Math.min(p.x,ce),se);const ue=(-(te-s.parent.height)-s.parent.padding.top-s.parent.border.top-s.parent.border.bottom+Q)/l,he=(Q-s.parent.padding.top)/l;p.y=Math.max(Math.min(p.y,he),ue)}}return p}function T(r,d){const l={...a,...d},C={scale:h,opts:l};if(!l.force&&l.disableZoom)return C;let n=a.minScale,p=a.maxScale;if(l.contain&&l.contain!=="none"){const s=q(e),Y=s.elem.width/h,X=s.elem.height/h;if(Y>1&&X>1){const ee=s.parent.width-s.parent.border.left-s.parent.border.right,te=s.parent.height-s.parent.border.top-s.parent.border.bottom,F=ee/Y,Q=te/X;a.contain==="inside"?p=Math.min(p,F,Q):a.contain==="outside"&&(n=Math.max(n,F,Q))}}return C.scale=Math.min(Math.max(r,n),p),C}function f(r,d,l,C){const n=E(r,d,h,l);return i!==n.x||v!==n.y?(i=n.x,v=n.y,S(n.opts,C)):{x:i,y:v,scale:h}}function u(r,d,l){const C=T(r,d),n=C.opts;if(!n.force&&n.disableZoom)return{x:i,y:v,scale:h};r=C.scale;let p=i,s=v;if(n.focal){const X=n.focal;p=(X.x/r-X.x/h+i*r)/r,s=(X.y/r-X.y/h+v*r)/r}const Y=E(p,s,r,{relative:!1,force:!0});return i=Y.x,v=Y.y,h=r,S(n,l)}function y(r,d){const l={...a,animate:!0,...d};return u(h*Math.exp((r?1:-1)*l.step),l)}function M(r){const d={...a,animate:!0,...r};if(!d.focal){const l=q(e),C=l.parent.width-l.parent.border.left-l.parent.border.right,n=l.parent.height-l.parent.border.top-l.parent.border.bottom,p=l.parent.left+l.parent.border.left+l.parent.padding.left+C/2,s=l.parent.top+l.parent.border.top+l.parent.padding.top+n/2;return m(h*Math.exp(d.step),{clientX:p,clientY:s},d)}return y(!0,r)}function A(r){const d={...a,animate:!0,...r};if(!d.focal){const l=q(e),C=l.parent.width-l.parent.border.left-l.parent.border.right,n=l.parent.height-l.parent.border.top-l.parent.border.bottom,p=l.parent.left+l.parent.border.left+l.parent.padding.left+C/2,s=l.parent.top+l.parent.border.top+l.parent.padding.top+n/2;return m(h*Math.exp(-d.step),{clientX:p,clientY:s},d)}return y(!1,r)}function m(r,d,l,C){const n=q(e),p={width:n.parent.width-n.parent.padding.left-n.parent.padding.right-n.parent.border.left-n.parent.border.right,height:n.parent.height-n.parent.padding.top-n.parent.padding.bottom-n.parent.border.top-n.parent.border.bottom};let s=d.clientX-n.parent.left-n.parent.padding.left-n.parent.border.left-n.elem.margin.left,Y=d.clientY-n.parent.top-n.parent.padding.top-n.parent.border.top-n.elem.margin.top;a.origin!=="0 0"&&(s-=n.elem.width/h/2,Y-=n.elem.height/h/2);const X={x:s/p.width*(p.width*r),y:Y/p.height*(p.height*r)};return u(r,{...l,animate:!1,focal:X},C)}function x(r,d){r.preventDefault();const l={...a,...d,animate:!1},C=(r.deltaY===0&&r.deltaX?r.deltaX:r.deltaY)<0?1:-1,n=T(h*Math.exp(C*l.step/3),l).scale;return m(n,r,l,r)}function k(r){const d={...a,animate:!0,force:!0,...r};h=T(d.startScale,d).scale;const l=E(d.startX,d.startY,h,d);return i=l.x,v=l.y,S(d)}let R,z,g,L;const b=[];function P(r){Ae(b,r),w=!0,a.handleStartEvent(r),R=i,z=v;const d=Se(b);g=d.clientX,L=d.clientY}function I(r){if(!w||R===void 0||z===void 0||g===void 0||L===void 0)return;Ae(b,r);const d=Se(b),l=h;f(R+(d.clientX-g)/l,z+(d.clientY-L)/l,{animate:!1},r)}function J(r){je(b,r),w&&(w=!1,R=z=g=L=void 0)}let V=!1;function _(){V||(V=!0,de("down",a.canvas?t:e,P),de("move",document,I,{passive:!0}),de("up",document,J,{passive:!0}))}function ae(){V=!1,pe("down",a.canvas?t:e,P),pe("move",document,I),pe("up",document,J)}return a.noBind||_(),{bind:_,destroy:ae,getPan:()=>({x:i,y:v}),getScale:()=>h,getOptions:()=>et(a),handleDown:P,handleMove:I,handleUp:J,pan:f,reset:k,resetStyle:o,setOptions:c,setStyle:(r,d)=>j(e,r,d),zoom:u,zoomIn:M,zoomOut:A,zoomToPoint:m,zoomWithWheel:x}}ze.defaultOptions=Re;var tt=ze;const at={class:"sketch-ruler"},nt=ie({__name:"index",props:{showRuler:{type:Boolean,default:!0},eyeIcon:{},closeEyeIcon:{},scale:{default:1},rate:{default:1},thick:{default:16},palette:{},width:{default:1400},height:{default:800},paddingRatio:{default:.2},autoCenter:{type:Boolean,default:!0},shadow:{default:()=>({x:0,y:0,width:0,height:0})},lines:{default:()=>({h:[],v:[]})},isShowReferLine:{type:Boolean,default:!0},canvasWidth:{default:700},canvasHeight:{default:700},snapsObj:{default:()=>({h:[],v:[]})},snapThreshold:{default:5},gridRatio:{default:1},lockLine:{type:Boolean,default:!1},selfHandle:{type:Boolean,default:!1},showShadowText:{type:Boolean,default:!0},panzoomOption:{}},emits:["onCornerClick","update:scale","zoomchange","update:lockLine"],setup(e,{expose:a,emit:t}){Ye(n=>({cd22a430:o.canvasWidth+"px",v42212876:o.canvasHeight+"px",v5e5ebfa9:C.value}));const o=e,c=t,i=O(null),v=O(null),h=O(null),w=O(0),B=O(0);let S=0,E=0;const T=O(1),f=O(o.isShowReferLine),u=O(null),y=O("defaultCursor"),M=N(()=>({bgColor:"#f6f7f9",longfgColor:"#BABBBC",fontColor:"#7D8694",fontShadowColor:"#106ebe",shadowColor:"#e9f7fe",lineColor:"#51d6a9",lineType:"solid",lockLineColor:"#d4d7dc",hoverBg:"#000",hoverColor:"#fff",borderColor:"#eeeeef",...o.palette})),A=N(()=>({backgroundImage:f.value?`url(${o.eyeIcon??Ve})`:`url(${o.closeEyeIcon??qe})`,width:o.thick+"px",height:o.thick+"px",borderRight:`1px solid ${M.value.borderColor}`,borderBottom:`1px solid ${M.value.borderColor}`})),m=N(()=>({background:M.value.bgColor,width:x.value+"px",height:k.value+"px"})),x=N(()=>o.width-o.thick),k=N(()=>o.height-o.thick),R=n=>{(n.ctrlKey||n.metaKey)&&(n.preventDefault(),u.value?.zoomWithWheel(n))},z=n=>{const p=document.activeElement;p?.closest(".monaco-editor")||p?.tagName==="INPUT"||p?.tagName==="TEXTAREA"||p?.getAttribute("contenteditable")==="true"||n.key===" "&&(y.value="grabCursor",u.value?.bind(),n.preventDefault())},g=n=>{const p=document.activeElement;p?.closest(".monaco-editor")||p?.tagName==="INPUT"||p?.tagName==="TEXTAREA"||p?.getAttribute("contenteditable")==="true"||n.key===" "&&(u.value?.destroy(),y.value="defaultCursor")};function L(n){n.preventDefault(),n.stopPropagation(),u.value?.bind()}we(()=>{if(I(),!o.selfHandle&&i.value){const n=i.value.parentElement;if(!n)return;v.value=n,n.addEventListener("wheel",R,{passive:!1}),document.addEventListener("keydown",z),document.addEventListener("keyup",g),n.addEventListener("touchstart",L,{passive:!1})}}),Ee(()=>{v.value&&(v.value.removeEventListener("wheel",R),v.value.removeEventListener("touchstart",L)),document.removeEventListener("keydown",z),document.removeEventListener("keyup",g),h.value&&h.value.removeEventListener("panzoomchange",P),u.value?.destroy()});const b=n=>({noBind:!0,startScale:n,startX:S,startY:E,smoothScroll:!0,canvas:!0,...o.panzoomOption}),P=n=>{const{scale:p,dimsOut:s}=n.detail;if(s){c("update:scale",p),T.value=p;const Y=(s.parent.left-s.elem.left)/p,X=(s.parent.top-s.elem.top)/p;w.value=Y,c("zoomchange",n.detail),B.value=X}},I=()=>{if(h.value&&h.value.removeEventListener("panzoomchange",P),u.value?.destroy(),i.value=document.querySelector(".canvasedit"),i.value){let n=o.scale;o.autoCenter&&(n=J()),u.value=tt(i.value,b(n)),i.value.addEventListener("panzoomchange",P),h.value=i.value}},J=()=>{const n=x.value*(1-o.paddingRatio)/o.canvasWidth,p=k.value*(1-o.paddingRatio)/o.canvasHeight,s=Math.min(n,p);return S=(x.value-o.canvasWidth)/2/s,E=(k.value-o.canvasHeight)/2/s,s},V=()=>u.value?.reset(),_=()=>u.value?.zoomIn(),ae=()=>u.value?.zoomOut(),r=()=>{u.value?.setOptions(b(o.scale))},d=()=>{f.value=!f.value,c("onCornerClick",f.value)},l=n=>{c("update:lockLine",n)},C=N(()=>o.thick+"px");return K([()=>o.isShowReferLine],()=>{f.value=o.isShowReferLine}),K([()=>o.canvasWidth,()=>o.canvasHeight,()=>o.width,()=>o.height],()=>{I()}),K(()=>o.panzoomOption,()=>{r()},{deep:!0}),a({initPanzoom:I,panzoomInstance:u,reset:V,zoomIn:_,zoomOut:ae,cursorClass:y}),(n,p)=>(H(),D("div",at,[ye(n.$slots,"btn",{reset:V,zoomIn:_,zoomOut:ae}),Z("div",{class:ve(["canvasedit-parent",y.value]),style:W(m.value)},[Z("div",{class:ve(["canvasedit",y.value])},[ye(n.$slots,"default")],2)],6),$(fe(xe,{style:W({marginLeft:e.thick+"px",width:x.value+"px"}),vertical:!1,width:e.width,height:e.thick,"is-show-refer-line":f.value,thick:e.thick,start:w.value,"start-other":B.value,lines:e.lines,"select-start":e.shadow.x,"snap-threshold":e.snapThreshold,"snaps-obj":e.snapsObj,"select-length":e.shadow.width,scale:T.value,palette:M.value,"canvas-width":e.canvasWidth,"show-shadow-text":e.showShadowText,"canvas-height":e.canvasHeight,rate:e.rate,"grid-ratio":e.gridRatio,"lock-line":e.lockLine,onChangeLineState:l},null,8,["style","width","height","is-show-refer-line","thick","start","start-other","lines","select-start","snap-threshold","snaps-obj","select-length","scale","palette","canvas-width","show-shadow-text","canvas-height","rate","grid-ratio","lock-line"]),[[G,e.showRuler]]),$(fe(xe,{style:W({marginTop:e.thick+"px",top:0,height:k.value+"px"}),vertical:!0,width:e.thick,height:e.height,"is-show-refer-line":f.value,thick:e.thick,start:B.value,"start-other":w.value,lines:e.lines,"select-start":e.shadow.y,"select-length":e.shadow.height,"snap-threshold":e.snapThreshold,"snaps-obj":e.snapsObj,scale:T.value,palette:M.value,"canvas-width":e.canvasWidth,"canvas-height":e.canvasHeight,"show-shadow-text":e.showShadowText,rate:e.rate,"grid-ratio":e.gridRatio,"lock-line":e.lockLine,onChangeLineState:l},null,8,["style","width","height","is-show-refer-line","thick","start","start-other","lines","select-start","select-length","snap-threshold","snaps-obj","scale","palette","canvas-width","canvas-height","show-shadow-text","rate","grid-ratio","lock-line"]),[[G,e.showRuler]]),$(Z("a",{class:"corner",style:W(A.value),onClick:d},null,4),[[G,e.showRuler]])]))}});export{nt as o};
