import{r as z,c as Y,d as j,l as se,p as q,z as Z,A as J,o as U,b as D,e as W,u as E,t as ye,B as te,n as I,g as G,a as Pe,C as je,f as de,m as he,F as be,q as ke,j as ae,k as oe,x as Fe,y as _,w as F,D as Ze,E as Je,G as Ue,H as _e,s as He,h as et,i as tt}from"./index-BWyYrWVH.js";import{C as at}from"./panzoom-BOp08cne.js";/* empty css              */const ot=a=>a<=.25?40:a<=.5?20:a<=1?10:a<=2?5:a<=4?2:1;function nt(a,o,e,t,n,r){r?n.moveTo(a,0):n.moveTo(0,a),n.save(),r?n.translate(a+5,t*.2):n.translate(e*.1,a+32),r||n.rotate(-Math.PI/2),n.fillText(Math.round(o).toString(),4,7),n.restore(),r?n.lineTo(a,t):n.lineTo(e,a),n.stroke(),n.closePath(),n.setTransform(1,0,0,1,0,0)}function ie(a,o,e,t,n,r){t.fillStyle=n.fontShadowColor,t.strokeStyle=n.longfgColor,t.save(),t.translate(a,o),r||t.rotate(-Math.PI/2),t.font="bold 12px  Aria",t.fillText(String(e),0,0),t.restore()}const st=(a,o,e,t,n,r)=>{const{scale:c,width:s,height:h,ratio:v,palette:m,gridRatio:l,showShadowText:y}=n,{bgColor:f,fontColor:p,shadowColor:d,longfgColor:b}=m,g=r?n.canvasWidth:n.canvasHeight;a.setTransform(1,0,0,1,0,0),a.scale(v,v),a.clearRect(0,0,s,h),a.fillStyle=f,a.fillRect(0,0,s,h);const w=ot(c)*l*10,i=w*c,C=Math.floor(o/w)*w,R=(C-o)/w*i,T=o+Math.ceil((r?s:h)/c);if(t){const A=(e-o)*c,B=t*c;if(a.fillStyle=d,r?a.fillRect(A,0,B,h):a.fillRect(0,A,s,B),y)if(r){ie(A,h*.4,Math.round(e),a,m,r);const L=(e+t-o)*c;ie(L,h*.4,Math.round(e+t),a,m,r)}else{ie(s*.4,A,Math.round(e),a,m,r);const L=(e+t-o)*c;ie(s*.4,L,Math.round(e+t),a,m,r)}}a.beginPath(),a.fillStyle=p,a.strokeStyle=b;for(let A=C,B=0;A<T;A+=w,B++){const L=R+B*i+.5;if(A-w<g&&A>g||A==g){const X=R+B*i+.5+(g-A)*c;nt(X,g,s,h,a,r);return}A>=0&&A<=g&&(A==0?r?(a.moveTo(L,0),a.lineTo(L,h)):(a.moveTo(0,L),a.lineTo(s,L)):r?(a.moveTo(L,20),a.lineTo(L,h/1.3)):(a.moveTo(20,L),a.lineTo(s/1.3,L)),a.save(),A==0?r?a.translate(L-15,h*.01):a.translate(s*.3,L-5):r?a.translate(L-12,h*.05):a.translate(s*.05,L+12),r||a.rotate(-Math.PI/2),g-A>w/2&&(!y||t==0||Math.abs(A-e)>w/2&&Math.abs(A-(e+t))>w/2)&&a.fillText(A.toString(),4,9),a.restore())}a.stroke(),a.closePath()};function me(a,o=100){let e=null;const t=function(...n){e!==null&&clearTimeout(e),e=setTimeout(()=>{a(...n)},o)};return t.cancel=function(){e!==null&&(clearTimeout(e),e=null)},t}function Oe(a,o){const e=z(0),t=z(0),n=z(!1),r=Y(()=>({backgroundColor:a.palette.hoverBg,color:a.palette.hoverColor,[o?"top":"left"]:"-8px",[o?"left":"top"]:`${e.value+10}px`})),c=({offsetX:d,offsetY:b})=>{e.value=o?d:b},s=(d,b)=>new Promise(g=>{if(a.lockLine)return;const k=o?d.clientY:d.clientX;c(d);const w=b||t.value;let i=w;const C=T=>{let L=((o?T.clientY:T.clientX)-k)/a.scale+w,X=L;const N=(o?a.snapsObj.h:a.snapsObj.v).slice().sort((V,K)=>Math.abs(X-V)-Math.abs(X-K));N.length&&Math.abs(N[0]-L)<a.snapThreshold/a.scale&&(X=N[0],L=X),i=Math.round(L),t.value=i},R=()=>{document.removeEventListener("mousemove",C),h(i,a.index),g()};document.addEventListener("mousemove",C),document.addEventListener("mouseup",R,{once:!0})}),h=(d,b)=>{var w,i;const g=o?(w=a.lines)==null?void 0:w.h:(i=a.lines)==null?void 0:i.v,k=v(d);if(g)if(k)if(typeof b=="number")g.splice(b,1);else return;else typeof b!="number"?g.push(d):g[b]=d},v=d=>{const b=o?a.canvasHeight:a.canvasWidth;return d<0||d>b},m=Y(()=>v(t.value)?"放开删除":`${o?"Y":"X"}：${t.value*a.rate}`),l=me(()=>{n.value=!1},200),y=me(()=>{n.value=!0},200);return{showLabel:n,startValue:t,actionStyle:r,labelContent:m,handleMouseDown:s,handleMouseenter:d=>{a.lockLine||(c(d),y(),l.cancel())},handleMouseLeave:()=>{l()}}}const lt={key:0,class:"value"},rt=j({__name:"ruler-line",props:{scale:{},palette:{},index:{},start:{},vertical:{type:Boolean},value:{},canvasWidth:{},canvasHeight:{},lines:{},isShowReferLine:{type:Boolean},rate:{},snapThreshold:{},snapsObj:{},lockLine:{type:Boolean}},setup(a){const o=a,e=z(!1),{actionStyle:t,handleMouseDown:n,labelContent:r,startValue:c,showLabel:s,handleMouseenter:h,handleMouseLeave:v}=Oe(o,o.vertical),m=Y(()=>c.value>=o.start),l=Y(()=>{const{lineType:f,lockLineColor:p,lineColor:d}=o.palette,b=o.lockLine?p:d??"black",g=o.lockLine||e.value?"none":"auto",k=o.isShowReferLine&&!o.lockLine?o.vertical?"ns-resize":"ew-resize":"default",w=o.vertical?"borderTop":"borderLeft",i=(c.value-o.start)*o.scale;return{[w]:`1px ${f} ${b}`,pointerEvents:g,cursor:k,[o.vertical?"top":"left"]:`${i}px`}});se(()=>{c.value=o.value??0});const y=me(()=>{e.value=!1},1e3);return q([()=>o.scale],()=>{e.value=!0,y()}),(f,p)=>Z((U(),D("div",{class:"line",style:I(l.value),onMouseenter:p[0]||(p[0]=G((...d)=>E(h)&&E(h)(...d),["stop"])),onMouseleave:p[1]||(p[1]=G((...d)=>E(v)&&E(v)(...d),["stop"])),onMousedown:p[2]||(p[2]=G((...d)=>E(n)&&E(n)(...d),["stop"]))},[W("div",{class:"action",style:I(E(t))},[E(s)?(U(),D("span",lt,ye(E(r)),1)):te("",!0)],4)],36)),[[J,m.value]])}}),it=j({__name:"index",props:{scale:{},palette:{},vertical:{type:Boolean},showShadowText:{type:Boolean},start:{},width:{},height:{},selectStart:{},selectLength:{},canvasWidth:{},canvasHeight:{},rate:{},gridRatio:{}},emits:["handleDragStart"],setup(a,{emit:o}){const e=a,t=o,n=Pe({isDragging:!1,canvasContext:null});let r=window.devicePixelRatio;const c=z(null);se(()=>{window.addEventListener("resize",s),h(),m(r),l(r)});const s=()=>{r=window.devicePixelRatio,m(r),l(r)},h=()=>{var f;n.canvasContext=((f=c.value)==null?void 0:f.getContext("2d"))||null},v=Y(()=>({width:e.width+"px",height:e.height+"px",cursor:e.vertical?"ew-resize":"ns-resize",[e.vertical?"borderRight":"borderBottom"]:`1px solid ${e.palette.borderColor||"#eeeeef"} `}));je(()=>{window.removeEventListener("resize",s)});const m=f=>{if(c.value){c.value.width=Math.round(e.width*f),c.value.height=Math.round(e.height*f);const p=n.canvasContext;p&&(p.font=`11px -apple-system,
                "Helvetica Neue", ".SFNSText-Regular",
                "SF UI Text", Arial, "PingFang SC", "Hiragino Sans GB",
                "Microsoft YaHei", "WenQuanYi Zen Hei", sans-serif`,p.lineWidth=1,p.textBaseline="middle")}},l=f=>{const p={scale:e.scale,width:e.width,height:e.height,palette:e.palette,canvasWidth:e.canvasWidth,canvasHeight:e.canvasHeight,ratio:f,rate:e.rate,gridRatio:e.gridRatio,showShadowText:e.showShadowText};p.scale=e.scale/e.rate,p.canvasWidth=e.canvasWidth*e.rate,p.canvasHeight=e.canvasHeight*e.rate,n.canvasContext&&st(n.canvasContext,e.start*e.rate,e.selectStart,e.selectLength,p,!e.vertical)};q([()=>e.width,()=>e.height,()=>e.start,()=>e.palette,()=>e.selectStart,()=>e.selectLength],()=>{l(r)}),q([()=>e.width,()=>e.height],()=>{m(r)});const y=f=>{t("handleDragStart",f)};return(f,p)=>(U(),D("canvas",{ref_key:"canvas",ref:c,class:"ruler",style:I(v.value),onMousedown:G(y,["stop"])},null,36))}}),ut={class:"lines"},dt={key:0,class:"value"},ze=j({__name:"ruler-wrapper",props:{scale:{},thick:{},canvasWidth:{},canvasHeight:{},palette:{},vertical:{type:Boolean},width:{},height:{},start:{},startOther:{},lines:{},selectStart:{},selectLength:{},isShowReferLine:{type:Boolean},rate:{},snapThreshold:{},snapsObj:{},gridRatio:{},lockLine:{type:Boolean},showShadowText:{type:Boolean}},emits:["changeLineState"],setup(a,{emit:o}){const e=a,{showLabel:t,actionStyle:n,handleMouseenter:r,handleMouseLeave:c,handleMouseDown:s,labelContent:h,startValue:v}=Oe(e,!e.vertical),m=z(!1),l=z(!1),y=Y(()=>e.vertical?"v-container":"h-container"),f=o,p=Y(()=>{var g,k;return e.vertical?(g=e.lines)==null?void 0:g.h:(k=e.lines)==null?void 0:k.v}),d=Y(()=>{const g=e.palette.lineType;let k=e.vertical?"left":"top",w=e.vertical?"top":"left",i=e.vertical?"borderLeft":"borderBottom";const C=(v.value-e.startOther)*e.scale+e.thick;return{[k]:C+"px",[w]:-e.thick+"px",cursor:e.vertical?"ew-resize":"ns-resize",[i]:`1px ${g} ${e.palette.lineColor}`}}),b=async g=>{const{offsetX:k,offsetY:w}=g,{scale:i,vertical:C,thick:R,startOther:T}=e;l.value=!0,m.value=!1,f("changeLineState",!1);let A=Math.round(T-R/i+(C?k:w)/i);v.value=A,await s(g,A),l.value=!1};return q([()=>e.lockLine],()=>{m.value=e.lockLine}),(g,k)=>(U(),D("div",{class:oe(y.value)},[de(it,he(g.$props,{onHandleDragStart:b}),null,16),Z(W("div",ut,[(U(!0),D(be,null,ke(p.value,(w,i)=>(U(),ae(rt,he({key:w+i,index:i,value:w>>0,ref_for:!0},g.$props),null,16,["index","value"]))),128))],512),[[J,g.isShowReferLine]]),g.isShowReferLine?Z((U(),D("div",{key:0,class:"indicator",style:I(d.value),onMouseenter:k[0]||(k[0]=(...w)=>E(r)&&E(r)(...w)),onMouseleave:k[1]||(k[1]=(...w)=>E(c)&&E(c)(...w))},[W("div",{class:"action",style:I(E(n))},[E(t)?(U(),D("span",dt,ye(E(h)),1)):te("",!0)],4)],36)),[[J,l.value]]):te("",!0)],2))}}),ht="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAopJREFUOE/FlE9IVEEcx7+/N9ouds1Mu0QUSFZYdIgoUqQoKPBQHsKozpXE7jbTO/U8xLJvn6usBHWQ6hBFXupSkQeVbh0KJEPp0sH+eLGTsKs77xcj78m0ax0E8cHjzZv5zef3/c33xxA24KENYGJzoEEQbNNaN4Zh2OQ4znwYhr9c1/39vwrXVDo0NNS0tLR0GYB5D64BmAMwzMyvlFKz1es10Hw+f4mZ7wHYBeA9gNdENFepVOaEEM3M3OI4Thczn41gt6WUgQ3+C+r7/h0AWQD3mXnYqPA8L9nQ0HCemduIaFpKOWoAhUJhT6VSuQXgOjP3K6W8GLwKzeVyp4jonR0QBEErM48w8zFLyayUsjX+z+VyHhHdZebTSqkxM78CHRgYOKS1/ghgVErZY214RkQ7ADyRUj72ff8qgCtmXUrZGcf5vv8CwEUhxOF0Ov1pBRpla5dSdseBhUJhpznH6tIsZb1KqacW+BGArUaUXX63UuplHJTNZjuEEONSyhozfd/n6mQ1RkXZL2itz7mu+80EDA4ONi8vL/8AcM2UbikyR2BU9cSmmTU70YqKIAj2hWFo2uenlHK/BRg3Y2aeNO5GyU8S0ZbFxcUuz/NKEXAGQKPjOCcymcyX1dIi8DSAiWQyeaavr68cbSgCuBknYubnQoj+TCYzUywWE6VS6S2ADsdx2gxw1X3L7SNENMbMnwE8qK+vf5NKpRaMaeVyeW8ikfiaSqW+R7BuZr5BRMe11p2u607U9Gk8kc/ntzPzQwCmExYATDLzVBiGE0KIowAOADDf3QA+aK2VDaxRajto3K+rq+tl5nYAzQBamHmeiOYBTGmtR6ph/1Rqg9c73pz7dD1qN0TpHyNQRCUDJXrAAAAAAElFTkSuQmCC",ct="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAjtJREFUOE/NlD9oFEEUxn9v9ghC0hpRUogIAUmniGAT/5Q2FrETPSNRJILg7RwimI0ox85eQFCEBGIUO1PYpFM0jSConQoBEZGgGPsgl+w+2eM2bC57SopAFqYZ3v7m+977ZoQt+GQLmGxPaBiGgYiMWWvXBHZUGoZhH3BERPYC+4F+4Keq/urt7b1RLpf/ZEBVHa9Wq0HWyg3QKIoGVPU8cA7wgK/pUtXPQJ8xZk+pVBpuNBqXUoUiEvi+P56fzTpo6+SbwHNg1lo7WzTITGEKXFlZeeB53tVCpa3CK8AFa+1cBgvD8LKIXAQOJkkyICJDeYVBEJS6u7s/qeoLa+1o+l9TqXNuBLhmjDlbqVQ+5ICjInIfOBPH8W9jzGCR5YmJiRNxHM+papgqzqDvgSlr7VTernPuO3An3c9bBt74vv+yrdaKyLDv+/1Sq9UGPc97nY9EVuycU2AQOA7cAm4Dr4D5TvVxHB9rKo2iaEFVp621Ln96FEUngaOqGmSxabVqsh3a2h+x1h5qQjNrae/yE4+iaCwDJkky73neTuBZe129Xk+H+BS4l7ZqLVIZ2BhzuFKpvMsDVXXWGPMxFdAedOfcKeCRqj7MYrUhpz09PfXl5eXrectFWXXODQHpOq2qd/95o/JXr6ura3J1dXU6SZIfwKKIHAD2tVYMPBGRx77vN10UXtO85fTkmZmZHUtLSzUR2QXsBhaAL6r6DXhbrVYXi1yss59GqOgub/bN3Z7v6X/tb9Zmp/q/kN8s+lJb8oEAAAAASUVORK5CYII=",pt={class:"sketch-ruler"},ft=j({__name:"index",props:{showRuler:{type:Boolean,default:!0},eyeIcon:{},closeEyeIcon:{},scale:{default:1},rate:{default:1},thick:{default:16},palette:{},width:{default:1400},height:{default:800},paddingRatio:{default:.2},autoCenter:{type:Boolean,default:!0},shadow:{default:()=>({x:0,y:0,width:0,height:0})},lines:{default:()=>({h:[],v:[]})},isShowReferLine:{type:Boolean,default:!0},canvasWidth:{default:700},canvasHeight:{default:700},snapsObj:{default:()=>({h:[],v:[]})},snapThreshold:{default:5},gridRatio:{default:1},lockLine:{type:Boolean,default:!1},selfHandle:{type:Boolean,default:!1},showShadowText:{type:Boolean,default:!0},panzoomOption:{}},emits:["onCornerClick","update:scale","zoomchange","update:lockLine"],setup(a,{expose:o,emit:e}){Fe(u=>({"6bd3c76a":O.value}));const t=a,n=e,r=z(null),c=z(0),s=z(0);let h=0,v=0;const m=z(1),l=z(t.isShowReferLine),y=z(null),f=z("defaultCursor"),p=Y(()=>({bgColor:"#f6f7f9",longfgColor:"#BABBBC",fontColor:"#7D8694",fontShadowColor:"#106ebe",shadowColor:"#e9f7fe",lineColor:"#51d6a9",lineType:"solid",lockLineColor:"#d4d7dc",hoverBg:"#000",hoverColor:"#fff",borderColor:"#eeeeef",...t.palette})),d=Y(()=>({backgroundImage:l.value?`url(${t.eyeIcon??ht})`:`url(${t.closeEyeIcon??ct})`,width:t.thick+"px",height:t.thick+"px",borderRight:`1px solid ${p.value.borderColor}`,borderBottom:`1px solid ${p.value.borderColor}`})),b=Y(()=>({background:p.value.bgColor,width:g.value+"px",height:k.value+"px"})),g=Y(()=>t.width-t.thick),k=Y(()=>t.height-t.thick),w=u=>{var S;(u.ctrlKey||u.metaKey)&&((S=y.value)==null||S.zoomWithWheel(u))},i=u=>{var M;const S=document.activeElement;S!=null&&S.closest(".monaco-editor")||(S==null?void 0:S.tagName)==="INPUT"||(S==null?void 0:S.tagName)==="TEXTAREA"||(S==null?void 0:S.getAttribute("contenteditable"))==="true"||u.key===" "&&(f.value="grabCursor",(M=y.value)==null||M.bind(),u.preventDefault())},C=u=>{var M;const S=document.activeElement;S!=null&&S.closest(".monaco-editor")||(S==null?void 0:S.tagName)==="INPUT"||(S==null?void 0:S.tagName)==="TEXTAREA"||(S==null?void 0:S.getAttribute("contenteditable"))==="true"||u.key===" "&&((M=y.value)==null||M.destroy(),f.value="defaultCursor")};se(()=>{if(A(),!t.selfHandle&&r.value){const u=r.value.parentElement;if(!u)return;u.addEventListener("wheel",w),document.addEventListener("keydown",i),document.addEventListener("keyup",C)}});const R=u=>({noBind:!0,startScale:u,startX:h,startY:v,smoothScroll:!0,canvas:!0,...t.panzoomOption}),T=u=>{const{scale:S,dimsOut:M}=u.detail;if(M){n("update:scale",S),m.value=S;const ee=(M.parent.left-M.elem.left)/S,pe=(M.parent.top-M.elem.top)/S;c.value=ee,n("zoomchange",u.detail),s.value=pe}},A=()=>{if(r.value=document.querySelector(".canvasedit"),r.value){let u=t.scale;t.autoCenter&&(u=B()),y.value=at(r.value,R(u)),r.value&&r.value.addEventListener("panzoomchange",T)}},B=()=>{const u=g.value*(1-t.paddingRatio)/t.canvasWidth,S=k.value*(1-t.paddingRatio)/t.canvasHeight,M=Math.min(u,S);return h=g.value/2-t.canvasWidth/2,M<1?v=(t.canvasHeight*M/2-t.canvasHeight/2)/M-(t.canvasHeight*M-k.value)/M/2:M>1?v=(t.canvasHeight*M-t.canvasHeight)/2/M+(k.value-t.canvasHeight*M)/M/2:v=0,M},L=()=>{var u;return(u=y.value)==null?void 0:u.reset()},X=()=>{var u;return(u=y.value)==null?void 0:u.zoomIn()},H=()=>{var u;return(u=y.value)==null?void 0:u.zoomOut()},N=()=>{var u;(u=y.value)==null||u.setOptions(R(t.scale))},V=()=>{l.value=!l.value,n("onCornerClick",l.value)},K=u=>{n("update:lockLine",u)},O=Y(()=>t.thick+"px");return q([()=>t.isShowReferLine],()=>{l.value=t.isShowReferLine}),q([()=>t.canvasWidth,()=>t.canvasHeight,()=>t.width,()=>t.height],()=>{A()}),q(()=>t.panzoomOption,()=>{N()},{deep:!0}),o({initPanzoom:A,panzoomInstance:y,reset:L,zoomIn:X,zoomOut:H,cursorClass:f}),(u,S)=>(U(),D("div",pt,[_(u.$slots,"btn",{reset:L,zoomIn:X,zoomOut:H}),W("div",{class:oe(["canvasedit-parent",f.value]),style:I(b.value)},[W("div",{class:oe(["canvasedit",f.value])},[_(u.$slots,"default")],2)],6),Z(de(ze,{style:I({marginLeft:u.thick+"px",width:g.value+"px"}),vertical:!1,width:u.width,height:u.thick,"is-show-refer-line":l.value,thick:u.thick,start:c.value,"start-other":s.value,lines:u.lines,"select-start":u.shadow.x,"snap-threshold":u.snapThreshold,"snaps-obj":u.snapsObj,"select-length":u.shadow.width,scale:m.value,palette:p.value,"canvas-width":u.canvasWidth,"show-shadow-text":u.showShadowText,"canvas-height":u.canvasHeight,rate:u.rate,"grid-ratio":u.gridRatio,"lock-line":u.lockLine,onChangeLineState:K},null,8,["style","width","height","is-show-refer-line","thick","start","start-other","lines","select-start","snap-threshold","snaps-obj","select-length","scale","palette","canvas-width","show-shadow-text","canvas-height","rate","grid-ratio","lock-line"]),[[J,u.showRuler]]),Z(de(ze,{style:I({marginTop:u.thick+"px",top:0,height:k.value+"px"}),vertical:!0,width:u.thick,height:u.height,"is-show-refer-line":l.value,thick:u.thick,start:s.value,"start-other":c.value,lines:u.lines,"select-start":u.shadow.y,"select-length":u.shadow.height,"snap-threshold":u.snapThreshold,"snaps-obj":u.snapsObj,scale:m.value,palette:p.value,"canvas-width":u.canvasWidth,"canvas-height":u.canvasHeight,"show-shadow-text":u.showShadowText,rate:u.rate,"grid-ratio":u.gridRatio,"lock-line":u.lockLine,onChangeLineState:K},null,8,["style","width","height","is-show-refer-line","thick","start","start-other","lines","select-start","select-length","snap-threshold","snaps-obj","scale","palette","canvas-width","canvas-height","show-shadow-text","rate","grid-ratio","lock-line"]),[[J,u.showRuler]]),Z(W("a",{class:"corner",style:I(d.value),onClick:V},null,4),[[J,u.showRuler]])]))}}),vt={type:{type:String,default:"rect"},tag:{type:[String,Object],default:"div"},resizable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!1},boundary:{type:Boolean},disabled:Boolean,width:{type:Number,default:0},height:{type:Number,default:0},left:{type:Number,default:0},top:{type:Number,default:0},zIndex:{type:Number,default:0},angle:{type:Number,default:0},color:{type:String,default:"#3a7afe"},minWidth:{type:Number,default:-1/0},minHeight:{type:Number,default:-1/0},maxWidth:{type:Number,default:0},maxHeight:{type:Number,default:0},aspectRatio:{type:Number},selected:Boolean,snapToGrid:Boolean,gridX:{type:Number,default:50},gridY:{type:Number,default:50},scaleRatio:{type:Number,default:1},disabledKeyEvent:Boolean,border:{type:Boolean,default:!0},resizeList:{type:Array},equalProportion:{type:Boolean},checkCollision:{type:Boolean},snap:Boolean,snapThreshold:{type:Number,default:10},markline:[Boolean,Function],extraLines:Function};function Ae(a,o){const e=t=>{o&&o(t),document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",e),document.removeEventListener("mouseleave",e),document.removeEventListener("touchmove",a),document.removeEventListener("touchend",e)};document.addEventListener("mousemove",a),document.addEventListener("mouseup",e),document.addEventListener("mouseleave",e),document.addEventListener("touchmove",a),document.addEventListener("touchend",e)}function ne(a){let o=0,e=0;if(gt(a)){const t=a.targetTouches[0];o=t.pageX,e=t.pageY}else o=a.clientX,e=a.clientY;return{clientX:o,clientY:e}}function gt(a){const o=Object.prototype.toString.call(a);return o.substring(8,o.length-1)==="TouchEvent"}const ue=(a=0)=>parseInt(a+"")+"px",fe={n:"top",s:"bottom",e:"right",w:"left",ne:"top-right",nw:"top-left",se:"bottom-right",sw:"bottom-left"},we=["n","ne","e","se","s","sw","w","nw"],mt={n:0,ne:1,e:2,se:3,s:4,sw:5,w:6,nw:7},wt={0:0,1:1,2:2,3:2,4:3,5:4,6:4,7:5,8:6,9:6,10:7,11:8},yt=(a,o)=>{const e=wt[Math.floor(a/30)],t=(mt[o]+e)%8;return we[t]},Ye=(a=0,o)=>{let e=[];for(let t=0;t<we.length;t++){const n=we[t],[r,c]=fe[n].split("-"),s=yt(a,n),h={[r]:"0%",cursor:s+"-resize",side:fe[n]};if(c)h[c]="0%";else{const v=["top","bottom"].includes(r)?"left":"top";h[v]="50%"}o?o.includes(fe[n])&&e.push(h):e.push(h)}return e},Ce=a=>a*Math.PI/180,bt=(a,o)=>Math.sqrt(a*a+o*o),x=a=>Math.cos(Ce(a)),P=a=>Math.sin(Ce(a)),kt=(a,o,e,t,n,r,c)=>{let{width:s,height:h,centerX:v,centerY:m,rotateAngle:l}=o;const y=s<0?-1:1,f=h<0?-1:1;if(s=Math.abs(s),h=Math.abs(h),["top-left","top-right","bottom-left","bottom-right"].includes(a)){a==="top-right"?t=-t:a==="bottom-left"?e=-e:a==="top-left"&&(e=-e,t=-t);const p=ge(s,e,r);s=p.width,e=p.deltaW;const d=ve(h,t,c);h=d.height,t=d.deltaH,n&&(t=e/n,h=s/n)}switch(a){case"right":{const p=ge(s,e,r);s=p.width,e=p.deltaW,n?(t=e/n,h=s/n,v+=e/2*x(l)-t/2*P(l),m+=e/2*P(l)+t/2*x(l)):(v+=e/2*x(l),m+=e/2*P(l));break}case"top-right":{v+=e/2*x(l)+t/2*P(l),m+=e/2*P(l)-t/2*x(l);break}case"bottom-right":{v+=e/2*x(l)-t/2*P(l),m+=e/2*P(l)+t/2*x(l);break}case"bottom":{const p=ve(h,t,c);h=p.height,t=p.deltaH,n?(e=t*n,s=h*n,v+=e/2*x(l)-t/2*P(l),m+=e/2*P(l)+t/2*x(l)):(v-=t/2*P(l),m+=t/2*x(l));break}case"bottom-left":{v-=e/2*x(l)+t/2*P(l),m-=e/2*P(l)-t/2*x(l);break}case"left":{e=-e;const p=ge(s,e,r);s=p.width,e=p.deltaW,n?(h=s/n,t=e/n,v-=e/2*x(l)+t/2*P(l),m-=e/2*P(l)-t/2*x(l)):(v-=e/2*x(l),m-=e/2*P(l));break}case"top-left":{v-=e/2*x(l)-t/2*P(l),m-=e/2*P(l)+t/2*x(l);break}case"top":{t=-t;const p=ve(h,t,c);h=p.height,t=p.deltaH,n?(s=h*n,e=t*n,v+=e/2*x(l)+t/2*P(l),m+=e/2*P(l)-t/2*x(l)):(v+=t/2*P(l),m-=t/2*x(l));break}}return{position:{centerX:v,centerY:m},size:{width:s*y,height:h*f}}},ve=(a,o,e)=>{const t=a+o;return t>e?a=t:(o=e-a,a=e),{height:a,deltaH:o}},ge=(a,o,e)=>{const t=a+o;return t>e?a=t:(o=e-a,a=e),{width:a,deltaW:o}},At=({centerX:a,centerY:o,width:e,height:t,angle:n})=>({top:o-t/2,left:a-e/2,width:e,height:t,angle:n}),Ct=(a,o,e)=>{const{width:t,height:n}=a;return{width:Math.abs(t),height:Math.abs(n),left:o-Math.abs(t)/2,top:e-Math.abs(n)/2}};function ce(a,o){const e=Math.abs(a)%o,t=a>0?o:-o;let n=0;return e>o/2?n=t*Math.ceil(Math.abs(a)/o):n=t*Math.floor(Math.abs(a)/o),n}function Lt(a,o,e){if(!a||!o)return!1;const t=Q(a,e),n=Q(o,e);return t.left<n.left+n.width&&t.left+t.width>n.left&&t.top<n.top+n.height&&t.top+t.height>n.top}const Q=(a,o)=>{var e=a.getBoundingClientRect();return{...e,left:e.left/o,top:e.top/o,right:e.right/o,bottom:e.bottom/o,width:e.width/o,height:e.height/o}},Ne=a=>typeof a=="function";function St(a,o){let e=null,t=null;const n=Y(()=>a.value.offsetParent||document.body),r=Y(()=>Q(n.value,o.scaleRatio)),c=z({x:[],y:[]}),s=()=>{o.markline&&!Ne(o.markline)&&(e||(e=document.querySelector(".es-drager-markline-x")||xe("x",n.value,o.color)),t||(t=document.querySelector(".es-drager-markline-y")||xe("y",n.value,o.color)))},h=(f={})=>{if(o.markline){if(Ne(o.markline))return o.markline(f);f.left===null?e.style.display="none":(e.style.left=f.left+"px",e.style.backgroundColor=o.color,e.style.display="block"),f.top===null?t.style.display="none":(t.style.top=f.top+"px",t.style.backgroundColor=o.color,t.style.display="block")}},v=()=>{const f=Q(a.value,o.scaleRatio),p=Array.from(document.querySelectorAll(".es-drager"));if(o.extraLines){const k=o.extraLines(f)||[];p.push(...k)}const d=[],b=[],g=[];for(let k=0;k<p.length;k++){const w=p[k];w.nodeType===1?w!==a.value&&d.push(Q(w,o.scaleRatio)):w.showTop||w.showTop===0?g.push(w):(w.showLeft||w.showLeft===0)&&b.push(w)}c.value=Rt(d,f),c.value.x.push(...b),c.value.y.push(...g)},m=()=>{const f={top:null,left:null,diffX:0,diffY:0},p=Q(a.value,o.scaleRatio);for(let d=0;d<c.value.y.length;d++){const{top:b,showTop:g}=c.value.y[d];if(Math.abs(b-p.top)<o.snapThreshold){f.diffY=b-p.top,f.top=g-r.value.top;break}}for(let d=0;d<c.value.x.length;d++){const{left:b,showLeft:g}=c.value.x[d];if(Math.abs(b-p.left)<o.snapThreshold){f.diffX=b-p.left,f.left=g-r.value.left;break}}return h(f),f},l=()=>{h({left:null,top:null})},y=f=>{if(!(!o.snap&&!o.markline))switch(f){case"drag-start":v();break;case"drag":return m();case"drag-end":l();break}};return se(()=>{s()}),{marklineEmit:y}}function xe(a="x",o,e=""){const t=document.createElement("div");return t.classList.add(`es-drager-markline-${a}`),t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.zIndex="9999",t.style.backgroundColor=e,t.style.display="none",a==="x"?(t.style.height="100%",t.style.width="1px"):(t.style.height="1px",t.style.width="100%"),o.appendChild(t),t}function Rt(a,o){const e={x:[],y:[]},{width:t=0,height:n=0}=o;return a.forEach(r=>{const{top:c,left:s,width:h,height:v}=r;e.y.push({showTop:c,top:c}),e.y.push({showTop:c,top:c-n}),e.y.push({showTop:c+v/2,top:c+v/2-n/2}),e.y.push({showTop:c+v,top:c+v}),e.y.push({showTop:c+v,top:c+v-n}),e.x.push({showLeft:s,left:s}),e.x.push({showLeft:s+h,left:s+h}),e.x.push({showLeft:s+h/2,left:s+h/2-t/2}),e.x.push({showLeft:s+h,left:s+h-t}),e.x.push({showLeft:s,left:s-t})}),e}function Tt(a,o,e,{getBoundary:t,fixBoundary:n,checkDragerCollision:r,emit:c}){let s=0,h=0;return{onKeydown:v=>{let{left:m,top:l}=o.value;if(s||(s=m),h||(h=l),["ArrowRight","ArrowLeft"].includes(v.key)){const y=v.key==="ArrowRight";let f=y?1:-1;a.snapToGrid&&(f=y?a.gridX:-a.gridX),m=m+f}else if(["ArrowUp","ArrowDown"].includes(v.key)){const y=v.key==="ArrowDown";let f=y?1:-1;a.snapToGrid&&(f=y?a.gridY:-a.gridY),l=l+f}if(a.boundary){const[y,f,p,d]=t();[m,l]=n(m,l,y,f,p,d)}o.value.left=m,o.value.top=l},onKeyup:v=>{["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"].includes(v.key)&&a.checkCollision&&r()&&(o.value.left=s,o.value.top=h),s=0,h=0}}}function Bt(a,o,e){const t=z(!1),n=z(!1),r=z({width:o.width,height:o.height,left:o.left,top:o.top,angle:o.angle}),{marklineEmit:c}=St(a,o),s=new Set;function h(d){if(s.add(d.button),o.disabled)return;t.value=!0,n.value=!0;let{clientX:b,clientY:g}=ne(d);const{left:k,top:w}=r.value;let i=0,C=0,R=0,T=0;o.boundary&&([i,C,R,T]=v()),c("drag-start"),e("drag-start",r.value),Ae(A=>{if(s.size>1)return;const{clientX:B,clientY:L}=ne(A);let X=(B-b)/o.scaleRatio+k,H=(L-g)/o.scaleRatio+w;if(o.snapToGrid){let{left:N,top:V}=r.value;const K=X-N,O=H-V;X=N+ce(K,o.gridX),H=V+ce(O,o.gridY)}o.boundary&&([X,H]=m(X,H,i,C,R,T)),r.value.left=X,r.value.top=H,e("drag",r.value),He(()=>{const N=c("drag");o.snap&&(N.diffX&&(r.value.left+=N.diffX),N.diffY&&(r.value.top+=N.diffY))})},A=>{o.checkCollision&&l()&&(r.value.top=w,r.value.left=k),s.clear(),t.value=!1,c("drag-end"),e("drag-end",r.value)})}const v=()=>{let d=0,b=0;const{left:g,top:k,height:w,width:i,angle:C}=r.value,R=a.value.offsetParent||document.body,T=Q(R,o.scaleRatio);if(C){const L=Q(a.value,o.scaleRatio);d=L.left-Math.floor(g-(L.width-i)+T.left),b=L.top-Math.floor(k-(L.height-w)+T.top)}const A=T.width-i,B=T.height-w;return[d,A-d,b,B-b,T.width,T.height]},m=(d,b,g,k,w,i)=>(d=d<g?g:d,d=d>k?k:d,b=b<w?w:b,b=b>i?i:b,[d,b]),l=()=>{const d=a.value.offsetParent||document.body,b=Array.from(d.children).filter(g=>g!==a.value&&g.classList.contains("es-drager"));for(let g=0;g<b.length;g++){const k=b[g];if(Lt(a.value,k,o.scaleRatio))return!0}},y=()=>{n.value=!1},{onKeydown:f,onKeyup:p}=Tt(o,r,n,{getBoundary:v,fixBoundary:m,checkDragerCollision:l,emit:e});return q(n,d=>{d?(e("focus",d),document.addEventListener("click",y,{once:!0})):e("blur",d),!o.disabledKeyEvent&&(d?(document.addEventListener("keydown",f),document.addEventListener("keyup",p)):(document.removeEventListener("keydown",f),document.removeEventListener("keyup",p)))}),se(()=>{if(a.value){if(!r.value.width&&!r.value.height){const{width:d,height:b}=Q(a.value,o.scaleRatio);r.value={...r.value,width:d+2,height:b+2}}if(a.value.addEventListener("mousedown",h),a.value.addEventListener("touchstart",h,{passive:!0}),o.type==="text"){const d=window.getComputedStyle(a.value);r.value.height=parseInt(d.fontSize)}}}),_e(()=>{document.removeEventListener("click",y),document.removeEventListener("keydown",f),document.removeEventListener("keyup",p)}),{isMousedown:t,selected:n,dragData:r,getBoundary:v,checkDragerCollision:l}}const Mt=W("div",{class:"es-drager-rotate-handle"},[W("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[W("path",{fill:"currentColor",d:"M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"})])],-1),Et=j({__name:"rotate",props:{modelValue:{type:Number,default:0},element:{type:Object}},emits:["update:modelValue","rotate","rotate-start","rotate-end"],setup(a,{emit:o}){const e=a,t=o,n=z(null),r=Y({get:()=>e.modelValue,set:s=>{t("update:modelValue",s)}});function c(s){if(!e.element)return console.warn("[es-drager] rotate component need drag element property");s.stopPropagation();const{width:h,height:v,left:m,top:l}=e.element.getBoundingClientRect(),y=m+h/2,f=l+v/2;t("rotate-start",r.value),Ae(p=>{const{clientX:d,clientY:b}=ne(p),g=y-d,k=f-b,w=Math.atan2(k,g)*180/Math.PI-90;r.value=(w+360)%360,t("rotate",r.value)},()=>{t("rotate-end",r.value)})}return(s,h)=>(U(),D("div",{ref_key:"rotateRef",ref:n,class:"es-drager-rotate",onMousedown:c,onTouchstartPassive:c},[_(s.$slots,"default",{},()=>[Mt])],544))}}),Xt=["data-side","onMousedown","onTouchstartPassive"],zt=W("div",{class:"es-drager-dot-handle"},null,-1),Le=j({__name:"drager",props:vt,emits:["change","drag","drag-start","drag-end","resize","resize-start","resize-end","rotate","rotate-start","rotate-end","focus","blur"],setup(a,{emit:o}){const e=a,t=o,n=(i,...C)=>{t(i,...C)},r=z(null),{selected:c,dragData:s,isMousedown:h,getBoundary:v,checkDragerCollision:m}=Bt(r,e,n),l=z(Ye(0,e.resizeList)),y=Y(()=>e.resizable&&!e.disabled),f=Y(()=>e.rotatable&&!e.disabled&&c.value),p=Y(()=>e.type!="text"?l.value:l.value.filter(i=>!["top","bottom"].includes(i.side))),d=Y(()=>{const{width:i,height:C,left:R,top:T,angle:A}=s.value,B={};i&&(B.width=ue(i)),C&&(e.type==="text"?B.fontSize=C+"px":B.height=ue(C));let L=[`translateX(${ue(R)})`,`translateY(${ue(T)})`,`rotate(${A}deg)`];return{...B,zIndex:e.zIndex,transform:L.join(" "),"--es-drager-color":e.color}});function b(i){r.value||(r.value=i.$el||i)}function g(i){l.value=Ye(i,e.resizeList),n("rotate-end",s.value)}function k(i,C){if(e.disabled)return;C.stopPropagation();const{clientX:R,clientY:T}=ne(C),A=R,B=T,{width:L,height:X,left:H,top:N}=s.value,V=H+L/2,K=N+X/2,O={width:L,height:X,centerX:V,centerY:K,rotateAngle:s.value.angle},u=i.side;let{minWidth:S,minHeight:M,aspectRatio:ee,equalProportion:pe}=e;n("resize-start",s.value,u);let Se=[];e.boundary&&(Se=v()),["text","image"].includes(e.type)&&u.includes("-")&&(ee=O.width/O.height),Ae(Re=>{const{clientX:We,clientY:Ve}=ne(Re);let le=(We-A)/e.scaleRatio,re=(Ve-B)/e.scaleRatio;e.snapToGrid&&(le=ce(le,e.gridX),re=ce(re,e.gridY));const De=Math.atan2(re,le),Te=bt(le,re),Ie=Re.shiftKey,Be=De-Ce(O.rotateAngle),Ke=Te*Math.cos(Be),qe=Te*Math.sin(Be),Me=(pe||Ie)&&!ee?O.width/O.height:ee,{position:{centerX:Ee,centerY:Xe},size:{width:Qe,height:Ge}}=kt(u,{...O,rotateAngle:O.rotateAngle},Ke,qe,Me,S,M),$e=At({centerX:Ee,centerY:Xe,width:Qe,height:Ge,angle:s.value.angle});let $={...s.value,...Ct($e,Ee,Xe)};e.maxWidth>0&&($.width=Math.min($.width,e.maxWidth)),e.maxHeight>0&&($.height=Math.min($.height,e.maxHeight)),e.boundary&&($=w($,Se,Me)),s.value=$,n("resize",s.value,u)},()=>{e.checkCollision&&m()&&(s.value={...s.value,width:L,height:X,left:H,top:N}),n("resize-end",s.value,u)})}function w(i,C,R){const[T,A,B,L,X,H]=C,N=i.left<T,V=i.left+i.width>X,K=i.top<B,O=i.top+i.height>H;return N&&(i.left=T,i.width=s.value.width),K&&(i.top=B,i.height=s.value.height),(V||O)&&(V&&(i.left=s.value.left),O&&(i.top=s.value.top),O||(i.width=X-i.left),V||(i.height=H-i.top)),(O||K)&&R&&(i.width=s.value.width,i.left=s.value.left),(V||N)&&R&&(i.height=s.value.height,i.top=s.value.top),i}return q(()=>[e.width,e.height,e.left,e.top,e.angle],([i,C,R,T,A],[B,L,X,H,N])=>{i!==B&&(s.value.width=i),C!==L&&(s.value.height=C),R!==X&&(s.value.left=R),T!==H&&(s.value.top=T),A!==N&&(s.value.angle=A)}),q(()=>s.value,i=>{t("change",{...i})},{deep:!0}),q(()=>e.selected,i=>{c.value=i},{immediate:!0}),(i,C)=>(U(),ae(Ue(i.tag),{ref:b,class:oe(["es-drager",`es-drager-${i.type}`,{disabled:i.disabled,dragging:E(h),selected:E(c),border:i.border}]),style:I(d.value),onClick:C[3]||(C[3]=G(()=>{},["stop"])),onMousedown:C[4]||(C[4]=G(()=>{},["stop"]))},{default:F(()=>[_(i.$slots,"default"),y.value?(U(!0),D(be,{key:0},ke(p.value,(R,T)=>(U(),D("div",{key:T,class:"es-drager-dot","data-side":R.side,style:I({...R}),onMousedown:A=>k(R,A),onTouchstartPassive:A=>k(R,A)},[_(i.$slots,"resize",Ze(Je({side:R.side})),()=>[zt])],44,Xt))),128)):te("",!0),f.value?(U(),ae(Et,{key:1,modelValue:E(s).angle,"onUpdate:modelValue":C[0]||(C[0]=R=>E(s).angle=R),element:r.value,onRotate:C[1]||(C[1]=R=>n("rotate",E(s))),onRotateStart:C[2]||(C[2]=R=>n("rotate-start",E(s))),onRotateEnd:g},{default:F(()=>[_(i.$slots,"rotate")]),_:3},8,["modelValue","element"])):te("",!0)]),_:3},40,["class","style"]))}}),Yt=a=>{a.component("es-drager",Le)};Le.install=Yt;const Nt={class:"btns"},xt=["onClick"],Pt=["onClick"],Ut=["onClick"],Vt=j({__name:"esDragle",setup(a){const o=et(),e=z(),t=z(),n=Pe({scale:1,thick:20,width:1470,height:700,showShadowText:!0,canvasWidth:1e3,canvasHeight:500,showRuler:!0,palette:{bgColor:"transparent",lineType:"dashed"},isShowReferLine:!0,shadow:{x:0,y:0,width:0,height:0},lines:{h:[300],v:[400]}}),r=z({componentList:[{id:"div1",component:"div",text:"div1",width:100,height:100,left:0,top:0},{id:"div2",component:"div",text:"div2",width:100,height:100,top:100,left:100}]}),c=Y(()=>({width:`${n.width}px`,height:`${n.height}px`})),s=Y(()=>({width:`${n.canvasWidth}px`,height:`${n.canvasHeight}px`,position:"relative",background:o.isLight?"#eff2f5":"#333333"})),h=(m,l)=>{He(()=>{n.shadow={x:l.left,y:l.top,width:l.width,height:l.height}}),Object.keys(m).forEach(y=>{l[y]=m[y]})},v=m=>Array.from(document.querySelectorAll(".sketch-ruler .lines .line"));return(m,l)=>(U(),D("div",null,[W("div",{class:oe(["wrapper",[E(o).isLight?"whitewrapper":"blackwrapper"]]),style:I(c.value)},[de(E(ft),he({ref_key:"sketchruleRef",ref:e,scale:n.scale,"onUpdate:scale":l[0]||(l[0]=y=>n.scale=y)},n),{default:F(()=>[W("div",{ref_key:"dragParentRef",ref:t,"data-type":"page",style:I(s.value)},[(U(!0),D(be,null,ke(r.value.componentList,y=>(U(),ae(E(Le),he({ref_for:!0},y,{key:y.id,snap:"","scale-ratio":n.scale,class:"dragerItem","snap-threshold":10,markline:"","extra-lines":v,onChange:f=>h(f,y)}),{default:F(()=>[(U(),ae(Ue(y.component),null,{default:F(()=>[tt(ye(y.text),1)]),_:2},1024))]),_:2},1040,["scale-ratio","onChange"]))),128))],4)]),btn:F(({reset:y,zoomIn:f,zoomOut:p})=>[W("div",Nt,[W("button",{onClick:G(y,["stop"])},"还原",8,xt),W("button",{onClick:G(f,["stop"])},"放大",8,Pt),W("button",{onClick:G(p,["stop"])},"缩小",8,Ut)])]),_:1},16,["scale"])],6)]))}});export{Vt as default};
