import{d as ne,r as _,c as P,p as O,o as H,j as Q,w as D,x as J,b as j,q as xe,n as Z,y as Ve,z as We,F as Le,A as me,u as N,k as Me,g as I,B as Ce,l as Ee,C as De,e as A,s as Re,h as qe,a as Ie,f as je,m as we,i as Ge,t as Ke}from"./index-BivK8T_T.js";import{f as Fe}from"./style-CdOCmMKe.js";const Ue={type:{type:String,default:"rect"},tag:{type:[String,Object],default:"div"},resizable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!1},boundary:{type:Boolean},disabled:Boolean,width:{type:Number,default:0},height:{type:Number,default:0},left:{type:Number,default:0},top:{type:Number,default:0},zIndex:{type:Number,default:0},angle:{type:Number,default:0},color:{type:String,default:"#3a7afe"},minWidth:{type:Number,default:-1/0},minHeight:{type:Number,default:-1/0},maxWidth:{type:Number,default:0},maxHeight:{type:Number,default:0},aspectRatio:{type:Number},selected:Boolean,snapToGrid:Boolean,gridX:{type:Number,default:50},gridY:{type:Number,default:50},scaleRatio:{type:Number,default:1},disabledKeyEvent:Boolean,border:{type:Boolean,default:!0},resizeList:{type:Array},equalProportion:{type:Boolean},checkCollision:{type:Boolean},snap:Boolean,snapThreshold:{type:Number,default:10},markline:[Boolean,Function],extraLines:Function};function re(o,a){const e=t=>{a&&a(t),document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",e),document.removeEventListener("mouseleave",e),document.removeEventListener("touchmove",o),document.removeEventListener("touchend",e)};document.addEventListener("mousemove",o),document.addEventListener("mouseup",e),document.addEventListener("mouseleave",e),document.addEventListener("touchmove",o),document.addEventListener("touchend",e)}function G(o){let a=0,e=0;if(Oe(o)){const t=o.targetTouches[0];a=t.pageX,e=t.pageY}else a=o.clientX,e=o.clientY;return{clientX:a,clientY:e}}function Oe(o){const a=Object.prototype.toString.call(o);return a.substring(8,a.length-1)==="TouchEvent"}const U=(o=0)=>parseInt(o+"")+"px",ae={n:"top",s:"bottom",e:"right",w:"left",ne:"top-right",nw:"top-left",se:"bottom-right",sw:"bottom-left"},se=["n","ne","e","se","s","sw","w","nw"],Je={n:0,ne:1,e:2,se:3,s:4,sw:5,w:6,nw:7},Qe={0:0,1:1,2:2,3:2,4:3,5:4,6:4,7:5,8:6,9:6,10:7,11:8},Ze=(o,a)=>{const e=Qe[Math.floor(o/30)],t=(Je[a]+e)%8;return se[t]},ye=(o=0,a)=>{let e=[];for(let t=0;t<se.length;t++){const s=se[t],[i,c]=ae[s].split("-"),l=Ze(o,s),d={[i]:"0%",cursor:l+"-resize",side:ae[s]};if(c)d[c]="0%";else{const h=["top","bottom"].includes(i)?"left":"top";d[h]="50%"}a?a.includes(ae[s])&&e.push(d):e.push(d)}return e},ie=o=>o*Math.PI/180,et=(o,a)=>Math.sqrt(o*o+a*a),M=o=>Math.cos(ie(o)),C=o=>Math.sin(ie(o)),tt=(o,a,e,t,s,i,c)=>{let{width:l,height:d,centerX:h,centerY:g,rotateAngle:n}=a;const v=l<0?-1:1,p=d<0?-1:1;if(l=Math.abs(l),d=Math.abs(d),["top-left","top-right","bottom-left","bottom-right"].includes(o)){o==="top-right"?t=-t:o==="bottom-left"?e=-e:o==="top-left"&&(e=-e,t=-t);const f=le(l,e,i);l=f.width,e=f.deltaW;const u=oe(d,t,c);d=u.height,t=u.deltaH,s&&(t=e/s,d=l/s)}switch(o){case"right":{const f=le(l,e,i);l=f.width,e=f.deltaW,s?(t=e/s,d=l/s,h+=e/2*M(n)-t/2*C(n),g+=e/2*C(n)+t/2*M(n)):(h+=e/2*M(n),g+=e/2*C(n));break}case"top-right":{h+=e/2*M(n)+t/2*C(n),g+=e/2*C(n)-t/2*M(n);break}case"bottom-right":{h+=e/2*M(n)-t/2*C(n),g+=e/2*C(n)+t/2*M(n);break}case"bottom":{const f=oe(d,t,c);d=f.height,t=f.deltaH,s?(e=t*s,l=d*s,h+=e/2*M(n)-t/2*C(n),g+=e/2*C(n)+t/2*M(n)):(h-=t/2*C(n),g+=t/2*M(n));break}case"bottom-left":{h-=e/2*M(n)+t/2*C(n),g-=e/2*C(n)-t/2*M(n);break}case"left":{e=-e;const f=le(l,e,i);l=f.width,e=f.deltaW,s?(d=l/s,t=e/s,h-=e/2*M(n)+t/2*C(n),g-=e/2*C(n)-t/2*M(n)):(h-=e/2*M(n),g-=e/2*C(n));break}case"top-left":{h-=e/2*M(n)-t/2*C(n),g-=e/2*C(n)+t/2*M(n);break}case"top":{t=-t;const f=oe(d,t,c);d=f.height,t=f.deltaH,s?(l=d*s,e=t*s,h+=e/2*M(n)+t/2*C(n),g+=e/2*C(n)-t/2*M(n)):(h+=t/2*C(n),g-=t/2*M(n));break}}return{position:{centerX:h,centerY:g},size:{width:l*v,height:d*p}}},oe=(o,a,e)=>{const t=o+a;return t>e?o=t:(a=e-o,o=e),{height:o,deltaH:a}},le=(o,a,e)=>{const t=o+a;return t>e?o=t:(a=e-o,o=e),{width:o,deltaW:a}},at=({centerX:o,centerY:a,width:e,height:t,angle:s})=>({top:a-t/2,left:o-e/2,width:e,height:t,angle:s}),ot=(o,a,e)=>{const{width:t,height:s}=o;return{width:Math.abs(t),height:Math.abs(s),left:a-Math.abs(t)/2,top:e-Math.abs(s)/2}};function ee(o,a){const e=Math.abs(o)%a,t=o>0?a:-a;let s=0;return e>a/2?s=t*Math.ceil(Math.abs(o)/a):s=t*Math.floor(Math.abs(o)/a),s}function lt(o,a,e){if(!o||!a)return!1;const t=$(o,e),s=$(a,e);return t.left<s.left+s.width&&t.left+t.width>s.left&&t.top<s.top+s.height&&t.top+t.height>s.top}const $=(o,a)=>{var e=o.getBoundingClientRect();return{...e,left:e.left/a,top:e.top/a,right:e.right/a,bottom:e.bottom/a,width:e.width/a,height:e.height/a}},be=o=>typeof o=="function";function st(o,a){let e=null,t=null;const s=P(()=>o.value.offsetParent||document.body),i=P(()=>$(s.value,a.scaleRatio)),c=_({x:[],y:[]}),l=()=>{a.markline&&!be(a.markline)&&(e||(e=document.querySelector(".es-drager-markline-x")||ke("x",s.value,a.color)),t||(t=document.querySelector(".es-drager-markline-y")||ke("y",s.value,a.color)))},d=(p={})=>{if(a.markline){if(be(a.markline))return a.markline(p);p.left===null?e.style.display="none":(e.style.left=p.left+"px",e.style.backgroundColor=a.color,e.style.display="block"),p.top===null?t.style.display="none":(t.style.top=p.top+"px",t.style.backgroundColor=a.color,t.style.display="block")}},h=()=>{const p=$(o.value,a.scaleRatio),f=Array.from(document.querySelectorAll(".es-drager"));if(a.extraLines){const L=a.extraLines(p)||[];f.push(...L)}const u=[],m=[],y=[];for(let L=0;L<f.length;L++){const k=f[L];k.nodeType===1?k!==o.value&&u.push($(k,a.scaleRatio)):k.showTop||k.showTop===0?y.push(k):(k.showLeft||k.showLeft===0)&&m.push(k)}c.value=nt(u,p),c.value.x.push(...m),c.value.y.push(...y)},g=()=>{const p={top:null,left:null,diffX:0,diffY:0},f=$(o.value,a.scaleRatio);for(let u=0;u<c.value.y.length;u++){const{top:m,showTop:y}=c.value.y[u];if(Math.abs(m-f.top)<a.snapThreshold){p.diffY=m-f.top,p.top=y-i.value.top;break}}for(let u=0;u<c.value.x.length;u++){const{left:m,showLeft:y}=c.value.x[u];if(Math.abs(m-f.left)<a.snapThreshold){p.diffX=m-f.left,p.left=y-i.value.left;break}}return d(p),p},n=()=>{d({left:null,top:null})},v=p=>{if(!(!a.snap&&!a.markline))switch(p){case"drag-start":h();break;case"drag":return g();case"drag-end":n();break}};return Ee(()=>{l()}),{marklineEmit:v}}function ke(o="x",a,e=""){const t=document.createElement("div");return t.classList.add(`es-drager-markline-${o}`),t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.zIndex="9999",t.style.backgroundColor=e,t.style.display="none",o==="x"?(t.style.height="100%",t.style.width="1px"):(t.style.height="1px",t.style.width="100%"),a.appendChild(t),t}function nt(o,a){const e={x:[],y:[]},{width:t=0,height:s=0}=a;return o.forEach(i=>{const{top:c,left:l,width:d,height:h}=i;e.y.push({showTop:c,top:c}),e.y.push({showTop:c,top:c-s}),e.y.push({showTop:c+h/2,top:c+h/2-s/2}),e.y.push({showTop:c+h,top:c+h}),e.y.push({showTop:c+h,top:c+h-s}),e.x.push({showLeft:l,left:l}),e.x.push({showLeft:l+d,left:l+d}),e.x.push({showLeft:l+d/2,left:l+d/2-t/2}),e.x.push({showLeft:l+d,left:l+d-t}),e.x.push({showLeft:l,left:l-t})}),e}function rt(o,a,e,{getBoundary:t,fixBoundary:s,checkDragerCollision:i,emit:c}){let l=0,d=0;return{onKeydown:h=>{let{left:g,top:n}=a.value;if(l||(l=g),d||(d=n),["ArrowRight","ArrowLeft"].includes(h.key)){const v=h.key==="ArrowRight";let p=v?1:-1;o.snapToGrid&&(p=v?o.gridX:-o.gridX),g=g+p}else if(["ArrowUp","ArrowDown"].includes(h.key)){const v=h.key==="ArrowDown";let p=v?1:-1;o.snapToGrid&&(p=v?o.gridY:-o.gridY),n=n+p}if(o.boundary){const[v,p,f,u]=t();[g,n]=s(g,n,v,p,f,u)}a.value.left=g,a.value.top=n},onKeyup:h=>{["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"].includes(h.key)&&o.checkCollision&&i()&&(a.value.left=l,a.value.top=d),l=0,d=0}}}function it(o,a,e){const t=_(!1),s=_(!1),i=_({width:a.width,height:a.height,left:a.left,top:a.top,angle:a.angle}),{marklineEmit:c}=st(o,a),l=new Set;function d(u){if(l.add(u.button),a.disabled)return;t.value=!0,s.value=!0;let{clientX:m,clientY:y}=G(u);const{left:L,top:k}=i.value;let r=0,w=0,b=0,x=0;a.boundary&&([r,w,b,x]=h()),c("drag-start"),e&&e("drag-start",i.value),re(E=>{if(l.size>1)return;const{clientX:R,clientY:z}=G(E);let T=(R-m)/a.scaleRatio+L,Y=(z-y)/a.scaleRatio+k;if(a.snapToGrid){let{left:B,top:S}=i.value;const W=T-B,X=Y-S;T=B+ee(W,a.gridX),Y=S+ee(X,a.gridY)}a.boundary&&([T,Y]=g(T,Y,r,w,b,x)),i.value.left=T,i.value.top=Y,e&&e("drag",i.value),Re(()=>{const B=c("drag");a.snap&&(B.diffX&&(i.value.left+=B.diffX),B.diffY&&(i.value.top+=B.diffY))})},E=>{a.checkCollision&&n()&&(i.value.top=k,i.value.left=L),l.clear(),t.value=!1,c("drag-end"),e&&e("drag-end",i.value)})}const h=()=>{let u=0,m=0;const{left:y,top:L,height:k,width:r,angle:w}=i.value,b=o.value.offsetParent||document.body,x=$(b,a.scaleRatio);if(w){const z=$(o.value,a.scaleRatio);u=z.left-Math.floor(y-(z.width-r)+x.left),m=z.top-Math.floor(L-(z.height-k)+x.top)}const E=x.width-r,R=x.height-k;return[u,E-u,m,R-m,x.width,x.height]},g=(u,m,y,L,k,r)=>(u=u<y?y:u,u=u>L?L:u,m=m<k?k:m,m=m>r?r:m,[u,m]),n=()=>{const u=o.value.offsetParent||document.body,m=Array.from(u.children).filter(y=>y!==o.value&&y.classList.contains("es-drager"));for(let y=0;y<m.length;y++){const L=m[y];if(lt(o.value,L,a.scaleRatio))return!0}},v=()=>{s.value=!1},{onKeydown:p,onKeyup:f}=rt(a,i,s,{getBoundary:h,fixBoundary:g,checkDragerCollision:n,emit:e});return O(s,u=>{u?(e("focus",u),document.addEventListener("click",v,{once:!0})):e("blur",u),!a.disabledKeyEvent&&(u?(document.addEventListener("keydown",p),document.addEventListener("keyup",f)):(document.removeEventListener("keydown",p),document.removeEventListener("keyup",f)))}),Ee(()=>{if(o.value){if(!i.value.width&&!i.value.height){const{width:u,height:m}=$(o.value,a.scaleRatio);i.value={...i.value,width:u+2,height:m+2}}if(o.value.addEventListener("mousedown",d),o.value.addEventListener("touchstart",d,{passive:!0}),a.type==="text"){const u=window.getComputedStyle(o.value);i.value.height=parseInt(u.fontSize)}}}),De(()=>{document.removeEventListener("click",v),document.removeEventListener("keydown",p),document.removeEventListener("keyup",f)}),{isMousedown:t,selected:s,dragData:i,getBoundary:h,checkDragerCollision:n}}const dt=A("div",{class:"es-drager-rotate-handle"},[A("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[A("path",{fill:"currentColor",d:"M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"})])],-1),ut=ne({__name:"rotate",props:{modelValue:{type:Number,default:0},element:{type:Object}},emits:["update:modelValue","rotate","rotate-start","rotate-end"],setup(o,{emit:a}){const e=o,t=a,s=_(null),i=P({get:()=>e.modelValue,set:l=>{t("update:modelValue",l)}});function c(l){if(!e.element)return console.warn("[es-drager] rotate component need drag element property");l.stopPropagation();const{width:d,height:h,left:g,top:n}=e.element.getBoundingClientRect(),v=g+d/2,p=n+h/2;t("rotate-start",i.value),re(f=>{const{clientX:u,clientY:m}=G(f),y=v-u,L=p-m,k=Math.atan2(L,y)*180/Math.PI-90;i.value=(k+360)%360,t("rotate",i.value)},()=>{t("rotate-end",i.value)})}return(l,d)=>(H(),j("div",{ref_key:"rotateRef",ref:s,class:"es-drager-rotate",onMousedown:c,onTouchstartPassive:c},[J(l.$slots,"default",{},()=>[dt])],544))}}),ht=["data-side","onMousedown","onTouchstartPassive"],ct=A("div",{class:"es-drager-dot-handle"},null,-1),de=ne({__name:"drager",props:Ue,emits:["change","drag","drag-start","drag-end","resize","resize-start","resize-end","rotate","rotate-start","rotate-end","focus","blur"],setup(o,{emit:a}){const e=o,t=a,s=(r,...w)=>{t(r,...w)},i=_(null),{selected:c,dragData:l,isMousedown:d,getBoundary:h,checkDragerCollision:g}=it(i,e,s),n=_(ye(0,e.resizeList)),v=P(()=>e.resizable&&!e.disabled),p=P(()=>e.rotatable&&!e.disabled&&c.value),f=P(()=>e.type!="text"?n.value:n.value.filter(r=>!["top","bottom"].includes(r.side))),u=P(()=>{const{width:r,height:w,left:b,top:x,angle:E}=l.value,R={};r&&(R.width=U(r)),w&&(e.type==="text"?R.fontSize=w+"px":R.height=U(w));let z=[`translateX(${U(b)})`,`translateY(${U(x)})`,`rotate(${E}deg)`];return{...R,zIndex:e.zIndex,transform:z.join(" "),"--es-drager-color":e.color}});function m(r){i.value||(i.value=r.$el||r)}function y(r){n.value=ye(r,e.resizeList),s("rotate-end",l.value)}function L(r,w){if(e.disabled)return;w.stopPropagation();const{clientX:b,clientY:x}=G(w),E=b,R=x,{width:z,height:T,left:Y,top:B}=l.value,S=Y+z/2,W=B+T/2,X={width:z,height:T,centerX:S,centerY:W,rotateAngle:l.value.angle},q=r.side;let{minWidth:ze,minHeight:Be,aspectRatio:te,equalProportion:Te}=e;s("resize-start",l.value,q);let ue=[];e.boundary&&(ue=h()),["text","image"].includes(e.type)&&q.includes("-")&&(te=X.width/X.height),re(he=>{const{clientX:Xe,clientY:Ye}=G(he);let K=(Xe-E)/e.scaleRatio,F=(Ye-R)/e.scaleRatio;e.snapToGrid&&(K=ee(K,e.gridX),F=ee(F,e.gridY));const Ae=Math.atan2(F,K),ce=et(K,F),_e=he.shiftKey,pe=Ae-ie(X.rotateAngle),Se=ce*Math.cos(pe),Ne=ce*Math.sin(pe),fe=(Te||_e)&&!te?X.width/X.height:te,{position:{centerX:ge,centerY:ve},size:{width:Pe,height:He}}=tt(q,{...X,rotateAngle:X.rotateAngle},Se,Ne,fe,ze,Be),$e=at({centerX:ge,centerY:ve,width:Pe,height:He,angle:l.value.angle});let V={...l.value,...ot($e,ge,ve)};e.maxWidth>0&&(V.width=Math.min(V.width,e.maxWidth)),e.maxHeight>0&&(V.height=Math.min(V.height,e.maxHeight)),e.boundary&&(V=k(V,ue,fe)),l.value=V,s("resize",l.value,q)},()=>{e.checkCollision&&g()&&(l.value={...l.value,width:z,height:T,left:Y,top:B}),s("resize-end",l.value,q)})}function k(r,w,b){const[x,E,R,z,T,Y]=w,B=r.left<x,S=r.left+r.width>T,W=r.top<R,X=r.top+r.height>Y;return B&&(r.left=x,r.width=l.value.width),W&&(r.top=R,r.height=l.value.height),(S||X)&&(S&&(r.left=l.value.left),X&&(r.top=l.value.top),X||(r.width=T-r.left),S||(r.height=Y-r.top)),(X||W)&&b&&(r.width=l.value.width,r.left=l.value.left),(S||B)&&b&&(r.height=l.value.height,r.top=l.value.top),r}return O(()=>[e.width,e.height,e.left,e.top,e.angle],([r,w,b,x,E],[R,z,T,Y,B])=>{r!==R&&(l.value.width=r),w!==z&&(l.value.height=w),b!==T&&(l.value.left=b),x!==Y&&(l.value.top=x),E!==B&&(l.value.angle=E)}),O(()=>l.value,r=>{t("change",{...r})},{deep:!0}),O(()=>e.selected,r=>{c.value=r},{immediate:!0}),(r,w)=>(H(),Q(Ce(r.tag),{ref:m,class:Me(["es-drager",`es-drager-${r.type}`,{disabled:r.disabled,dragging:N(d),selected:N(c),border:r.border}]),style:Z(u.value),onClick:w[3]||(w[3]=I(()=>{},["stop"])),onMousedown:w[4]||(w[4]=I(()=>{},["stop"]))},{default:D(()=>[J(r.$slots,"default"),v.value?(H(!0),j(Le,{key:0},xe(f.value,(b,x)=>(H(),j("div",{key:x,class:"es-drager-dot","data-side":b.side,style:Z({...b}),onMousedown:E=>L(b,E),onTouchstartPassive:E=>L(b,E)},[J(r.$slots,"resize",Ve(We({side:b.side})),()=>[ct])],44,ht))),128)):me("",!0),p.value?(H(),Q(ut,{key:1,modelValue:N(l).angle,"onUpdate:modelValue":w[0]||(w[0]=b=>N(l).angle=b),element:i.value,onRotate:w[1]||(w[1]=b=>s("rotate",N(l))),onRotateStart:w[2]||(w[2]=b=>s("rotate-start",N(l))),onRotateEnd:y},{default:D(()=>[J(r.$slots,"rotate")]),_:3},8,["modelValue","element"])):me("",!0)]),_:3},40,["class","style"]))}}),pt=o=>{o.component("es-drager",de)};de.install=pt;const ft={class:"btns"},gt=["onClick"],vt=["onClick"],mt=["onClick"],bt=ne({__name:"esDragle",setup(o){const a=qe(),e=_(),t=_(),s=Ie({scale:1,thick:20,width:1470,height:700,showShadowText:!1,canvasWidth:1e3,canvasHeight:500,showRuler:!0,palette:{bgColor:"transparent",lineType:"dashed"},isShowReferLine:!0,shadow:{x:0,y:0,width:0,height:0},lines:{h:[300],v:[400]}}),i=_({componentList:[{id:"div1",component:"div",text:"div1",width:100,height:100,left:0,top:0},{id:"div2",component:"div",text:"div2",width:100,height:100,top:100,left:100}]}),c=P(()=>({width:`${s.width}px`,height:`${s.height}px`})),l=P(()=>({width:`${s.canvasWidth}px`,height:`${s.canvasHeight}px`,position:"relative",background:a.isLight?"#eff2f5":"#333333"})),d=(g,n)=>{Re(()=>{s.shadow={x:n.left,y:n.top,width:n.width,height:n.height}}),Object.keys(g).forEach(v=>{n[v]=g[v]})},h=g=>Array.from(document.querySelectorAll(".sketch-ruler .lines .line"));return(g,n)=>(H(),j("div",null,[A("div",{class:Me(["wrapper",[N(a).isLight?"whitewrapper":"blackwrapper"]]),style:Z(c.value)},[je(N(Fe),we({ref_key:"sketchruleRef",ref:e,scale:s.scale,"onUpdate:scale":n[0]||(n[0]=v=>s.scale=v)},s),{default:D(()=>[A("div",{ref_key:"dragParentRef",ref:t,"data-type":"page",style:Z(l.value)},[(H(!0),j(Le,null,xe(i.value.componentList,v=>(H(),Q(N(de),we({ref_for:!0},v,{key:v.id,snap:"","scale-ratio":s.scale,class:"dragerItem","snap-threshold":10,markline:"","extra-lines":h,onChange:p=>d(p,v)}),{default:D(()=>[(H(),Q(Ce(v.component),null,{default:D(()=>[Ge(Ke(v.text),1)]),_:2},1024))]),_:2},1040,["scale-ratio","onChange"]))),128))],4)]),btn:D(({reset:v,zoomIn:p,zoomOut:f})=>[A("div",ft,[A("button",{onClick:I(v,["stop"])},"还原",8,gt),A("button",{onClick:I(p,["stop"])},"放大",8,vt),A("button",{onClick:I(f,["stop"])},"缩小",8,mt)])]),_:1},16,["scale"])],6)]))}});export{bt as default};
