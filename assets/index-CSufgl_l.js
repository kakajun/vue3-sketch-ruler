import{d as he,r as X,c as N,p as Ee,b as D,q as G,x as Le,e as j,y as J,k as be,n as V,z as _,f as xe,o as W,A as Ae,m as Me,F as He,s as Ye,j as We,u as R,t as Oe,a as Ve,B as Ie,g as de,C as De}from"./index-BUVo8PGg.js";/*!vue3-sketch-ruler v2.2.102025年6月Wed Jun 18 2025 09:39:13 GMT+0000 (Coordinated Universal Time)制作*/const Qe=e=>e<=.25?40:e<=.5?20:e<=1?10:e<=2?5:e<=4?2:1;function Fe(e,t,n,a,s,c){c?s.moveTo(e,0):s.moveTo(0,e),s.save(),c?s.translate(e+5,a*.2):s.translate(n*.1,e+32),c||s.rotate(-Math.PI/2),s.fillText(Math.round(t).toString(),4,7),s.restore(),c?s.lineTo(e,a):s.lineTo(n,e),s.stroke(),s.closePath(),s.setTransform(1,0,0,1,0,0)}function re(e,t,n,a,s,c){a.fillStyle=s.fontShadowColor,a.strokeStyle=s.longfgColor,a.save(),a.translate(e,t),c||a.rotate(-Math.PI/2),a.font="bold 12px  Aria",a.fillText(String(n),0,0),a.restore()}const qe=(e,t,n,a,s,c)=>{const{scale:d,width:m,height:u,ratio:L,palette:C,gridRatio:S,showShadowText:E}=s,{bgColor:p,fontColor:h,shadowColor:M,longfgColor:z}=C,g=c?s.canvasWidth:s.canvasHeight;e.setTransform(1,0,0,1,0,0),e.scale(L,L),e.clearRect(0,0,m,u),e.fillStyle=p,e.fillRect(0,0,m,u);const w=Qe(d)*S*10,k=w*d,B=Math.floor(t/w)*w,P=(B-t)/w*k,O=t+Math.ceil((c?m:u)/d);if(a){const y=(n-t)*d,T=a*d;if(e.fillStyle=M,c?e.fillRect(y,0,T,u):e.fillRect(0,y,m,T),E)if(c){re(y,u*.4,Math.round(n),e,C,c);const A=(n+a-t)*d;re(A,u*.4,Math.round(n+a),e,C,c)}else{re(m*.4,y,Math.round(n),e,C,c);const A=(n+a-t)*d;re(m*.4,A,Math.round(n+a),e,C,c)}}e.beginPath(),e.fillStyle=h,e.strokeStyle=z;for(let y=B,T=0;y<O;y+=w,T++){const A=P+T*k+.5;if(y-w<g&&y>g||y==g){const I=P+T*k+.5+(g-y)*d;Fe(I,g,m,u,e,c);return}y>=0&&y<=g&&(y==0?c?(e.moveTo(A,0),e.lineTo(A,u)):(e.moveTo(0,A),e.lineTo(m,A)):c?(e.moveTo(A,20),e.lineTo(A,u/1.3)):(e.moveTo(20,A),e.lineTo(m/1.3,A)),e.save(),y==0?c?e.translate(A-15,u*.01):e.translate(m*.3,A-5):c?e.translate(A-12,u*.05):e.translate(m*.05,A+12),c||e.rotate(-Math.PI/2),g-y>w/2&&(!E||a==0||Math.abs(y-n)>w/2&&Math.abs(y-(n+a))>w/2)&&e.fillText(y.toString(),4,9),e.restore())}e.stroke(),e.closePath()};function Se(e,t=100){let n=null;const a=function(...s){n!==null&&clearTimeout(n),n=setTimeout(()=>{e(...s)},t)};return a.cancel=function(){n!==null&&(clearTimeout(n),n=null)},a}function Xe(e,t){const n=X(0),a=X(0),s=X(!1),c=N(()=>({backgroundColor:e.palette.hoverBg,color:e.palette.hoverColor,[t?"top":"left"]:"-8px",[t?"left":"top"]:`${n.value+10}px`})),d=({offsetX:p,offsetY:h})=>{n.value=t?p:h},m=(p,h)=>new Promise(M=>{if(e.lockLine)return;const z=t?p.clientY:p.clientX;d(p);const g=h||a.value;let w=g;const k=P=>{let O=((t?P.clientY:P.clientX)-z)/e.scale+g,y=O;const T=(t?e.snapsObj.h:e.snapsObj.v).slice().sort((A,I)=>Math.abs(y-A)-Math.abs(y-I));T.length&&Math.abs(T[0]-O)<e.snapThreshold/e.scale&&(y=T[0],O=y),w=Math.round(O),a.value=w},B=()=>{document.removeEventListener("mousemove",k),u(w,e.index),M()};document.addEventListener("mousemove",k),document.addEventListener("mouseup",B,{once:!0})}),u=(p,h)=>{var M,z;const g=t?(M=e.lines)==null?void 0:M.h:(z=e.lines)==null?void 0:z.v,w=L(p);if(g)if(w)if(typeof h=="number")g.splice(h,1);else return;else typeof h!="number"?g.push(p):g[h]=p},L=p=>{const h=t?e.canvasHeight:e.canvasWidth;return p<0||p>h},C=N(()=>L(a.value)?"放开删除":`${t?"Y":"X"}：${a.value*e.rate}`),S=Se(()=>{s.value=!1},200),E=Se(()=>{s.value=!0},200);return{showLabel:s,startValue:a,actionStyle:c,labelContent:C,handleMouseDown:m,handleMouseenter:p=>{e.lockLine||(d(p),E(),S.cancel())},handleMouseLeave:()=>{S()}}}const Ge={key:0,class:"value"},Ke=he({__name:"ruler-line",props:{scale:{},palette:{},index:{},start:{},vertical:{type:Boolean},value:{},canvasWidth:{},canvasHeight:{},lines:{},isShowReferLine:{type:Boolean},rate:{},snapThreshold:{},snapsObj:{},lockLine:{type:Boolean}},setup(e){const t=e,n=X(!1),{actionStyle:a,handleMouseDown:s,labelContent:c,startValue:d,showLabel:m,handleMouseenter:u,handleMouseLeave:L}=Xe(t,t.vertical),C=N(()=>d.value>=t.start),S=N(()=>{const{lineType:p,lockLineColor:h,lineColor:M}=t.palette,z=t.lockLine?h:M??"black",g=t.lockLine||n.value?"none":"auto",w=t.isShowReferLine&&!t.lockLine?t.vertical?"ns-resize":"ew-resize":"default",k=t.vertical?"borderTop":"borderLeft",B=(d.value-t.start)*t.scale;return{[k]:`1px ${p} ${z}`,pointerEvents:g,cursor:w,[t.vertical?"top":"left"]:`${B}px`}});Ee(()=>{d.value=t.value??0});const E=Se(()=>{n.value=!1},1e3);return G([()=>t.scale],()=>{n.value=!0,E()}),(p,h)=>J((W(),D("div",{class:"line",style:V(S.value),onMouseenter:h[0]||(h[0]=de((...M)=>R(u)&&R(u)(...M),["stop"])),onMouseleave:h[1]||(h[1]=de((...M)=>R(L)&&R(L)(...M),["stop"])),onMousedown:h[2]||(h[2]=de((...M)=>R(s)&&R(s)(...M),["stop"]))},[j("div",{class:"action",style:V(R(a))},[R(m)?(W(),D("span",Ge,Oe(R(c)),1)):Ae("",!0)],4)],36)),[[_,C.value]])}}),$e=he({__name:"index",props:{scale:{},palette:{},vertical:{type:Boolean},showShadowText:{type:Boolean},start:{},width:{},height:{},selectStart:{},selectLength:{},canvasWidth:{},canvasHeight:{},rate:{},gridRatio:{}},emits:["handleDragStart"],setup(e,{emit:t}){const n=e,a=t,s=Ve({isDragging:!1,canvasContext:null});let c=window.devicePixelRatio;const d=X(null);Ee(()=>{window.addEventListener("resize",m),u(),C(c),S(c)});const m=()=>{c=window.devicePixelRatio,C(c),S(c)},u=()=>{var p;s.canvasContext=((p=d.value)==null?void 0:p.getContext("2d"))||null},L=N(()=>({width:n.width+"px",height:n.height+"px",cursor:n.vertical?"ew-resize":"ns-resize",[n.vertical?"borderRight":"borderBottom"]:`1px solid ${n.palette.borderColor||"#eeeeef"} `}));Ie(()=>{window.removeEventListener("resize",m)});const C=p=>{if(d.value){d.value.width=Math.round(n.width*p),d.value.height=Math.round(n.height*p);const h=s.canvasContext;h&&(h.font=`11px -apple-system,
                "Helvetica Neue", ".SFNSText-Regular",
                "SF UI Text", Arial, "PingFang SC", "Hiragino Sans GB",
                "Microsoft YaHei", "WenQuanYi Zen Hei", sans-serif`,h.lineWidth=1,h.textBaseline="middle")}},S=p=>{const h={scale:n.scale,width:n.width,height:n.height,palette:n.palette,canvasWidth:n.canvasWidth,canvasHeight:n.canvasHeight,ratio:p,rate:n.rate,gridRatio:n.gridRatio,showShadowText:n.showShadowText};h.scale=n.scale/n.rate,h.canvasWidth=n.canvasWidth*n.rate,h.canvasHeight=n.canvasHeight*n.rate,s.canvasContext&&qe(s.canvasContext,n.start*n.rate,n.selectStart,n.selectLength,h,!n.vertical)};G([()=>n.width,()=>n.height,()=>n.start,()=>n.palette,()=>n.selectStart,()=>n.selectLength],()=>{S(c)}),G([()=>n.width,()=>n.height],()=>{C(c)});const E=p=>{a("handleDragStart",p)};return(p,h)=>(W(),D("canvas",{ref_key:"canvas",ref:d,class:"ruler",style:V(L.value),onMousedown:de(E,["stop"])},null,36))}}),Ze={class:"lines"},je={key:0,class:"value"},Te=he({__name:"ruler-wrapper",props:{scale:{},thick:{},canvasWidth:{},canvasHeight:{},palette:{},vertical:{type:Boolean},width:{},height:{},start:{},startOther:{},lines:{},selectStart:{},selectLength:{},isShowReferLine:{type:Boolean},rate:{},snapThreshold:{},snapsObj:{},gridRatio:{},lockLine:{type:Boolean},showShadowText:{type:Boolean}},emits:["changeLineState"],setup(e,{emit:t}){const n=e,{showLabel:a,actionStyle:s,handleMouseenter:c,handleMouseLeave:d,handleMouseDown:m,labelContent:u,startValue:L}=Xe(n,!n.vertical),C=X(!1),S=X(!1),E=N(()=>n.vertical?"v-container":"h-container"),p=t,h=N(()=>{var g,w;return n.vertical?(g=n.lines)==null?void 0:g.h:(w=n.lines)==null?void 0:w.v}),M=N(()=>{const g=n.palette.lineType;let w=n.vertical?"left":"top",k=n.vertical?"top":"left",B=n.vertical?"borderLeft":"borderBottom";const P=(L.value-n.startOther)*n.scale+n.thick;return{[w]:P+"px",[k]:-n.thick+"px",cursor:n.vertical?"ew-resize":"ns-resize",[B]:`1px ${g} ${n.palette.lineColor}`}}),z=async g=>{const{offsetX:w,offsetY:k}=g,{scale:B,vertical:P,thick:O,startOther:y}=n;if(!C.value){S.value=!0,p("changeLineState",!1);let T=Math.round(y-O/B+(P?w:k)/B);L.value=T,await m(g,T),S.value=!1}};return G([()=>n.lockLine],()=>{C.value=n.lockLine}),(g,w)=>(W(),D("div",{class:be(E.value)},[xe($e,Me(g.$props,{onHandleDragStart:z}),null,16),J(j("div",Ze,[(W(!0),D(He,null,Ye(h.value,(k,B)=>(W(),We(Ke,Me({key:k+B,index:B,value:k>>0},{ref_for:!0},g.$props),null,16,["index","value"]))),128))],512),[[_,g.isShowReferLine]]),g.isShowReferLine?J((W(),D("div",{key:0,class:"indicator",style:V(M.value),onMouseenter:w[0]||(w[0]=(...k)=>R(c)&&R(c)(...k)),onMouseleave:w[1]||(w[1]=(...k)=>R(d)&&R(d)(...k))},[j("div",{class:"action",style:V(R(s))},[R(a)?(W(),D("span",je,Oe(R(u)),1)):Ae("",!0)],4)],36)),[[_,S.value]]):Ae("",!0)],2))}}),Je="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAopJREFUOE/FlE9IVEEcx7+/N9ouds1Mu0QUSFZYdIgoUqQoKPBQHsKozpXE7jbTO/U8xLJvn6usBHWQ6hBFXupSkQeVbh0KJEPp0sH+eLGTsKs77xcj78m0ax0E8cHjzZv5zef3/c33xxA24KENYGJzoEEQbNNaN4Zh2OQ4znwYhr9c1/39vwrXVDo0NNS0tLR0GYB5D64BmAMwzMyvlFKz1es10Hw+f4mZ7wHYBeA9gNdENFepVOaEEM3M3OI4Thczn41gt6WUgQ3+C+r7/h0AWQD3mXnYqPA8L9nQ0HCemduIaFpKOWoAhUJhT6VSuQXgOjP3K6W8GLwKzeVyp4jonR0QBEErM48w8zFLyayUsjX+z+VyHhHdZebTSqkxM78CHRgYOKS1/ghgVErZY214RkQ7ADyRUj72ff8qgCtmXUrZGcf5vv8CwEUhxOF0Ov1pBRpla5dSdseBhUJhpznH6tIsZb1KqacW+BGArUaUXX63UuplHJTNZjuEEONSyhozfd/n6mQ1RkXZL2itz7mu+80EDA4ONi8vL/8AcM2UbikyR2BU9cSmmTU70YqKIAj2hWFo2uenlHK/BRg3Y2aeNO5GyU8S0ZbFxcUuz/NKEXAGQKPjOCcymcyX1dIi8DSAiWQyeaavr68cbSgCuBknYubnQoj+TCYzUywWE6VS6S2ADsdx2gxw1X3L7SNENMbMnwE8qK+vf5NKpRaMaeVyeW8ikfiaSqW+R7BuZr5BRMe11p2u607U9Gk8kc/ntzPzQwCmExYATDLzVBiGE0KIowAOADDf3QA+aK2VDaxRajto3K+rq+tl5nYAzQBamHmeiOYBTGmtR6ph/1Rqg9c73pz7dD1qN0TpHyNQRCUDJXrAAAAAAElFTkSuQmCC",_e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAjtJREFUOE/NlD9oFEEUxn9v9ghC0hpRUogIAUmniGAT/5Q2FrETPSNRJILg7RwimI0ox85eQFCEBGIUO1PYpFM0jSConQoBEZGgGPsgl+w+2eM2bC57SopAFqYZ3v7m+977ZoQt+GQLmGxPaBiGgYiMWWvXBHZUGoZhH3BERPYC+4F+4Keq/urt7b1RLpf/ZEBVHa9Wq0HWyg3QKIoGVPU8cA7wgK/pUtXPQJ8xZk+pVBpuNBqXUoUiEvi+P56fzTpo6+SbwHNg1lo7WzTITGEKXFlZeeB53tVCpa3CK8AFa+1cBgvD8LKIXAQOJkkyICJDeYVBEJS6u7s/qeoLa+1o+l9TqXNuBLhmjDlbqVQ+5ICjInIfOBPH8W9jzGCR5YmJiRNxHM+papgqzqDvgSlr7VTernPuO3An3c9bBt74vv+yrdaKyLDv+/1Sq9UGPc97nY9EVuycU2AQOA7cAm4Dr4D5TvVxHB9rKo2iaEFVp621Ln96FEUngaOqGmSxabVqsh3a2h+x1h5qQjNrae/yE4+iaCwDJkky73neTuBZe129Xk+H+BS4l7ZqLVIZ2BhzuFKpvMsDVXXWGPMxFdAedOfcKeCRqj7MYrUhpz09PfXl5eXrectFWXXODQHpOq2qd/95o/JXr6ura3J1dXU6SZIfwKKIHAD2tVYMPBGRx77vN10UXtO85fTkmZmZHUtLSzUR2QXsBhaAL6r6DXhbrVYXi1yss59GqOgub/bN3Z7v6X/tb9Zmp/q/kN8s+lJb8oEAAAAASUVORK5CYII=";/*!simple-panzoom v1.0.72024年8月Sat Aug 10 2024 16:04:04 GMT+0800 (中国标准时间)制作*/typeof window<"u"&&(window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach),typeof window.CustomEvent!="function"&&(window.CustomEvent=function(e,t){t=t||{bubbles:!1,cancelable:!1,detail:null};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}));function Ne(e,t){let n=e.length;for(;n--;)if(e[n].pointerId===t.pointerId)return n;return-1}function Ce(e,t){let n;if(t.touches){n=0;for(const a of t.touches)a.pointerId=n++,Ce(e,a);return}n=Ne(e,t),n>-1&&e.splice(n,1),e.push(t)}function et(e,t){if(t.touches){for(;e.length;)e.pop();return}const n=Ne(e,t);n>-1&&e.splice(n,1)}function Be(e){e=e.slice(0);let t=e.pop(),n;for(;n=e.pop();)t={clientX:(n.clientX-t.clientX)/2+t.clientX,clientY:(n.clientY-t.clientY)/2+t.clientY};return t}function ge(e){if(e.length<2)return 0;const t=e[0],n=e[1];return Math.sqrt(Math.pow(Math.abs(n.clientX-t.clientX),2)+Math.pow(Math.abs(n.clientY-t.clientY),2))}let oe={down:"mousedown",move:"mousemove",up:"mouseup mouseleave"};typeof window<"u"&&(typeof window.PointerEvent=="function"?oe={down:"pointerdown",move:"pointermove",up:"pointerup pointerleave pointercancel"}:typeof window.TouchEvent=="function"&&(oe={down:"touchstart",move:"touchmove",up:"touchend touchcancel"}));function we(e,t,n,a){oe[e].split(" ").forEach(s=>{t.addEventListener(s,n,a)})}function ye(e,t,n){oe[e].split(" ").forEach(a=>{t.removeEventListener(a,n)})}const tt=typeof document<"u"&&!!document.documentMode;let Re;function nt(){return Re||(Re=document.createElement("div").style)}const ze=["webkit","moz","ms"],se={};function ke(e){if(se[e])return se[e];const t=nt();if(e in t)return se[e]=e;const n=e[0].toUpperCase()+e.slice(1);let a=ze.length;for(;a--;){const s=`${ze[a]}${n}`;if(s in t)return se[e]=s}}function ie(e,t){return parseFloat(t[ke(e)])||0}function ce(e,t,n=window.getComputedStyle(e)){const a=t==="border"?"Width":"";return{left:ie(`${t}Left${a}`,n),right:ie(`${t}Right${a}`,n),top:ie(`${t}Top${a}`,n),bottom:ie(`${t}Bottom${a}`,n)}}function Z(e,t,n){e.style[ke(t)]=n}function at(e,t){const n=ke("transform");Z(e,"transition",`${n} ${t.duration}ms ${t.easing}`)}function ot(e,{x:t,y:n,scale:a,isSVG:s},c){if(Z(e,"transform",`scale(${a}) translate(${t}px, ${n}px)`),s&&tt){const d=window.getComputedStyle(e).getPropertyValue("transform");e.setAttribute("transform",d)}}function ue(e){const t=e.parentNode,n=window.getComputedStyle(e),a=window.getComputedStyle(t),s=e.getBoundingClientRect(),c=t.getBoundingClientRect();return{elem:{style:n,width:s.width,height:s.height,top:s.top,bottom:s.bottom,left:s.left,right:s.right,margin:ce(e,"margin",n),border:ce(e,"border",n)},parent:{style:a,width:c.width,height:c.height,top:c.top,bottom:c.bottom,left:c.left,right:c.right,padding:ce(t,"padding",a),border:ce(t,"border",a)}}}function lt(e){let t=e;for(;t&&t.parentNode;){if(t.parentNode===document)return!0;t=t.parentNode instanceof ShadowRoot?t.parentNode.host:t.parentNode}return!1}function rt(e){return(e.getAttribute("class")||"").trim()}function st(e,t){return e.nodeType===1&&` ${rt(e)} `.indexOf(` ${t} `)>-1}function it(e,t){for(let n=e;n!=null;n=n.parentNode)if(st(n,t.excludeClass)||t.exclude.indexOf(n)>-1)return!0;return!1}const ct=/^http:[\w\.\/]+svg$/;function ut(e){return ct.test(e.namespaceURI)&&e.nodeName.toLowerCase()!=="svg"}function dt(e){const t={};for(const n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}const Pe={animate:!1,canvas:!1,cursor:"move",disablePan:!1,disableZoom:!1,disableXAxis:!1,disableYAxis:!1,duration:200,easing:"ease-in-out",exclude:[],excludeClass:"panzoom-exclude",handleStartEvent:e=>{e.preventDefault(),e.stopPropagation()},maxScale:4,minScale:.125,overflow:"hidden",panOnlyWhenZoomed:!1,pinchAndPan:!1,relative:!1,setTransform:ot,startX:0,startY:0,startScale:1,step:.3,touchAction:"none"};function Ue(e,t){if(!e)throw new Error("Panzoom requires an element as an argument");if(e.nodeType!==1)throw new Error("Panzoom requires an element with a nodeType of 1");if(!lt(e))throw new Error("Panzoom should be called on elements that have been attached to the DOM");t={...Pe,...t};const n=ut(e),a=e.parentNode;a.style.overflow=t.overflow,a.style.userSelect="none",a.style.touchAction=t.touchAction,(t.canvas?a:e).style.cursor=t.cursor,e.style.userSelect="none",e.style.touchAction=t.touchAction,Z(e,"transformOrigin",typeof t.origin=="string"?t.origin:n?"0 0":"50% 50%");function s(){a.style.overflow="",a.style.userSelect="",a.style.touchAction="",a.style.cursor="",e.style.cursor="",e.style.userSelect="",e.style.touchAction="",Z(e,"transformOrigin","")}function c(o={}){for(const l in o)o.hasOwnProperty(l)&&(t[l]=o[l]);(o.hasOwnProperty("cursor")||o.hasOwnProperty("canvas"))&&(a.style.cursor=e.style.cursor="",(t.canvas?a:e).style.cursor=t.cursor),o.hasOwnProperty("overflow")&&(a.style.overflow=o.overflow),o.hasOwnProperty("touchAction")&&(a.style.touchAction=o.touchAction,e.style.touchAction=o.touchAction)}let d=0,m=0,u=1,L=!1;M(t.startScale,{animate:!1,force:!0}),setTimeout(()=>{h(t.startX,t.startY,{animate:!1,force:!0})});function C(o,l,v){if(v.silent)return;const b=new CustomEvent(o,{detail:l});e.dispatchEvent(b)}function S(o,l,v){const b={x:d,y:m,scale:u,isSVG:n,originalEvent:v,dimsOut:{}};typeof l.animate=="boolean"&&(l.animate?at(e,l):Z(e,"transition","none")),l.setTransform(e,b,l);function i(){const x=ue(e);b.dimsOut=x,C(o,b,l),C("panzoomchange",b,l)}return l.animate?setTimeout(()=>{i()},l.duration+50):requestAnimationFrame(()=>{i()}),b}function E(o,l,v,b){const i={...t,...b},x={x:d,y:m,opts:i};if(!i.force&&(i.disablePan||i.panOnlyWhenZoomed&&u===i.startScale))return x;if(o=parseFloat(o),l=parseFloat(l),i.disableXAxis||(x.x=(i.relative?d:0)+o),i.disableYAxis||(x.y=(i.relative?m:0)+l),i.contain){const f=ue(e),Y=f.elem.width/u,H=f.elem.height/u,ne=Y*v,ae=H*v,F=(ne-Y)/2,q=(ae-H)/2;if(i.contain==="inside"){const pe=(-f.elem.margin.left-f.parent.padding.left+F)/v,fe=(f.parent.width-ne-f.parent.padding.left-f.elem.margin.left-f.parent.border.left-f.parent.border.right+F)/v;x.x=Math.max(Math.min(x.x,fe),pe);const ve=(-f.elem.margin.top-f.parent.padding.top+q)/v,me=(f.parent.height-ae-f.parent.padding.top-f.elem.margin.top-f.parent.border.top-f.parent.border.bottom+q)/v;x.y=Math.max(Math.min(x.y,me),ve)}else if(i.contain==="outside"){const pe=(-(ne-f.parent.width)-f.parent.padding.left-f.parent.border.left-f.parent.border.right+F)/v,fe=(F-f.parent.padding.left)/v;x.x=Math.max(Math.min(x.x,fe),pe);const ve=(-(ae-f.parent.height)-f.parent.padding.top-f.parent.border.top-f.parent.border.bottom+q)/v,me=(q-f.parent.padding.top)/v;x.y=Math.max(Math.min(x.y,me),ve)}}return i.roundPixels&&(x.x=Math.round(x.x),x.y=Math.round(x.y)),x}function p(o,l){const v={...t,...l},b={scale:u,opts:v};if(!v.force&&v.disableZoom)return b;let i=t.minScale,x=t.maxScale;if(v.contain){const f=ue(e),Y=f.elem.width/u,H=f.elem.height/u;if(Y>1&&H>1){const ne=f.parent.width-f.parent.border.left-f.parent.border.right,ae=f.parent.height-f.parent.border.top-f.parent.border.bottom,F=ne/Y,q=ae/H;t.contain==="inside"?x=Math.min(x,F,q):t.contain==="outside"&&(i=Math.max(i,F,q))}}return b.scale=Math.min(Math.max(o,i),x),b}function h(o,l,v,b){const i=E(o,l,u,v);return d!==i.x||m!==i.y?(d=i.x,m=i.y,S("panzoompan",i.opts,b)):{x:d,y:m,scale:u,isSVG:n,originalEvent:b}}function M(o,l,v){const b=p(o,l),i=b.opts;if(!i.force&&i.disableZoom)return;o=b.scale;let x=d,f=m;if(i.focal){const H=i.focal;x=(H.x/o-H.x/u+d*o)/o,f=(H.y/o-H.y/u+m*o)/o}const Y=E(x,f,o,{relative:!1,force:!0});return d=Y.x,m=Y.y,u=o,S("panzoomzoom",i,v)}function z(o,l){const v={...t,animate:!0,...l};return M(u*Math.exp((o?1:-1)*v.step),v)}function g(o){return z(!0,o)}function w(o){return z(!1,o)}function k(o,l,v,b){const i=ue(e),x={width:i.parent.width-i.parent.padding.left-i.parent.padding.right-i.parent.border.left-i.parent.border.right,height:i.parent.height-i.parent.padding.top-i.parent.padding.bottom-i.parent.border.top-i.parent.border.bottom};let f=l.clientX-i.parent.left-i.parent.padding.left-i.parent.border.left-i.elem.margin.left,Y=l.clientY-i.parent.top-i.parent.padding.top-i.parent.border.top-i.elem.margin.top;n||(f-=i.elem.width/u/2,Y-=i.elem.height/u/2);const H={x:f/x.width*(x.width*o),y:Y/x.height*(x.height*o)};return M(o,{...v,animate:!1,focal:H},b)}function B(o,l){o.preventDefault();const v={...t,...l,animate:!1},b=(o.deltaY===0&&o.deltaX?o.deltaX:o.deltaY)<0?1:-1,i=p(u*Math.exp(b*v.step/3),v).scale;return k(i,o,v,o)}function P(o){const l={...t,animate:!0,force:!0,...o};u=p(l.startScale,l).scale;const v=E(l.startX,l.startY,u,l);return d=v.x,m=v.y,S("panzoomreset",l)}let O,y,T,A,I,Q;const U=[];function K(o){if(it(o.target,t))return;Ce(U,o),L=!0,t.handleStartEvent(o),O=d,y=m,C("panzoomstart",{x:d,y:m,scale:u,isSVG:n,originalEvent:o},t);const l=Be(U);T=l.clientX,A=l.clientY,I=u,Q=ge(U)}function ee(o){if(!L||O===void 0||y===void 0||T===void 0||A===void 0)return;Ce(U,o);const l=Be(U),v=U.length>1;let b=u;if(v){Q===0&&(Q=ge(U));const i=ge(U)-Q;b=p(i*t.step/80+I).scale,k(b,l,{animate:!1},o)}(!v||t.pinchAndPan)&&h(O+(l.clientX-T)/b,y+(l.clientY-A)/b,{animate:!1},o)}function te(o){U.length===1&&C("panzoomend",{x:d,y:m,scale:u,isSVG:n,originalEvent:o},t),et(U,o),L&&(L=!1,O=y=T=A=void 0)}let $=!1;function le(){$||($=!0,we("down",t.canvas?a:e,K),we("move",document,ee,{passive:!0}),we("up",document,te,{passive:!0}))}function r(){$=!1,ye("down",t.canvas?a:e,K),ye("move",document,ee),ye("up",document,te)}return t.noBind||le(),{bind:le,destroy:r,eventNames:oe,getPan:()=>({x:d,y:m}),getScale:()=>u,getOptions:()=>dt(t),handleDown:K,handleMove:ee,handleUp:te,pan:h,reset:P,resetStyle:s,setOptions:c,setStyle:(o,l)=>Z(e,o,l),zoom:M,zoomIn:g,zoomOut:w,zoomToPoint:k,zoomWithWheel:B}}Ue.defaultOptions=Pe;const ht={class:"sketch-ruler"},ft=he({__name:"index",props:{showRuler:{type:Boolean,default:!0},eyeIcon:{},closeEyeIcon:{},scale:{default:1},rate:{default:1},thick:{default:16},palette:{},width:{default:1400},height:{default:800},paddingRatio:{default:.2},autoCenter:{type:Boolean,default:!0},shadow:{default:()=>({x:0,y:0,width:0,height:0})},lines:{default:()=>({h:[],v:[]})},isShowReferLine:{type:Boolean,default:!0},canvasWidth:{default:700},canvasHeight:{default:700},snapsObj:{default:()=>({h:[],v:[]})},snapThreshold:{default:5},gridRatio:{default:1},lockLine:{type:Boolean,default:!1},selfHandle:{type:Boolean,default:!1},showShadowText:{type:Boolean,default:!0},panzoomOption:{}},emits:["onCornerClick","update:scale","zoomchange","update:lockLine"],setup(e,{expose:t,emit:n}){De(r=>({d51170aa:le.value}));const a=e,s=n,c=X(null),d=X(0),m=X(0);let u=0,L=0;const C=X(1),S=X(a.isShowReferLine),E=X(null),p=X("defaultCursor"),h=N(()=>({bgColor:"#f6f7f9",longfgColor:"#BABBBC",fontColor:"#7D8694",fontShadowColor:"#106ebe",shadowColor:"#e9f7fe",lineColor:"#51d6a9",lineType:"solid",lockLineColor:"#d4d7dc",hoverBg:"#000",hoverColor:"#fff",borderColor:"#eeeeef",...a.palette})),M=N(()=>({backgroundImage:S.value?`url(${a.eyeIcon??Je})`:`url(${a.closeEyeIcon??_e})`,width:a.thick+"px",height:a.thick+"px",borderRight:`1px solid ${h.value.borderColor}`,borderBottom:`1px solid ${h.value.borderColor}`})),z=N(()=>({background:h.value.bgColor,width:g.value+"px",height:w.value+"px"})),g=N(()=>a.width-a.thick),w=N(()=>a.height-a.thick),k=r=>{var o;(r.ctrlKey||r.metaKey)&&((o=E.value)==null||o.zoomWithWheel(r))},B=r=>{var o;const l=document.activeElement;l!=null&&l.closest(".monaco-editor")||(l==null?void 0:l.tagName)==="INPUT"||(l==null?void 0:l.tagName)==="TEXTAREA"||(l==null?void 0:l.getAttribute("contenteditable"))==="true"||r.key===" "&&(p.value="grabCursor",(o=E.value)==null||o.bind(),r.preventDefault())},P=r=>{var o;const l=document.activeElement;l!=null&&l.closest(".monaco-editor")||(l==null?void 0:l.tagName)==="INPUT"||(l==null?void 0:l.tagName)==="TEXTAREA"||(l==null?void 0:l.getAttribute("contenteditable"))==="true"||r.key===" "&&((o=E.value)==null||o.destroy(),p.value="defaultCursor")};function O(r){var o;r.preventDefault(),r.stopPropagation(),(o=E.value)==null||o.bind()}Ee(()=>{if(A(),!a.selfHandle&&c.value){const r=c.value.parentElement;if(!r)return;r.addEventListener("wheel",k),document.addEventListener("keydown",B),document.addEventListener("keyup",P),r.addEventListener("touchstart",O)}});const y=r=>({noBind:!0,startScale:r,startX:u,startY:L,smoothScroll:!0,canvas:!0,...a.panzoomOption}),T=r=>{const{scale:o,dimsOut:l}=r.detail;if(l){s("update:scale",o),C.value=o;const v=(l.parent.left-l.elem.left)/o,b=(l.parent.top-l.elem.top)/o;d.value=v,s("zoomchange",r.detail),m.value=b}},A=()=>{if(c.value=document.querySelector(".canvasedit"),c.value){let r=a.scale;a.autoCenter&&(r=I()),E.value=Ue(c.value,y(r)),c.value&&c.value.addEventListener("panzoomchange",T)}},I=()=>{const r=g.value*(1-a.paddingRatio)/a.canvasWidth,o=w.value*(1-a.paddingRatio)/a.canvasHeight,l=Math.min(r,o);return u=g.value/2-a.canvasWidth/2,l<1?L=(a.canvasHeight*l/2-a.canvasHeight/2)/l-(a.canvasHeight*l-w.value)/l/2:l>1?L=(a.canvasHeight*l-a.canvasHeight)/2/l+(w.value-a.canvasHeight*l)/l/2:L=0,l},Q=()=>{var r;return(r=E.value)==null?void 0:r.reset()},U=()=>{var r;return(r=E.value)==null?void 0:r.zoomIn()},K=()=>{var r;return(r=E.value)==null?void 0:r.zoomOut()},ee=()=>{var r;(r=E.value)==null||r.setOptions(y(a.scale))},te=()=>{S.value=!S.value,s("onCornerClick",S.value)},$=r=>{s("update:lockLine",r)},le=N(()=>a.thick+"px");return G([()=>a.isShowReferLine],()=>{S.value=a.isShowReferLine}),G([()=>a.canvasWidth,()=>a.canvasHeight,()=>a.width,()=>a.height],()=>{A()}),G(()=>a.panzoomOption,()=>{ee()},{deep:!0}),t({initPanzoom:A,panzoomInstance:E,reset:Q,zoomIn:U,zoomOut:K,cursorClass:p}),(r,o)=>(W(),D("div",ht,[Le(r.$slots,"btn",{reset:Q,zoomIn:U,zoomOut:K}),j("div",{class:be(["canvasedit-parent",p.value]),style:V(z.value)},[j("div",{class:be(["canvasedit",p.value])},[Le(r.$slots,"default")],2)],6),J(xe(Te,{style:V({marginLeft:r.thick+"px",width:g.value+"px"}),vertical:!1,width:r.width,height:r.thick,"is-show-refer-line":S.value,thick:r.thick,start:d.value,"start-other":m.value,lines:r.lines,"select-start":r.shadow.x,"snap-threshold":r.snapThreshold,"snaps-obj":r.snapsObj,"select-length":r.shadow.width,scale:C.value,palette:h.value,"canvas-width":r.canvasWidth,"show-shadow-text":r.showShadowText,"canvas-height":r.canvasHeight,rate:r.rate,"grid-ratio":r.gridRatio,"lock-line":r.lockLine,onChangeLineState:$},null,8,["style","width","height","is-show-refer-line","thick","start","start-other","lines","select-start","snap-threshold","snaps-obj","select-length","scale","palette","canvas-width","show-shadow-text","canvas-height","rate","grid-ratio","lock-line"]),[[_,r.showRuler]]),J(xe(Te,{style:V({marginTop:r.thick+"px",top:0,height:w.value+"px"}),vertical:!0,width:r.thick,height:r.height,"is-show-refer-line":S.value,thick:r.thick,start:m.value,"start-other":d.value,lines:r.lines,"select-start":r.shadow.y,"select-length":r.shadow.height,"snap-threshold":r.snapThreshold,"snaps-obj":r.snapsObj,scale:C.value,palette:h.value,"canvas-width":r.canvasWidth,"canvas-height":r.canvasHeight,"show-shadow-text":r.showShadowText,rate:r.rate,"grid-ratio":r.gridRatio,"lock-line":r.lockLine,onChangeLineState:$},null,8,["style","width","height","is-show-refer-line","thick","start","start-other","lines","select-start","select-length","snap-threshold","snaps-obj","scale","palette","canvas-width","canvas-height","show-shadow-text","rate","grid-ratio","lock-line"]),[[_,r.showRuler]]),J(j("a",{class:"corner",style:V(M.value),onClick:te},null,4),[[_,r.showRuler]])]))}});export{ft as f};
