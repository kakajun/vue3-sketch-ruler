import{d as se,r as H,c as N,p as U,o as D,j as Q,w as W,x as J,b as j,q as xe,n as Z,y as He,z as $e,F as Le,A as me,u as S,k as Ee,g as I,B as Me,l as Ce,C as Ve,e as _,s as We,h as qe,a as Ie,f as je,m as we,i as Ge,t as Ke}from"./index-DHqGWJR5.js";import{f as Fe}from"./style-CDD4Xomu.js";const Oe={type:{type:String,default:"rect"},tag:{type:[String,Object],default:"div"},resizable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!1},boundary:{type:Boolean},disabled:Boolean,width:{type:Number,default:0},height:{type:Number,default:0},left:{type:Number,default:0},top:{type:Number,default:0},zIndex:{type:Number,default:0},angle:{type:Number,default:0},color:{type:String,default:"#3a7afe"},minWidth:{type:Number,default:-1/0},minHeight:{type:Number,default:-1/0},maxWidth:{type:Number,default:0},maxHeight:{type:Number,default:0},aspectRatio:{type:Number},selected:Boolean,snapToGrid:Boolean,gridX:{type:Number,default:50},gridY:{type:Number,default:50},scaleRatio:{type:Number,default:1},disabledKeyEvent:Boolean,border:{type:Boolean,default:!0},resizeList:{type:Array},equalProportion:{type:Boolean},checkCollision:{type:Boolean},snap:Boolean,snapThreshold:{type:Number,default:10},markline:[Boolean,Function],extraLines:Function};function re(o,a){const e=t=>{a&&a(t),document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",e),document.removeEventListener("mouseleave",e),document.removeEventListener("touchmove",o),document.removeEventListener("touchend",e)};document.addEventListener("mousemove",o),document.addEventListener("mouseup",e),document.addEventListener("mouseleave",e),document.addEventListener("touchmove",o),document.addEventListener("touchend",e)}function G(o){let a=0,e=0;if(Ue(o)){const t=o.targetTouches[0];a=t.pageX,e=t.pageY}else a=o.clientX,e=o.clientY;return{clientX:a,clientY:e}}function Ue(o){const a=Object.prototype.toString.call(o);return a.substring(8,a.length-1)==="TouchEvent"}const O=(o=0)=>parseInt(o+"")+"px",ae={n:"top",s:"bottom",e:"right",w:"left",ne:"top-right",nw:"top-left",se:"bottom-right",sw:"bottom-left"},ne=["n","ne","e","se","s","sw","w","nw"],Je={n:0,ne:1,e:2,se:3,s:4,sw:5,w:6,nw:7},Qe={0:0,1:1,2:2,3:2,4:3,5:4,6:4,7:5,8:6,9:6,10:7,11:8},Ze=(o,a)=>{const e=Qe[Math.floor(o/30)],t=(Je[a]+e)%8;return ne[t]},ye=(o=0,a)=>{let e=[];for(let t=0;t<ne.length;t++){const n=ne[t],[u,p]=ae[n].split("-"),l=Ze(o,n),i={[u]:"0%",cursor:l+"-resize",side:ae[n]};if(p)i[p]="0%";else{const d=["top","bottom"].includes(u)?"left":"top";i[d]="50%"}a?a.includes(ae[n])&&e.push(i):e.push(i)}return e},ie=o=>o*Math.PI/180,et=(o,a)=>Math.sqrt(o*o+a*a),E=o=>Math.cos(ie(o)),M=o=>Math.sin(ie(o)),tt=(o,a,e,t,n,u,p)=>{let{width:l,height:i,centerX:d,centerY:c,rotateAngle:s}=a;const x=l<0?-1:1,f=i<0?-1:1;if(l=Math.abs(l),i=Math.abs(i),["top-left","top-right","bottom-left","bottom-right"].includes(o)){o==="top-right"?t=-t:o==="bottom-left"?e=-e:o==="top-left"&&(e=-e,t=-t);const g=le(l,e,u);l=g.width,e=g.deltaW;const h=oe(i,t,p);i=h.height,t=h.deltaH,n&&(t=e/n,i=l/n)}switch(o){case"right":{const g=le(l,e,u);l=g.width,e=g.deltaW,n?(t=e/n,i=l/n,d+=e/2*E(s)-t/2*M(s),c+=e/2*M(s)+t/2*E(s)):(d+=e/2*E(s),c+=e/2*M(s));break}case"top-right":{d+=e/2*E(s)+t/2*M(s),c+=e/2*M(s)-t/2*E(s);break}case"bottom-right":{d+=e/2*E(s)-t/2*M(s),c+=e/2*M(s)+t/2*E(s);break}case"bottom":{const g=oe(i,t,p);i=g.height,t=g.deltaH,n?(e=t*n,l=i*n,d+=e/2*E(s)-t/2*M(s),c+=e/2*M(s)+t/2*E(s)):(d-=t/2*M(s),c+=t/2*E(s));break}case"bottom-left":{d-=e/2*E(s)+t/2*M(s),c-=e/2*M(s)-t/2*E(s);break}case"left":{e=-e;const g=le(l,e,u);l=g.width,e=g.deltaW,n?(i=l/n,t=e/n,d-=e/2*E(s)+t/2*M(s),c-=e/2*M(s)-t/2*E(s)):(d-=e/2*E(s),c-=e/2*M(s));break}case"top-left":{d-=e/2*E(s)-t/2*M(s),c-=e/2*M(s)+t/2*E(s);break}case"top":{t=-t;const g=oe(i,t,p);i=g.height,t=g.deltaH,n?(l=i*n,e=t*n,d+=e/2*E(s)+t/2*M(s),c+=e/2*M(s)-t/2*E(s)):(d+=t/2*M(s),c-=t/2*E(s));break}}return{position:{centerX:d,centerY:c},size:{width:l*x,height:i*f}}},oe=(o,a,e)=>{const t=o+a;return t>e?o=t:(a=e-o,o=e),{height:o,deltaH:a}},le=(o,a,e)=>{const t=o+a;return t>e?o=t:(a=e-o,o=e),{width:o,deltaW:a}},at=({centerX:o,centerY:a,width:e,height:t,angle:n})=>({top:a-t/2,left:o-e/2,width:e,height:t,angle:n}),ot=(o,a,e)=>{const{width:t,height:n}=o;return{width:Math.abs(t),height:Math.abs(n),left:a-Math.abs(t)/2,top:e-Math.abs(n)/2}};function ee(o,a){const e=Math.abs(o)%a,t=o>0?a:-a;let n=0;return e>a/2?n=t*Math.ceil(Math.abs(o)/a):n=t*Math.floor(Math.abs(o)/a),n}function lt(o,a,e){if(!o||!a)return!1;const t=P(o,e),n=P(a,e);return t.left<n.left+n.width&&t.left+t.width>n.left&&t.top<n.top+n.height&&t.top+t.height>n.top}const P=(o,a)=>{var e=o.getBoundingClientRect();return{...e,left:e.left/a,top:e.top/a,right:e.right/a,bottom:e.bottom/a,width:e.width/a,height:e.height/a}},be=o=>typeof o=="function";function nt(o,a){let e=null,t=null;const n=N(()=>o.value.offsetParent||document.body),u=N(()=>P(n.value,a.scaleRatio)),p=H({x:[],y:[]}),l=()=>{a.markline&&!be(a.markline)&&(e||(e=document.querySelector(".es-drager-markline-x")||ke("x",n.value,a.color)),t||(t=document.querySelector(".es-drager-markline-y")||ke("y",n.value,a.color)))},i=(f={})=>{if(a.markline){if(be(a.markline))return a.markline(f);f.left===null?e.style.display="none":(e.style.left=f.left+"px",e.style.backgroundColor=a.color,e.style.display="block"),f.top===null?t.style.display="none":(t.style.top=f.top+"px",t.style.backgroundColor=a.color,t.style.display="block")}},d=()=>{const f=P(o.value,a.scaleRatio),g=Array.from(document.querySelectorAll(".es-drager"));if(a.extraLines){const L=a.extraLines(f)||[];g.push(...L)}const h=[],v=[],w=[];for(let L=0;L<g.length;L++){const b=g[L];b.nodeType===1?b!==o.value&&h.push(P(b,a.scaleRatio)):b.showTop||b.showTop===0?w.push(b):(b.showLeft||b.showLeft===0)&&v.push(b)}p.value=st(h,f),p.value.x.push(...v),p.value.y.push(...w)},c=()=>{const f={top:null,left:null,diffX:0,diffY:0},g=P(o.value,a.scaleRatio);for(let h=0;h<p.value.y.length;h++){const{top:v,showTop:w}=p.value.y[h];if(Math.abs(v-g.top)<a.snapThreshold){f.diffY=v-g.top,f.top=w-u.value.top;break}}for(let h=0;h<p.value.x.length;h++){const{left:v,showLeft:w}=p.value.x[h];if(Math.abs(v-g.left)<a.snapThreshold){f.diffX=v-g.left,f.left=w-u.value.left;break}}return i(f),f},s=()=>{i({left:null,top:null})},x=f=>{if(!(!a.snap&&!a.markline))switch(f){case"drag-start":d();break;case"drag":return c();case"drag-end":s();break}};return Ce(()=>{l()}),{marklineEmit:x}}function ke(o="x",a,e=""){const t=document.createElement("div");return t.classList.add(`es-drager-markline-${o}`),t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.zIndex="9999",t.style.backgroundColor=e,t.style.display="none",o==="x"?(t.style.height="100%",t.style.width="1px"):(t.style.height="1px",t.style.width="100%"),a.appendChild(t),t}function st(o,a){const e={x:[],y:[]},{width:t=0,height:n=0}=a;return o.forEach(u=>{const{top:p,left:l,width:i,height:d}=u;e.y.push({showTop:p,top:p}),e.y.push({showTop:p,top:p-n}),e.y.push({showTop:p+d/2,top:p+d/2-n/2}),e.y.push({showTop:p+d,top:p+d}),e.y.push({showTop:p+d,top:p+d-n}),e.x.push({showLeft:l,left:l}),e.x.push({showLeft:l+i,left:l+i}),e.x.push({showLeft:l+i/2,left:l+i/2-t/2}),e.x.push({showLeft:l+i,left:l+i-t}),e.x.push({showLeft:l,left:l-t})}),e}function rt(o,a,e,{getBoundary:t,fixBoundary:n,checkDragerCollision:u,emit:p}){let l=0,i=0;return{onKeydown:d=>{let{left:c,top:s}=a.value;if(l||(l=c),i||(i=s),["ArrowRight","ArrowLeft"].includes(d.key)){const x=d.key==="ArrowRight";let f=x?1:-1;o.snapToGrid&&(f=x?o.gridX:-o.gridX),c=c+f}else if(["ArrowUp","ArrowDown"].includes(d.key)){const x=d.key==="ArrowDown";let f=x?1:-1;o.snapToGrid&&(f=x?o.gridY:-o.gridY),s=s+f}if(o.boundary){const[x,f,g,h]=t();[c,s]=n(c,s,x,f,g,h)}a.value.left=c,a.value.top=s},onKeyup:d=>{["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"].includes(d.key)&&o.checkCollision&&u()&&(a.value.left=l,a.value.top=i),l=0,i=0}}}function it(o,a,e){const t=H(!1),n=H(!1),u=H({width:a.width,height:a.height,left:a.left,top:a.top,angle:a.angle}),{marklineEmit:p}=nt(o,a),l=new Set;function i(h){if(l.add(h.button),a.disabled)return;t.value=!0,n.value=!0;let{clientX:v,clientY:w}=G(h);const{left:L,top:b}=u.value;let r=0,m=0,y=0,k=0;a.boundary&&([r,m,y,k]=d()),p("drag-start"),e&&e("drag-start",u.value),re(C=>{if(l.size>1)return;const{clientX:R,clientY:z}=G(C);let T=(R-v)/a.scaleRatio+L,Y=(z-w)/a.scaleRatio+b;if(a.snapToGrid){let{left:B,top:A}=u.value;const V=T-B,X=Y-A;T=B+ee(V,a.gridX),Y=A+ee(X,a.gridY)}a.boundary&&([T,Y]=c(T,Y,r,m,y,k)),u.value.left=T,u.value.top=Y,e&&e("drag",u.value),We(()=>{const B=p("drag");a.snap&&(B.diffX&&(u.value.left+=B.diffX),B.diffY&&(u.value.top+=B.diffY))})},C=>{a.checkCollision&&s()&&(u.value.top=b,u.value.left=L),l.clear(),t.value=!1,p("drag-end"),e&&e("drag-end",u.value)})}const d=()=>{let h=0,v=0;const{left:w,top:L,height:b,width:r,angle:m}=u.value,y=o.value.offsetParent||document.body,k=P(y,a.scaleRatio);if(m){const z=P(o.value,a.scaleRatio);h=z.left-Math.floor(w-(z.width-r)+k.left),v=z.top-Math.floor(L-(z.height-b)+k.top)}const C=k.width-r,R=k.height-b;return[h,C-h,v,R-v,k.width,k.height]},c=(h,v,w,L,b,r)=>(h=h<w?w:h,h=h>L?L:h,v=v<b?b:v,v=v>r?r:v,[h,v]),s=()=>{const h=o.value.offsetParent||document.body,v=Array.from(h.children).filter(w=>w!==o.value&&w.classList.contains("es-drager"));for(let w=0;w<v.length;w++){const L=v[w];if(lt(o.value,L,a.scaleRatio))return!0}},x=()=>{n.value=!1},{onKeydown:f,onKeyup:g}=rt(a,u,n,{getBoundary:d,fixBoundary:c,checkDragerCollision:s,emit:e});return U(n,h=>{h?(e("focus",h),document.addEventListener("click",x,{once:!0})):e("blur",h),!a.disabledKeyEvent&&(h?(document.addEventListener("keydown",f),document.addEventListener("keyup",g)):(document.removeEventListener("keydown",f),document.removeEventListener("keyup",g)))}),Ce(()=>{if(o.value){if(!u.value.width&&!u.value.height){const{width:h,height:v}=P(o.value,a.scaleRatio);u.value={...u.value,width:h+2,height:v+2}}if(o.value.addEventListener("mousedown",i),o.value.addEventListener("touchstart",i,{passive:!0}),a.type==="text"){const h=window.getComputedStyle(o.value);u.value.height=parseInt(h.fontSize)}}}),Ve(()=>{document.removeEventListener("click",x),document.removeEventListener("keydown",f),document.removeEventListener("keyup",g)}),{isMousedown:t,selected:n,dragData:u,getBoundary:d,checkDragerCollision:s}}const dt=_("div",{class:"es-drager-rotate-handle"},[_("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[_("path",{fill:"currentColor",d:"M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"})])],-1),ut=se({__name:"rotate",props:{modelValue:{type:Number,default:0},element:{type:Object}},emits:["update:modelValue","rotate","rotate-start","rotate-end"],setup(o,{emit:a}){const e=o,t=a,n=H(null),u=N({get:()=>e.modelValue,set:l=>{t("update:modelValue",l)}});function p(l){if(!e.element)return console.warn("[es-drager] rotate component need drag element property");l.stopPropagation();const{width:i,height:d,left:c,top:s}=e.element.getBoundingClientRect(),x=c+i/2,f=s+d/2;t("rotate-start",u.value),re(g=>{const{clientX:h,clientY:v}=G(g),w=x-h,L=f-v,b=Math.atan2(L,w)*180/Math.PI-90;u.value=(b+360)%360,t("rotate",u.value)},()=>{t("rotate-end",u.value)})}return(l,i)=>(D(),j("div",{ref_key:"rotateRef",ref:n,class:"es-drager-rotate",onMousedown:p,onTouchstartPassive:p},[J(l.$slots,"default",{},()=>[dt])],544))}}),ht=["data-side","onMousedown","onTouchstartPassive"],ct=_("div",{class:"es-drager-dot-handle"},null,-1),de=se({__name:"drager",props:Oe,emits:["change","drag","drag-start","drag-end","resize","resize-start","resize-end","rotate","rotate-start","rotate-end","focus","blur"],setup(o,{emit:a}){const e=o,t=a,n=(r,...m)=>{t(r,...m)},u=H(null),{selected:p,dragData:l,isMousedown:i,getBoundary:d,checkDragerCollision:c}=it(u,e,n),s=H(ye(0,e.resizeList)),x=N(()=>e.resizable&&!e.disabled),f=N(()=>e.rotatable&&!e.disabled&&p.value),g=N(()=>e.type!="text"?s.value:s.value.filter(r=>!["top","bottom"].includes(r.side))),h=N(()=>{const{width:r,height:m,left:y,top:k,angle:C}=l.value,R={};r&&(R.width=O(r)),m&&(e.type==="text"?R.fontSize=m+"px":R.height=O(m));let z=[`translateX(${O(y)})`,`translateY(${O(k)})`,`rotate(${C}deg)`];return{...R,zIndex:e.zIndex,transform:z.join(" "),"--es-drager-color":e.color}});function v(r){u.value||(u.value=r.$el||r)}function w(r){s.value=ye(r,e.resizeList),n("rotate-end",l.value)}function L(r,m){if(e.disabled)return;m.stopPropagation();const{clientX:y,clientY:k}=G(m),C=y,R=k,{width:z,height:T,left:Y,top:B}=l.value,A=Y+z/2,V=B+T/2,X={width:z,height:T,centerX:A,centerY:V,rotateAngle:l.value.angle},q=r.side;let{minWidth:Re,minHeight:ze,aspectRatio:te,equalProportion:Be}=e;n("resize-start",l.value,q);let ue=[];e.boundary&&(ue=d()),["text","image"].includes(e.type)&&q.includes("-")&&(te=X.width/X.height),re(he=>{const{clientX:Te,clientY:Xe}=G(he);let K=(Te-C)/e.scaleRatio,F=(Xe-R)/e.scaleRatio;e.snapToGrid&&(K=ee(K,e.gridX),F=ee(F,e.gridY));const Ye=Math.atan2(F,K),ce=et(K,F),_e=he.shiftKey,pe=Ye-ie(X.rotateAngle),Ae=ce*Math.cos(pe),Se=ce*Math.sin(pe),fe=(Be||_e)&&!te?X.width/X.height:te,{position:{centerX:ge,centerY:ve},size:{width:Ne,height:De}}=tt(q,{...X,rotateAngle:X.rotateAngle},Ae,Se,fe,Re,ze),Pe=at({centerX:ge,centerY:ve,width:Ne,height:De,angle:l.value.angle});let $={...l.value,...ot(Pe,ge,ve)};e.maxWidth>0&&($.width=Math.min($.width,e.maxWidth)),e.maxHeight>0&&($.height=Math.min($.height,e.maxHeight)),e.boundary&&($=b($,ue,fe)),l.value=$,n("resize",l.value,q)},()=>{e.checkCollision&&c()&&(l.value={...l.value,width:z,height:T,left:Y,top:B}),n("resize-end",l.value,q)})}function b(r,m,y){const[k,C,R,z,T,Y]=m,B=r.left<k,A=r.left+r.width>T,V=r.top<R,X=r.top+r.height>Y;return B&&(r.left=k,r.width=l.value.width),V&&(r.top=R,r.height=l.value.height),(A||X)&&(A&&(r.left=l.value.left),X&&(r.top=l.value.top),X||(r.width=T-r.left),A||(r.height=Y-r.top)),(X||V)&&y&&(r.width=l.value.width,r.left=l.value.left),(A||B)&&y&&(r.height=l.value.height,r.top=l.value.top),r}return U(()=>[e.width,e.height,e.left,e.top,e.angle],([r,m,y,k,C],[R,z,T,Y,B])=>{r!==R&&(l.value.width=r),m!==z&&(l.value.height=m),y!==T&&(l.value.left=y),k!==Y&&(l.value.top=k),C!==B&&(l.value.angle=C)}),U(()=>l.value,r=>{t("change",{...r})},{deep:!0}),U(()=>e.selected,r=>{p.value=r},{immediate:!0}),(r,m)=>(D(),Q(Me(r.tag),{ref:v,class:Ee(["es-drager",`es-drager-${r.type}`,{disabled:r.disabled,dragging:S(i),selected:S(p),border:r.border}]),style:Z(h.value),onClick:m[3]||(m[3]=I(()=>{},["stop"])),onMousedown:m[4]||(m[4]=I(()=>{},["stop"]))},{default:W(()=>[J(r.$slots,"default"),x.value?(D(!0),j(Le,{key:0},xe(g.value,(y,k)=>(D(),j("div",{key:k,class:"es-drager-dot","data-side":y.side,style:Z({...y}),onMousedown:C=>L(y,C),onTouchstartPassive:C=>L(y,C)},[J(r.$slots,"resize",He($e({side:y.side})),()=>[ct])],44,ht))),128)):me("",!0),f.value?(D(),Q(ut,{key:1,modelValue:S(l).angle,"onUpdate:modelValue":m[0]||(m[0]=y=>S(l).angle=y),element:u.value,onRotate:m[1]||(m[1]=y=>n("rotate",S(l))),onRotateStart:m[2]||(m[2]=y=>n("rotate-start",S(l))),onRotateEnd:w},{default:W(()=>[J(r.$slots,"rotate")]),_:3},8,["modelValue","element"])):me("",!0)]),_:3},40,["class","style"]))}}),pt=o=>{o.component("es-drager",de)};de.install=pt;const ft={class:"btns"},gt=["onClick"],vt=["onClick"],mt=["onClick"],bt=se({__name:"esDragle",setup(o){const a=qe(),e=H(),t=Ie({thick:20,width:1470,height:700,showShadowText:!1,canvasWidth:1e3,canvasHeight:500,showRuler:!0,palette:{bgColor:"transparent",lineType:"dashed"},isShowReferLine:!0,shadow:{x:0,y:0,width:0,height:0},lines:{h:[],v:[]}}),n=H({componentList:[{id:"div1",component:"div",text:"div1",width:100,height:100,left:0,top:0},{id:"div2",component:"div",text:"div2",width:100,height:100,top:100,left:100}]}),u=N(()=>({width:`${t.width}px`,height:`${t.height}px`})),p=N(()=>({width:`${t.canvasWidth}px`,height:`${t.canvasHeight}px`,background:a.isLight?"#eff2f5":"#333333"})),l=(i,d)=>{t.shadow={x:d.left,y:d.top,width:d.width,height:d.height},Object.keys(i).forEach(c=>{d[c]=i[c]})};return(i,d)=>(D(),j("div",null,[_("div",{class:Ee(["wrapper",[S(a).isLight?"whitewrapper":"blackwrapper"]]),style:Z(u.value)},[je(S(Fe),we({ref_key:"sketchruleRef",ref:e},t),{default:W(()=>[_("div",{"data-type":"page",style:Z(p.value)},[(D(!0),j(Le,null,xe(n.value.componentList,c=>(D(),Q(S(de),we({ref_for:!0},c,{key:c.id,snap:"",class:"dragerItem","snap-threshold":10,markline:"",onChange:s=>l(s,c),onDragEnd:i.onDragend}),{default:W(()=>[(D(),Q(Me(c.component),null,{default:W(()=>[Ge(Ke(c.text),1)]),_:2},1024))]),_:2},1040,["onChange","onDragEnd"]))),128))],4)]),btn:W(({reset:c,zoomIn:s,zoomOut:x})=>[_("div",ft,[_("button",{onClick:I(c,["stop"])},"还原",8,gt),_("button",{onClick:I(s,["stop"])},"放大",8,vt),_("button",{onClick:I(x,["stop"])},"缩小",8,mt)])]),_:1},16)],6)]))}});export{bt as default};
