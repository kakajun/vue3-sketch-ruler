import{d as he,r as B,c as N,p as Ce,G as Oe,b as D,q as G,x as Le,e as j,H as J,k as be,n as V,I as _,f as xe,o as W,y as Ae,m as Me,F as Ye,s as We,u as O,t as Xe,a as Ve,g as de,j as Ie,J as De}from"./index-BPt_Au9g.js";/*!vue3-sketch-ruler v2.2.102025年11月Sat Nov 15 2025 13:55:33 GMT+0000 (Coordinated Universal Time)制作*/const Fe=e=>e<=.25?40:e<=.5?20:e<=1?10:e<=2?5:e<=4?2:1;function Ke(e,t,n,a,c,u){u?c.moveTo(e,0):c.moveTo(0,e),c.save(),u?c.translate(e+5,a*.2):c.translate(n*.1,e+32),u||c.rotate(-Math.PI/2),c.fillText(Math.round(t).toString(),4,7),c.restore(),u?c.lineTo(e,a):c.lineTo(n,e),c.stroke(),c.closePath(),c.setTransform(1,0,0,1,0,0)}function re(e,t,n,a,c,u){a.fillStyle=c.fontShadowColor,a.strokeStyle=c.longfgColor,a.save(),a.translate(e,t),u||a.rotate(-Math.PI/2),a.font="bold 12px  Aria",a.fillText(String(n),0,0),a.restore()}const Ge=(e,t,n,a,c,u)=>{const{scale:p,width:f,height:h,ratio:k,palette:E,gridRatio:C,showShadowText:R}=c,{bgColor:v,fontColor:d,shadowColor:A,longfgColor:T}=E,y=u?c.canvasWidth:c.canvasHeight;e.setTransform(1,0,0,1,0,0),e.scale(k,k),e.clearRect(0,0,f,h),e.fillStyle=v,e.fillRect(0,0,f,h);const w=Fe(p)*C*10,x=w*p,L=Math.floor(t/w)*w,X=(L-t)/w*x,z=t+Math.ceil((u?f:h)/p);if(a){const g=(n-t)*p,M=a*p;if(e.fillStyle=A,u?e.fillRect(g,0,M,h):e.fillRect(0,g,f,M),R)if(u){re(g,h*.4,Math.round(n),e,E,u);const S=(n+a-t)*p;re(S,h*.4,Math.round(n+a),e,E,u)}else{re(f*.4,g,Math.round(n),e,E,u);const S=(n+a-t)*p;re(f*.4,S,Math.round(n+a),e,E,u)}}e.beginPath(),e.fillStyle=d,e.strokeStyle=T;for(let g=L,M=0;g<z;g+=w,M++){const S=X+M*x+.5;if(g-w<y&&g>y||g==y){const Y=X+M*x+.5+(y-g)*p;Ke(Y,y,f,h,e,u);return}g>=0&&g<=y&&(g==0?u?(e.moveTo(S,0),e.lineTo(S,h)):(e.moveTo(0,S),e.lineTo(f,S)):u?(e.moveTo(S,20),e.lineTo(S,h/1.3)):(e.moveTo(20,S),e.lineTo(f/1.3,S)),e.save(),g==0?u?e.translate(S-15,h*.01):e.translate(f*.3,S-5):u?e.translate(S-12,h*.05):e.translate(f*.05,S+12),u||e.rotate(-Math.PI/2),y-g>w/2&&(!R||a==0||Math.abs(g-n)>w/2&&Math.abs(g-(n+a))>w/2)&&e.fillText(g.toString(),4,9),e.restore())}e.stroke(),e.closePath()};function Se(e,t=100){let n=null;const a=function(...c){n!==null&&clearTimeout(n),n=setTimeout(()=>{e(...c)},t)};return a.cancel=function(){n!==null&&(clearTimeout(n),n=null)},a}function Ne(e,t){const n=B(0),a=B(0),c=B(!1),u=N(()=>({backgroundColor:e.palette.hoverBg,color:e.palette.hoverColor,[t?"top":"left"]:"-8px",[t?"left":"top"]:`${n.value+10}px`})),p=({offsetX:v,offsetY:d})=>{n.value=t?v:d},f=(v,d)=>new Promise(A=>{if(e.lockLine)return;const T=t?v.clientY:v.clientX;p(v);const y=d||a.value;let w=y;const x=X=>{let z=((t?X.clientY:X.clientX)-T)/e.scale+y,g=z;const M=(t?e.snapsObj.h:e.snapsObj.v).slice().sort((S,Y)=>Math.abs(g-S)-Math.abs(g-Y));M.length&&Math.abs(M[0]-z)<e.snapThreshold/e.scale&&(g=M[0],z=g),w=Math.round(z),a.value=w},L=()=>{document.removeEventListener("mousemove",x),h(w,e.index),A()};document.addEventListener("mousemove",x),document.addEventListener("mouseup",L,{once:!0})}),h=(v,d)=>{var A,T;const y=t?(A=e.lines)==null?void 0:A.h:(T=e.lines)==null?void 0:T.v,w=k(v);if(y)if(w)if(typeof d=="number")y.splice(d,1);else return;else typeof d!="number"?y.push(v):y[d]=v},k=v=>{const d=t?e.canvasHeight:e.canvasWidth;return v<0||v>d},E=N(()=>k(a.value)?"放开删除":`${t?"Y":"X"}：${a.value*e.rate}`),C=Se(()=>{c.value=!1},200),R=Se(()=>{c.value=!0},200);return{showLabel:c,startValue:a,actionStyle:u,labelContent:E,handleMouseDown:f,handleMouseenter:v=>{e.lockLine||(p(v),R(),C.cancel())},handleMouseLeave:()=>{C()}}}const Qe={key:0,class:"value"},$e=he({__name:"ruler-line",props:{scale:{},palette:{},index:{},start:{},vertical:{type:Boolean},value:{},canvasWidth:{},canvasHeight:{},lines:{},isShowReferLine:{type:Boolean},rate:{},snapThreshold:{},snapsObj:{},lockLine:{type:Boolean}},setup(e){const t=e,n=B(!1),{actionStyle:a,handleMouseDown:c,labelContent:u,startValue:p,showLabel:f,handleMouseenter:h,handleMouseLeave:k}=Ne(t,t.vertical),E=N(()=>p.value>=t.start),C=N(()=>{const{lineType:v,lockLineColor:d,lineColor:A}=t.palette,T=t.lockLine?d:A??"black",y=t.lockLine||n.value?"none":"auto",w=t.isShowReferLine&&!t.lockLine?t.vertical?"ns-resize":"ew-resize":"default",x=t.vertical?"borderTop":"borderLeft",L=(p.value-t.start)*t.scale;return{[x]:`1px ${v} ${T}`,pointerEvents:y,cursor:w,[t.vertical?"top":"left"]:`${L}px`}});Ce(()=>{p.value=t.value??0});const R=Se(()=>{n.value=!1},1e3);return G([()=>t.scale],()=>{n.value=!0,R()}),(v,d)=>J((W(),D("div",{class:"line",style:V(C.value),onMouseenter:d[0]||(d[0]=de((...A)=>O(h)&&O(h)(...A),["stop"])),onMouseleave:d[1]||(d[1]=de((...A)=>O(k)&&O(k)(...A),["stop"])),onMousedown:d[2]||(d[2]=de((...A)=>O(c)&&O(c)(...A),["stop"]))},[j("div",{class:"action",style:V(O(a))},[O(f)?(W(),D("span",Qe,Xe(O(u)),1)):Ae("",!0)],4)],36)),[[_,E.value]])}}),qe=he({__name:"index",props:{scale:{},palette:{},vertical:{type:Boolean},showShadowText:{type:Boolean},start:{},width:{},height:{},selectStart:{},selectLength:{},canvasWidth:{},canvasHeight:{},rate:{},gridRatio:{}},emits:["handleDragStart"],setup(e,{emit:t}){const n=e,a=t,c=Ve({isDragging:!1,canvasContext:null});let u=window.devicePixelRatio;const p=B(null);Ce(()=>{window.addEventListener("resize",f),h(),E(u),C(u)});const f=()=>{u=window.devicePixelRatio,E(u),C(u)},h=()=>{var v;c.canvasContext=((v=p.value)==null?void 0:v.getContext("2d"))||null},k=N(()=>({width:n.width+"px",height:n.height+"px",cursor:n.vertical?"ew-resize":"ns-resize",[n.vertical?"borderRight":"borderBottom"]:`1px solid ${n.palette.borderColor||"#eeeeef"} `}));Oe(()=>{window.removeEventListener("resize",f)});const E=v=>{if(p.value){p.value.width=Math.round(n.width*v),p.value.height=Math.round(n.height*v);const d=c.canvasContext;d&&(d.font=`11px -apple-system,
                "Helvetica Neue", ".SFNSText-Regular",
                "SF UI Text", Arial, "PingFang SC", "Hiragino Sans GB",
                "Microsoft YaHei", "WenQuanYi Zen Hei", sans-serif`,d.lineWidth=1,d.textBaseline="middle")}},C=v=>{const d={scale:n.scale,width:n.width,height:n.height,palette:n.palette,canvasWidth:n.canvasWidth,canvasHeight:n.canvasHeight,ratio:v,rate:n.rate,gridRatio:n.gridRatio,showShadowText:n.showShadowText};d.scale=n.scale/n.rate,d.canvasWidth=n.canvasWidth*n.rate,d.canvasHeight=n.canvasHeight*n.rate,c.canvasContext&&Ge(c.canvasContext,n.start*n.rate,n.selectStart,n.selectLength,d,!n.vertical)};G([()=>n.width,()=>n.height,()=>n.start,()=>n.palette,()=>n.selectStart,()=>n.selectLength],()=>{C(u)}),G([()=>n.width,()=>n.height],()=>{E(u)});const R=v=>{a("handleDragStart",v)};return(v,d)=>(W(),D("canvas",{ref_key:"canvas",ref:p,class:"ruler",style:V(k.value),onMousedown:de(R,["stop"])},null,36))}}),Ze={class:"lines"},je={key:0,class:"value"},Te=he({__name:"ruler-wrapper",props:{scale:{},thick:{},canvasWidth:{},canvasHeight:{},palette:{},vertical:{type:Boolean},width:{},height:{},start:{},startOther:{},lines:{},selectStart:{},selectLength:{},isShowReferLine:{type:Boolean},rate:{},snapThreshold:{},snapsObj:{},gridRatio:{},lockLine:{type:Boolean},showShadowText:{type:Boolean}},emits:["changeLineState"],setup(e,{emit:t}){const n=e,{showLabel:a,actionStyle:c,handleMouseenter:u,handleMouseLeave:p,handleMouseDown:f,labelContent:h,startValue:k}=Ne(n,!n.vertical),E=B(!1),C=B(!1),R=N(()=>n.vertical?"v-container":"h-container"),v=t,d=N(()=>{var y,w;return n.vertical?(y=n.lines)==null?void 0:y.h:(w=n.lines)==null?void 0:w.v}),A=N(()=>{const y=n.palette.lineType;let w=n.vertical?"left":"top",x=n.vertical?"top":"left",L=n.vertical?"borderLeft":"borderBottom";const X=(k.value-n.startOther)*n.scale+n.thick;return{[w]:X+"px",[x]:-n.thick+"px",cursor:n.vertical?"ew-resize":"ns-resize",[L]:`1px ${y} ${n.palette.lineColor}`}}),T=async y=>{const{offsetX:w,offsetY:x}=y,{scale:L,vertical:X,thick:z,startOther:g}=n;if(!E.value){C.value=!0,v("changeLineState",!1);let M=Math.round(g-z/L+(X?w:x)/L);k.value=M,await f(y,M),C.value=!1}};return G([()=>n.lockLine],()=>{E.value=n.lockLine}),(y,w)=>(W(),D("div",{class:be(R.value)},[xe(qe,Me(y.$props,{onHandleDragStart:T}),null,16),J(j("div",Ze,[(W(!0),D(Ye,null,We(d.value,(x,L)=>(W(),Ie($e,Me({key:x+L,index:L,value:x>>0},{ref_for:!0},y.$props),null,16,["index","value"]))),128))],512),[[_,e.isShowReferLine]]),e.isShowReferLine?J((W(),D("div",{key:0,class:"indicator",style:V(A.value),onMouseenter:w[0]||(w[0]=(...x)=>O(u)&&O(u)(...x)),onMouseleave:w[1]||(w[1]=(...x)=>O(p)&&O(p)(...x))},[j("div",{class:"action",style:V(O(c))},[O(a)?(W(),D("span",je,Xe(O(h)),1)):Ae("",!0)],4)],36)),[[_,C.value]]):Ae("",!0)],2))}}),Je="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAopJREFUOE/FlE9IVEEcx7+/N9ouds1Mu0QUSFZYdIgoUqQoKPBQHsKozpXE7jbTO/U8xLJvn6usBHWQ6hBFXupSkQeVbh0KJEPp0sH+eLGTsKs77xcj78m0ax0E8cHjzZv5zef3/c33xxA24KENYGJzoEEQbNNaN4Zh2OQ4znwYhr9c1/39vwrXVDo0NNS0tLR0GYB5D64BmAMwzMyvlFKz1es10Hw+f4mZ7wHYBeA9gNdENFepVOaEEM3M3OI4Thczn41gt6WUgQ3+C+r7/h0AWQD3mXnYqPA8L9nQ0HCemduIaFpKOWoAhUJhT6VSuQXgOjP3K6W8GLwKzeVyp4jonR0QBEErM48w8zFLyayUsjX+z+VyHhHdZebTSqkxM78CHRgYOKS1/ghgVErZY214RkQ7ADyRUj72ff8qgCtmXUrZGcf5vv8CwEUhxOF0Ov1pBRpla5dSdseBhUJhpznH6tIsZb1KqacW+BGArUaUXX63UuplHJTNZjuEEONSyhozfd/n6mQ1RkXZL2itz7mu+80EDA4ONi8vL/8AcM2UbikyR2BU9cSmmTU70YqKIAj2hWFo2uenlHK/BRg3Y2aeNO5GyU8S0ZbFxcUuz/NKEXAGQKPjOCcymcyX1dIi8DSAiWQyeaavr68cbSgCuBknYubnQoj+TCYzUywWE6VS6S2ADsdx2gxw1X3L7SNENMbMnwE8qK+vf5NKpRaMaeVyeW8ikfiaSqW+R7BuZr5BRMe11p2u607U9Gk8kc/ntzPzQwCmExYATDLzVBiGE0KIowAOADDf3QA+aK2VDaxRajto3K+rq+tl5nYAzQBamHmeiOYBTGmtR6ph/1Rqg9c73pz7dD1qN0TpHyNQRCUDJXrAAAAAAElFTkSuQmCC",_e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAjtJREFUOE/NlD9oFEEUxn9v9ghC0hpRUogIAUmniGAT/5Q2FrETPSNRJILg7RwimI0ox85eQFCEBGIUO1PYpFM0jSConQoBEZGgGPsgl+w+2eM2bC57SopAFqYZ3v7m+977ZoQt+GQLmGxPaBiGgYiMWWvXBHZUGoZhH3BERPYC+4F+4Keq/urt7b1RLpf/ZEBVHa9Wq0HWyg3QKIoGVPU8cA7wgK/pUtXPQJ8xZk+pVBpuNBqXUoUiEvi+P56fzTpo6+SbwHNg1lo7WzTITGEKXFlZeeB53tVCpa3CK8AFa+1cBgvD8LKIXAQOJkkyICJDeYVBEJS6u7s/qeoLa+1o+l9TqXNuBLhmjDlbqVQ+5ICjInIfOBPH8W9jzGCR5YmJiRNxHM+papgqzqDvgSlr7VTernPuO3An3c9bBt74vv+yrdaKyLDv+/1Sq9UGPc97nY9EVuycU2AQOA7cAm4Dr4D5TvVxHB9rKo2iaEFVp621Ln96FEUngaOqGmSxabVqsh3a2h+x1h5qQjNrae/yE4+iaCwDJkky73neTuBZe129Xk+H+BS4l7ZqLVIZ2BhzuFKpvMsDVXXWGPMxFdAedOfcKeCRqj7MYrUhpz09PfXl5eXrectFWXXODQHpOq2qd/95o/JXr6ura3J1dXU6SZIfwKKIHAD2tVYMPBGRx77vN10UXtO85fTkmZmZHUtLSzUR2QXsBhaAL6r6DXhbrVYXi1yss59GqOgub/bN3Z7v6X/tb9Zmp/q/kN8s+lJb8oEAAAAASUVORK5CYII=";/*!simple-panzoom v1.0.72024年8月Sat Aug 10 2024 16:04:04 GMT+0800 (中国标准时间)制作*/typeof window<"u"&&(window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach),typeof window.CustomEvent!="function"&&(window.CustomEvent=function(e,t){t=t||{bubbles:!1,cancelable:!1,detail:null};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}));function Pe(e,t){let n=e.length;for(;n--;)if(e[n].pointerId===t.pointerId)return n;return-1}function Ee(e,t){let n;if(t.touches){n=0;for(const a of t.touches)a.pointerId=n++,Ee(e,a);return}n=Pe(e,t),n>-1&&e.splice(n,1),e.push(t)}function et(e,t){if(t.touches){for(;e.length;)e.pop();return}const n=Pe(e,t);n>-1&&e.splice(n,1)}function Re(e){e=e.slice(0);let t=e.pop(),n;for(;n=e.pop();)t={clientX:(n.clientX-t.clientX)/2+t.clientX,clientY:(n.clientY-t.clientY)/2+t.clientY};return t}function ge(e){if(e.length<2)return 0;const t=e[0],n=e[1];return Math.sqrt(Math.pow(Math.abs(n.clientX-t.clientX),2)+Math.pow(Math.abs(n.clientY-t.clientY),2))}let ae={down:"mousedown",move:"mousemove",up:"mouseup mouseleave"};typeof window<"u"&&(typeof window.PointerEvent=="function"?ae={down:"pointerdown",move:"pointermove",up:"pointerup pointerleave pointercancel"}:typeof window.TouchEvent=="function"&&(ae={down:"touchstart",move:"touchmove",up:"touchend touchcancel"}));function we(e,t,n,a){ae[e].split(" ").forEach(c=>{t.addEventListener(c,n,a)})}function ye(e,t,n){ae[e].split(" ").forEach(a=>{t.removeEventListener(a,n)})}const tt=typeof document<"u"&&!!document.documentMode;let ze;function nt(){return ze||(ze=document.createElement("div").style)}const Be=["webkit","moz","ms"],ie={};function ke(e){if(ie[e])return ie[e];const t=nt();if(e in t)return ie[e]=e;const n=e[0].toUpperCase()+e.slice(1);let a=Be.length;for(;a--;){const c=`${Be[a]}${n}`;if(c in t)return ie[e]=c}}function se(e,t){return parseFloat(t[ke(e)])||0}function ce(e,t,n=window.getComputedStyle(e)){const a=t==="border"?"Width":"";return{left:se(`${t}Left${a}`,n),right:se(`${t}Right${a}`,n),top:se(`${t}Top${a}`,n),bottom:se(`${t}Bottom${a}`,n)}}function Z(e,t,n){e.style[ke(t)]=n}function at(e,t){const n=ke("transform");Z(e,"transition",`${n} ${t.duration}ms ${t.easing}`)}function ot(e,{x:t,y:n,scale:a,isSVG:c},u){if(Z(e,"transform",`scale(${a}) translate(${t}px, ${n}px)`),c&&tt){const p=window.getComputedStyle(e).getPropertyValue("transform");e.setAttribute("transform",p)}}function ue(e){const t=e.parentNode,n=window.getComputedStyle(e),a=window.getComputedStyle(t),c=e.getBoundingClientRect(),u=t.getBoundingClientRect();return{elem:{style:n,width:c.width,height:c.height,top:c.top,bottom:c.bottom,left:c.left,right:c.right,margin:ce(e,"margin",n),border:ce(e,"border",n)},parent:{style:a,width:u.width,height:u.height,top:u.top,bottom:u.bottom,left:u.left,right:u.right,padding:ce(t,"padding",a),border:ce(t,"border",a)}}}function lt(e){let t=e;for(;t&&t.parentNode;){if(t.parentNode===document)return!0;t=t.parentNode instanceof ShadowRoot?t.parentNode.host:t.parentNode}return!1}function rt(e){return(e.getAttribute("class")||"").trim()}function it(e,t){return e.nodeType===1&&` ${rt(e)} `.indexOf(` ${t} `)>-1}function st(e,t){for(let n=e;n!=null;n=n.parentNode)if(it(n,t.excludeClass)||t.exclude.indexOf(n)>-1)return!0;return!1}const ct=/^http:[\w\.\/]+svg$/;function ut(e){return ct.test(e.namespaceURI)&&e.nodeName.toLowerCase()!=="svg"}function dt(e){const t={};for(const n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}const He={animate:!1,canvas:!1,cursor:"move",disablePan:!1,disableZoom:!1,disableXAxis:!1,disableYAxis:!1,duration:200,easing:"ease-in-out",exclude:[],excludeClass:"panzoom-exclude",handleStartEvent:e=>{e.preventDefault(),e.stopPropagation()},maxScale:4,minScale:.125,overflow:"hidden",panOnlyWhenZoomed:!1,pinchAndPan:!1,relative:!1,setTransform:ot,startX:0,startY:0,startScale:1,step:.3,touchAction:"none"};function Ue(e,t){if(!e)throw new Error("Panzoom requires an element as an argument");if(e.nodeType!==1)throw new Error("Panzoom requires an element with a nodeType of 1");if(!lt(e))throw new Error("Panzoom should be called on elements that have been attached to the DOM");t={...He,...t};const n=ut(e),a=e.parentNode;a.style.overflow=t.overflow,a.style.userSelect="none",a.style.touchAction=t.touchAction,(t.canvas?a:e).style.cursor=t.cursor,e.style.userSelect="none",e.style.touchAction=t.touchAction,Z(e,"transformOrigin",typeof t.origin=="string"?t.origin:n?"0 0":"50% 50%");function c(){a.style.overflow="",a.style.userSelect="",a.style.touchAction="",a.style.cursor="",e.style.cursor="",e.style.userSelect="",e.style.touchAction="",Z(e,"transformOrigin","")}function u(l={}){for(const o in l)l.hasOwnProperty(o)&&(t[o]=l[o]);(l.hasOwnProperty("cursor")||l.hasOwnProperty("canvas"))&&(a.style.cursor=e.style.cursor="",(t.canvas?a:e).style.cursor=t.cursor),l.hasOwnProperty("overflow")&&(a.style.overflow=l.overflow),l.hasOwnProperty("touchAction")&&(a.style.touchAction=l.touchAction,e.style.touchAction=l.touchAction)}let p=0,f=0,h=1,k=!1;A(t.startScale,{animate:!1,force:!0}),setTimeout(()=>{d(t.startX,t.startY,{animate:!1,force:!0})});function E(l,o,i){if(i.silent)return;const r=new CustomEvent(l,{detail:o});e.dispatchEvent(r)}function C(l,o,i){const r={x:p,y:f,scale:h,isSVG:n,originalEvent:i,dimsOut:{}};typeof o.animate=="boolean"&&(o.animate?at(e,o):Z(e,"transition","none")),o.setTransform(e,r,o);function s(){const b=ue(e);r.dimsOut=b,E(l,r,o),E("panzoomchange",r,o)}return o.animate?setTimeout(()=>{s()},o.duration+50):requestAnimationFrame(()=>{s()}),r}function R(l,o,i,r){const s={...t,...r},b={x:p,y:f,opts:s};if(!s.force&&(s.disablePan||s.panOnlyWhenZoomed&&h===s.startScale))return b;if(l=parseFloat(l),o=parseFloat(o),s.disableXAxis||(b.x=(s.relative?p:0)+l),s.disableYAxis||(b.y=(s.relative?f:0)+o),s.contain){const m=ue(e),U=m.elem.width/h,H=m.elem.height/h,te=U*i,ne=H*i,F=(te-U)/2,K=(ne-H)/2;if(s.contain==="inside"){const pe=(-m.elem.margin.left-m.parent.padding.left+F)/i,ve=(m.parent.width-te-m.parent.padding.left-m.elem.margin.left-m.parent.border.left-m.parent.border.right+F)/i;b.x=Math.max(Math.min(b.x,ve),pe);const fe=(-m.elem.margin.top-m.parent.padding.top+K)/i,me=(m.parent.height-ne-m.parent.padding.top-m.elem.margin.top-m.parent.border.top-m.parent.border.bottom+K)/i;b.y=Math.max(Math.min(b.y,me),fe)}else if(s.contain==="outside"){const pe=(-(te-m.parent.width)-m.parent.padding.left-m.parent.border.left-m.parent.border.right+F)/i,ve=(F-m.parent.padding.left)/i;b.x=Math.max(Math.min(b.x,ve),pe);const fe=(-(ne-m.parent.height)-m.parent.padding.top-m.parent.border.top-m.parent.border.bottom+K)/i,me=(K-m.parent.padding.top)/i;b.y=Math.max(Math.min(b.y,me),fe)}}return s.roundPixels&&(b.x=Math.round(b.x),b.y=Math.round(b.y)),b}function v(l,o){const i={...t,...o},r={scale:h,opts:i};if(!i.force&&i.disableZoom)return r;let s=t.minScale,b=t.maxScale;if(i.contain){const m=ue(e),U=m.elem.width/h,H=m.elem.height/h;if(U>1&&H>1){const te=m.parent.width-m.parent.border.left-m.parent.border.right,ne=m.parent.height-m.parent.border.top-m.parent.border.bottom,F=te/U,K=ne/H;t.contain==="inside"?b=Math.min(b,F,K):t.contain==="outside"&&(s=Math.max(s,F,K))}}return r.scale=Math.min(Math.max(l,s),b),r}function d(l,o,i,r){const s=R(l,o,h,i);return p!==s.x||f!==s.y?(p=s.x,f=s.y,C("panzoompan",s.opts,r)):{x:p,y:f,scale:h,isSVG:n,originalEvent:r}}function A(l,o,i){const r=v(l,o),s=r.opts;if(!s.force&&s.disableZoom)return;l=r.scale;let b=p,m=f;if(s.focal){const H=s.focal;b=(H.x/l-H.x/h+p*l)/l,m=(H.y/l-H.y/h+f*l)/l}const U=R(b,m,l,{relative:!1,force:!0});return p=U.x,f=U.y,h=l,C("panzoomzoom",s,i)}function T(l,o){const i={...t,animate:!0,...o};return A(h*Math.exp((l?1:-1)*i.step),i)}function y(l){return T(!0,l)}function w(l){return T(!1,l)}function x(l,o,i,r){const s=ue(e),b={width:s.parent.width-s.parent.padding.left-s.parent.padding.right-s.parent.border.left-s.parent.border.right,height:s.parent.height-s.parent.padding.top-s.parent.padding.bottom-s.parent.border.top-s.parent.border.bottom};let m=o.clientX-s.parent.left-s.parent.padding.left-s.parent.border.left-s.elem.margin.left,U=o.clientY-s.parent.top-s.parent.padding.top-s.parent.border.top-s.elem.margin.top;n||(m-=s.elem.width/h/2,U-=s.elem.height/h/2);const H={x:m/b.width*(b.width*l),y:U/b.height*(b.height*l)};return A(l,{...i,animate:!1,focal:H},r)}function L(l,o){l.preventDefault();const i={...t,...o,animate:!1},r=(l.deltaY===0&&l.deltaX?l.deltaX:l.deltaY)<0?1:-1,s=v(h*Math.exp(r*i.step/3),i).scale;return x(s,l,i,l)}function X(l){const o={...t,animate:!0,force:!0,...l};h=v(o.startScale,o).scale;const i=R(o.startX,o.startY,h,o);return p=i.x,f=i.y,C("panzoomreset",o)}let z,g,M,S,Y,I;const P=[];function Q(l){if(st(l.target,t))return;Ee(P,l),k=!0,t.handleStartEvent(l),z=p,g=f,E("panzoomstart",{x:p,y:f,scale:h,isSVG:n,originalEvent:l},t);const o=Re(P);M=o.clientX,S=o.clientY,Y=h,I=ge(P)}function $(l){if(!k||z===void 0||g===void 0||M===void 0||S===void 0)return;Ee(P,l);const o=Re(P),i=P.length>1;let r=h;if(i){I===0&&(I=ge(P));const s=ge(P)-I;r=v(s*t.step/80+Y).scale,x(r,o,{animate:!1},l)}(!i||t.pinchAndPan)&&d(z+(o.clientX-M)/r,g+(o.clientY-S)/r,{animate:!1},l)}function q(l){P.length===1&&E("panzoomend",{x:p,y:f,scale:h,isSVG:n,originalEvent:l},t),et(P,l),k&&(k=!1,z=g=M=S=void 0)}let ee=!1;function oe(){ee||(ee=!0,we("down",t.canvas?a:e,Q),we("move",document,$,{passive:!0}),we("up",document,q,{passive:!0}))}function le(){ee=!1,ye("down",t.canvas?a:e,Q),ye("move",document,$),ye("up",document,q)}return t.noBind||oe(),{bind:oe,destroy:le,eventNames:ae,getPan:()=>({x:p,y:f}),getScale:()=>h,getOptions:()=>dt(t),handleDown:Q,handleMove:$,handleUp:q,pan:d,reset:X,resetStyle:c,setOptions:u,setStyle:(l,o)=>Z(e,l,o),zoom:A,zoomIn:y,zoomOut:w,zoomToPoint:x,zoomWithWheel:L}}Ue.defaultOptions=He;const ht={class:"sketch-ruler"},vt=he({__name:"index",props:{showRuler:{type:Boolean,default:!0},eyeIcon:{},closeEyeIcon:{},scale:{default:1},rate:{default:1},thick:{default:16},palette:{},width:{default:1400},height:{default:800},paddingRatio:{default:.2},autoCenter:{type:Boolean,default:!0},shadow:{default:()=>({x:0,y:0,width:0,height:0})},lines:{default:()=>({h:[],v:[]})},isShowReferLine:{type:Boolean,default:!0},canvasWidth:{default:700},canvasHeight:{default:700},snapsObj:{default:()=>({h:[],v:[]})},snapThreshold:{default:5},gridRatio:{default:1},lockLine:{type:Boolean,default:!1},selfHandle:{type:Boolean,default:!1},showShadowText:{type:Boolean,default:!0},panzoomOption:{}},emits:["onCornerClick","update:scale","zoomchange","update:lockLine"],setup(e,{expose:t,emit:n}){De(o=>({v4071069c:l.value}));const a=e,c=n,u=B(null),p=B(null),f=B(null),h=B(0),k=B(0);let E=0,C=0;const R=B(1),v=B(a.isShowReferLine),d=B(null),A=B("defaultCursor"),T=N(()=>({bgColor:"#f6f7f9",longfgColor:"#BABBBC",fontColor:"#7D8694",fontShadowColor:"#106ebe",shadowColor:"#e9f7fe",lineColor:"#51d6a9",lineType:"solid",lockLineColor:"#d4d7dc",hoverBg:"#000",hoverColor:"#fff",borderColor:"#eeeeef",...a.palette})),y=N(()=>({backgroundImage:v.value?`url(${a.eyeIcon??Je})`:`url(${a.closeEyeIcon??_e})`,width:a.thick+"px",height:a.thick+"px",borderRight:`1px solid ${T.value.borderColor}`,borderBottom:`1px solid ${T.value.borderColor}`})),w=N(()=>({background:T.value.bgColor,width:x.value+"px",height:L.value+"px"})),x=N(()=>a.width-a.thick),L=N(()=>a.height-a.thick),X=o=>{var i;(o.ctrlKey||o.metaKey)&&(o.preventDefault(),(i=d.value)==null||i.zoomWithWheel(o))},z=o=>{var i;const r=document.activeElement;r!=null&&r.closest(".monaco-editor")||(r==null?void 0:r.tagName)==="INPUT"||(r==null?void 0:r.tagName)==="TEXTAREA"||(r==null?void 0:r.getAttribute("contenteditable"))==="true"||o.key===" "&&(A.value="grabCursor",(i=d.value)==null||i.bind(),o.preventDefault())},g=o=>{var i;const r=document.activeElement;r!=null&&r.closest(".monaco-editor")||(r==null?void 0:r.tagName)==="INPUT"||(r==null?void 0:r.tagName)==="TEXTAREA"||(r==null?void 0:r.getAttribute("contenteditable"))==="true"||o.key===" "&&((i=d.value)==null||i.destroy(),A.value="defaultCursor")};function M(o){var i;o.preventDefault(),o.stopPropagation(),(i=d.value)==null||i.bind()}Ce(()=>{if(I(),!a.selfHandle&&u.value){const o=u.value.parentElement;if(!o)return;p.value=o,o.addEventListener("wheel",X,{passive:!1}),document.addEventListener("keydown",z),document.addEventListener("keyup",g),o.addEventListener("touchstart",M,{passive:!1})}}),Oe(()=>{var o;p.value&&(p.value.removeEventListener("wheel",X),p.value.removeEventListener("touchstart",M)),document.removeEventListener("keydown",z),document.removeEventListener("keyup",g),f.value&&f.value.removeEventListener("panzoomchange",Y),(o=d.value)==null||o.destroy()});const S=o=>({noBind:!0,startScale:o,startX:E,startY:C,smoothScroll:!0,canvas:!0,...a.panzoomOption}),Y=o=>{const{scale:i,dimsOut:r}=o.detail;if(r){c("update:scale",i),R.value=i;const s=(r.parent.left-r.elem.left)/i,b=(r.parent.top-r.elem.top)/i;h.value=s,c("zoomchange",o.detail),k.value=b}},I=()=>{var o;if(f.value&&f.value.removeEventListener("panzoomchange",Y),(o=d.value)==null||o.destroy(),u.value=document.querySelector(".canvasedit"),u.value){let i=a.scale;a.autoCenter&&(i=P()),d.value=Ue(u.value,S(i)),u.value.addEventListener("panzoomchange",Y),f.value=u.value}},P=()=>{const o=x.value*(1-a.paddingRatio)/a.canvasWidth,i=L.value*(1-a.paddingRatio)/a.canvasHeight,r=Math.min(o,i);return E=x.value/2-a.canvasWidth/2,r<1?C=(a.canvasHeight*r/2-a.canvasHeight/2)/r-(a.canvasHeight*r-L.value)/r/2:r>1?C=(a.canvasHeight*r-a.canvasHeight)/2/r+(L.value-a.canvasHeight*r)/r/2:C=0,r},Q=()=>{var o;return(o=d.value)==null?void 0:o.reset()},$=()=>{var o;return(o=d.value)==null?void 0:o.zoomIn()},q=()=>{var o;return(o=d.value)==null?void 0:o.zoomOut()},ee=()=>{var o;(o=d.value)==null||o.setOptions(S(a.scale))},oe=()=>{v.value=!v.value,c("onCornerClick",v.value)},le=o=>{c("update:lockLine",o)},l=N(()=>a.thick+"px");return G([()=>a.isShowReferLine],()=>{v.value=a.isShowReferLine}),G([()=>a.canvasWidth,()=>a.canvasHeight,()=>a.width,()=>a.height],()=>{I()}),G(()=>a.panzoomOption,()=>{ee()},{deep:!0}),t({initPanzoom:I,panzoomInstance:d,reset:Q,zoomIn:$,zoomOut:q,cursorClass:A}),(o,i)=>(W(),D("div",ht,[Le(o.$slots,"btn",{reset:Q,zoomIn:$,zoomOut:q}),j("div",{class:be(["canvasedit-parent",A.value]),style:V(w.value)},[j("div",{class:be(["canvasedit",A.value])},[Le(o.$slots,"default")],2)],6),J(xe(Te,{style:V({marginLeft:e.thick+"px",width:x.value+"px"}),vertical:!1,width:e.width,height:e.thick,"is-show-refer-line":v.value,thick:e.thick,start:h.value,"start-other":k.value,lines:e.lines,"select-start":e.shadow.x,"snap-threshold":e.snapThreshold,"snaps-obj":e.snapsObj,"select-length":e.shadow.width,scale:R.value,palette:T.value,"canvas-width":e.canvasWidth,"show-shadow-text":e.showShadowText,"canvas-height":e.canvasHeight,rate:e.rate,"grid-ratio":e.gridRatio,"lock-line":e.lockLine,onChangeLineState:le},null,8,["style","width","height","is-show-refer-line","thick","start","start-other","lines","select-start","snap-threshold","snaps-obj","select-length","scale","palette","canvas-width","show-shadow-text","canvas-height","rate","grid-ratio","lock-line"]),[[_,e.showRuler]]),J(xe(Te,{style:V({marginTop:e.thick+"px",top:0,height:L.value+"px"}),vertical:!0,width:e.thick,height:e.height,"is-show-refer-line":v.value,thick:e.thick,start:k.value,"start-other":h.value,lines:e.lines,"select-start":e.shadow.y,"select-length":e.shadow.height,"snap-threshold":e.snapThreshold,"snaps-obj":e.snapsObj,scale:R.value,palette:T.value,"canvas-width":e.canvasWidth,"canvas-height":e.canvasHeight,"show-shadow-text":e.showShadowText,rate:e.rate,"grid-ratio":e.gridRatio,"lock-line":e.lockLine,onChangeLineState:le},null,8,["style","width","height","is-show-refer-line","thick","start","start-other","lines","select-start","select-length","snap-threshold","snaps-obj","scale","palette","canvas-width","canvas-height","show-shadow-text","rate","grid-ratio","lock-line"]),[[_,e.showRuler]]),J(j("a",{class:"corner",style:V(y.value),onClick:oe},null,4),[[_,e.showRuler]])]))}});export{vt as v};
