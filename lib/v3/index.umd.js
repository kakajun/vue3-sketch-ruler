(function(v,o){typeof exports=="object"&&typeof module!="undefined"?o(exports,require("vue-demi"),require("vue")):typeof define=="function"&&define.amd?define(["exports","vue-demi","vue"],o):(v=typeof globalThis!="undefined"?globalThis:v||self,o(v.SketchRuler={},v.vueDemi,v.vue))})(this,function(v,o,t){"use strict";var ae=Object.defineProperty;var U=Object.getOwnPropertySymbols;var re=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var I=(v,o,t)=>o in v?ae(v,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):v[o]=t,X=(v,o)=>{for(var t in o||(o={}))re.call(o,t)&&I(v,t,o[t]);if(U)for(var t of U(o))le.call(o,t)&&I(v,t,o[t]);return v};/*!vue3-sketch-ruler v1.3.42022年6月Wed Jun 15 2022 19:56:14 GMT+0800 (中国标准时间)制作*/var ie=(()=>`.line[data-v-074b3d94]{pointer-events:auto;position:absolute}.line .action[data-v-074b3d94]{position:absolute;display:flex;justify-content:center;align-items:center}.line .value[data-v-074b3d94]{pointer-events:none;transform:scale(.83)}.line .del[data-v-074b3d94]{padding:3px 5px;cursor:pointer;visibility:hidden}.line:hover .del[data-v-074b3d94]{visibility:visible}
`)(),S=(e,n)=>{const i=e.__vccOpts||e;for(const[c,u]of n)i[c]=u;return i};const z=o.defineComponent({name:"LineRuler",props:{scale:Number,thick:Number,palette:Object,index:Number,start:Number,vertical:Boolean,value:Number,isShowReferLine:Boolean},emits:["onMouseDown","onRelease","onRemove"],setup(e,{emit:n}){const i=o.ref(0),c=o.ref(!0);o.onMounted(()=>{i.value=e.value});const u=r=>{c.value=r>=0},h=o.computed(()=>{const r=(i.value-e.start)*e.scale;u(r);const s=r+"px";return e.vertical?{top:s}:{left:s}}),l=o.computed(()=>{var p;const r=`1px solid ${(p=e.palette)==null?void 0:p.lineColor}`,s=e.vertical?{borderTop:r}:{borderLeft:r},m=e.isShowReferLine?e.vertical?"ns-resize":"ew-resize":"none";return X({cursor:m},s)}),d=o.computed(()=>e.vertical?{left:e.thick+"px"}:{top:e.thick+"px"});return{startValue:i,showLine:c,offset:h,borderCursor:l,actionStyle:d,handleDown:r=>{const s=e.vertical?r.clientY:r.clientX,m=i.value;n("onMouseDown");const p=y=>{const w=e.vertical?y.clientY:y.clientX,R=Math.round(m+(w-s)/e.scale);i.value=R},A=()=>{n("onRelease",i.value,e.index),document.removeEventListener("mousemove",p),document.removeEventListener("mouseup",A)};document.addEventListener("mousemove",p),document.addEventListener("mouseup",A)},handleRemove:()=>{n("onRemove",e.index)}}}}),T={class:"value"};function $(e,n,i,c,u,h){return t.withDirectives((t.openBlock(),t.createElementBlock("div",{class:"line",style:t.normalizeStyle([e.offset,e.borderCursor]),onMousedown:n[1]||(n[1]=(...l)=>e.handleDown&&e.handleDown(...l))},[t.createElementVNode("div",{class:"action",style:t.normalizeStyle(e.actionStyle)},[t.createElementVNode("span",{class:"del",onClick:n[0]||(n[0]=(...l)=>e.handleRemove&&e.handleRemove(...l))},"\xD7"),t.createElementVNode("span",T,t.toDisplayString(e.startValue),1)],4)],36)),[[t.vShow,e.showLine]])}var F=S(z,[["render",$],["__scopeId","data-v-074b3d94"]]);const M=e=>e<=.25?40:e<=.5?20:e<=1?10:e<=2?5:e<=4?2:1,k=.83,Q=(e,n,i,c,u,h)=>{const{scale:l,width:d,height:f,ratio:a,palette:r}=u,{bgColor:s,fontColor:m,shadowColor:p,longfgColor:A,shortfgColor:y}=r;if(e.scale(a,a),e.clearRect(0,0,d,f),e.fillStyle=s,e.fillRect(0,0,d,f),c){const C=(i-n)*l,b=c*l;e.fillStyle=p,h?e.fillRect(C,0,b,f*3/8):e.fillRect(0,C,d*3/8,b)}const w=M(l),R=w*l,N=w*10,E=N*l,L=Math.floor(n/w)*w,O=Math.floor(n/N)*N,ne=(L-n)/w*R,oe=(O-n)/N*E,V=n+Math.ceil((h?d:f)/l);e.beginPath(),e.fillStyle=m,e.strokeStyle=A;for(let C=O,b=0;C<V;C+=N,b++){const g=oe+b*E+.5;h?e.moveTo(g,0):e.moveTo(0,g),e.save(),h?e.translate(g,f*.4):e.translate(d*.4,g),h||e.rotate(-Math.PI/2),e.scale(k/a,k/a),e.fillText(C.toString(),4*a,7*a),e.restore(),h?e.lineTo(g,f*9/16):e.lineTo(d*9/16,g)}e.stroke(),e.closePath(),e.beginPath(),e.strokeStyle=y;for(let C=L,b=0;C<V;C+=w,b++){const g=ne+b*R+.5;h?e.moveTo(g,0):e.moveTo(0,g),C%N!==0&&(h?e.lineTo(g,f*1/4):e.lineTo(d*1/4,g))}e.stroke(),e.closePath(),e.setTransform(1,0,0,1,0,0)},K=o.defineComponent({name:"CanvasRuler",props:{showIndicator:Boolean,valueNum:Number,scale:Number,ratio:Number,palette:Object,vertical:Boolean,start:Number,width:Number,height:Number,selectStart:Number,selectLength:Number},emits:["onAddLine","update:showIndicator","update:valueNum"],setup(e,{emit:n}){const i=o.reactive({canvasContext:null});let c=1;const u=o.ref(null);o.onMounted(()=>{c=e.ratio||window.devicePixelRatio||1,h(),l(c),d(c)});const h=()=>{i.canvasContext=u.value&&u.value.getContext("2d")},l=a=>{if(u.value){u.value.width=e.width*a,u.value.height=e.height*a;const r=i.canvasContext;r&&(r.font=`${12*a}px -apple-system,
                "Helvetica Neue", ".SFNSText-Regular",
                "SF UI Text", Arial, "PingFang SC", "Hiragino Sans GB",
                "Microsoft YaHei", "WenQuanYi Zen Hei", sans-serif`,r.lineWidth=1,r.textBaseline="middle")}},d=a=>{const r={scale:e.scale,width:e.width,height:e.height,palette:e.palette,ratio:a};i.canvasContext&&Q(i.canvasContext,e.start,e.selectStart,e.selectLength,r,!e.vertical)};return o.watch(()=>e.start,()=>d(c)),o.watch([()=>e.width,()=>e.height],()=>{l(c),d(c)}),{handle:(a,r)=>{const s=(A,y,w)=>Math.round(y+A/w),m=e.vertical?a.offsetY:a.offsetX,p=s(m,e.start,e.scale);switch(r){case"click":n("onAddLine",p);break;case"enter":n("update:valueNum",p),n("update:showIndicator",!0);break;default:n("update:valueNum",p);break}},canvas:u}}});function Y(e,n,i,c,u,h){return t.openBlock(),t.createElementBlock("canvas",{ref:"canvas",class:"ruler",onClick:n[0]||(n[0]=l=>e.handle(l,"click")),onMouseenter:n[1]||(n[1]=l=>e.handle(l,"enter")),onMousemove:n[2]||(n[2]=l=>e.handle(l,"move")),onMouseleave:n[3]||(n[3]=l=>e.$emit("update:showIndicator",!1))},null,544)}var P=S(K,[["render",Y]]);const q={scale:Number,ratio:Number,thick:Number,palette:Object,vertical:{type:Boolean,default:!0},width:{type:Number,default:200},height:{type:Number,default:200},start:{type:Number,default:0},lines:{type:Array,default:()=>[]},selectStart:{type:Number},selectLength:{type:Number},isShowReferLine:{type:Boolean}};var se=(()=>`.line[data-v-5cc064d4],.h-container[data-v-5cc064d4],.v-container[data-v-5cc064d4]{position:absolute}.h-container .lines[data-v-5cc064d4],.v-container .lines[data-v-5cc064d4]{pointer-events:none}.h-container:hover .lines[data-v-5cc064d4],.v-container:hover .lines[data-v-5cc064d4]{pointer-events:auto}.h-container[data-v-5cc064d4]{top:0}.h-container .line[data-v-5cc064d4]{top:0;height:100vh;padding-left:5px}.h-container .line .action[data-v-5cc064d4]{transform:translate(-24px)}.h-container .line .action .value[data-v-5cc064d4]{margin-left:4px}.h-container .indicator[data-v-5cc064d4]{top:0;height:100vw}.h-container .indicator .value[data-v-5cc064d4]{width:auto;padding:0 2px;margin-top:4px;margin-left:4px}.v-container[data-v-5cc064d4]{left:0}.v-container .line[data-v-5cc064d4]{left:0;width:100vw;padding-top:5px}.v-container .line .action[data-v-5cc064d4]{transform:translateY(-24px);flex-direction:column}.v-container .line .action .value[data-v-5cc064d4]{margin-top:4px}.v-container .indicator[data-v-5cc064d4]{width:100vw}.v-container .indicator .value[data-v-5cc064d4]{left:0;width:auto;padding:0 2px;margin-top:-5px;margin-left:2px;transform:rotate(-90deg);transform-origin:0 0}
`)();const G=o.defineComponent({name:"RulerWrapper",components:{CanvasRuler:P,RulerLine:F},props:q,setup(e){const n=o.ref(!1),i=o.ref(0),c=o.computed(()=>e.vertical?"v-container":"h-container"),u=o.computed(()=>{const a={width:`calc(100% - ${e.thick}px)`,height:`${e.thick+1}px`,left:`${e.thick}px`},r={width:`${e.thick&&e.thick+1}px`,height:`calc(100% - ${e.thick}px)`,top:`${e.thick}px`};return e.vertical?r:a}),h=o.computed(()=>{var m;const a=(i.value-e.start)*e.scale;let r="top",s="borderLeft";return r=e.vertical?"top":"left",s=e.vertical?"borderBottom":"borderLeft",{[r]:a+"px",[s]:`1px solid ${(m=e.palette)==null?void 0:m.lineColor}`}}),l=a=>{e.lines.push(a)},d=(a,r)=>{const s=a-e.start,m=(e.vertical?e.height:e.width)/e.scale;s<0||s>m?f(r):e.lines[r]=a},f=a=>{e.lines.splice(a,1)};return{showIndicator:n,valueNum:i,rwClassName:c,rwStyle:u,indicatorStyle:h,handleNewLine:l,handleLineRelease:d,handleLineRemove:f}}}),H={class:"lines"},W={class:"value"};function Z(e,n,i,c,u,h){const l=t.resolveComponent("CanvasRuler"),d=t.resolveComponent("RulerLine");return t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(e.rwClassName),style:t.normalizeStyle(e.rwStyle)},[t.createVNode(l,{vertical:e.vertical,scale:e.scale,width:e.width,height:e.height,start:e.start,ratio:e.ratio,"select-start":e.selectStart,"select-length":e.selectLength,palette:e.palette,valueNum:e.valueNum,"onUpdate:valueNum":n[0]||(n[0]=f=>e.valueNum=f),showIndicator:e.showIndicator,"onUpdate:showIndicator":n[1]||(n[1]=f=>e.showIndicator=f),onOnAddLine:e.handleNewLine},null,8,["vertical","scale","width","height","start","ratio","select-start","select-length","palette","valueNum","showIndicator","onOnAddLine"]),t.withDirectives(t.createElementVNode("div",H,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.lines,(f,a)=>(t.openBlock(),t.createBlock(d,{key:f+a,index:a,value:f>>0,scale:e.scale,start:e.start,thick:e.thick,palette:e.palette,vertical:e.vertical,"is-show-refer-line":e.isShowReferLine,onOnRemove:e.handleLineRemove,onOnRelease:e.handleLineRelease},null,8,["index","value","scale","start","thick","palette","vertical","is-show-refer-line","onOnRemove","onOnRelease"]))),128))],512),[[t.vShow,e.isShowReferLine]]),t.withDirectives(t.createElementVNode("div",{class:"indicator",style:t.normalizeStyle(e.indicatorStyle)},[t.createElementVNode("div",W,t.toDisplayString(e.valueNum),1)],4),[[t.vShow,e.showIndicator]])],6)}var D=S(G,[["render",Z],["__scopeId","data-v-5cc064d4"]]);const j="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAopJREFUOE/FlE9IVEEcx7+/N9ouds1Mu0QUSFZYdIgoUqQoKPBQHsKozpXE7jbTO/U8xLJvn6usBHWQ6hBFXupSkQeVbh0KJEPp0sH+eLGTsKs77xcj78m0ax0E8cHjzZv5zef3/c33xxA24KENYGJzoEEQbNNaN4Zh2OQ4znwYhr9c1/39vwrXVDo0NNS0tLR0GYB5D64BmAMwzMyvlFKz1es10Hw+f4mZ7wHYBeA9gNdENFepVOaEEM3M3OI4Thczn41gt6WUgQ3+C+r7/h0AWQD3mXnYqPA8L9nQ0HCemduIaFpKOWoAhUJhT6VSuQXgOjP3K6W8GLwKzeVyp4jonR0QBEErM48w8zFLyayUsjX+z+VyHhHdZebTSqkxM78CHRgYOKS1/ghgVErZY214RkQ7ADyRUj72ff8qgCtmXUrZGcf5vv8CwEUhxOF0Ov1pBRpla5dSdseBhUJhpznH6tIsZb1KqacW+BGArUaUXX63UuplHJTNZjuEEONSyhozfd/n6mQ1RkXZL2itz7mu+80EDA4ONi8vL/8AcM2UbikyR2BU9cSmmTU70YqKIAj2hWFo2uenlHK/BRg3Y2aeNO5GyU8S0ZbFxcUuz/NKEXAGQKPjOCcymcyX1dIi8DSAiWQyeaavr68cbSgCuBknYubnQoj+TCYzUywWE6VS6S2ADsdx2gxw1X3L7SNENMbMnwE8qK+vf5NKpRaMaeVyeW8ikfiaSqW+R7BuZr5BRMe11p2u607U9Gk8kc/ntzPzQwCmExYATDLzVBiGE0KIowAOADDf3QA+aK2VDaxRajto3K+rq+tl5nYAzQBamHmeiOYBTGmtR6ph/1Rqg9c73pz7dD1qN0TpHyNQRCUDJXrAAAAAAElFTkSuQmCC",J="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAjtJREFUOE/NlD9oFEEUxn9v9ghC0hpRUogIAUmniGAT/5Q2FrETPSNRJILg7RwimI0ox85eQFCEBGIUO1PYpFM0jSConQoBEZGgGPsgl+w+2eM2bC57SopAFqYZ3v7m+977ZoQt+GQLmGxPaBiGgYiMWWvXBHZUGoZhH3BERPYC+4F+4Keq/urt7b1RLpf/ZEBVHa9Wq0HWyg3QKIoGVPU8cA7wgK/pUtXPQJ8xZk+pVBpuNBqXUoUiEvi+P56fzTpo6+SbwHNg1lo7WzTITGEKXFlZeeB53tVCpa3CK8AFa+1cBgvD8LKIXAQOJkkyICJDeYVBEJS6u7s/qeoLa+1o+l9TqXNuBLhmjDlbqVQ+5ICjInIfOBPH8W9jzGCR5YmJiRNxHM+papgqzqDvgSlr7VTernPuO3An3c9bBt74vv+yrdaKyLDv+/1Sq9UGPc97nY9EVuycU2AQOA7cAm4Dr4D5TvVxHB9rKo2iaEFVp621Ln96FEUngaOqGmSxabVqsh3a2h+x1h5qQjNrae/yE4+iaCwDJkky73neTuBZe129Xk+H+BS4l7ZqLVIZ2BhzuFKpvMsDVXXWGPMxFdAedOfcKeCRqj7MYrUhpz09PfXl5eXrectFWXXODQHpOq2qd/95o/JXr6ura3J1dXU6SZIfwKKIHAD2tVYMPBGRx77vN10UXtO85fTkmZmZHUtLSzUR2QXsBhaAL6r6DXhbrVYXi1yss59GqOgub/bN3Z7v6X/tb9Zmp/q/kN8s+lJb8oEAAAAASUVORK5CYII=",x={eyeIcon:{type:String},closeEyeIcon:{type:String},scale:{type:Number,default:1},ratio:{type:Number},thick:{type:Number,default:16},palette:Object,startX:{type:Number},startY:{type:Number,default:0},width:{type:Number,default:200},height:{type:Number,default:200},shadow:{type:Object,default:()=>({x:0,y:0,width:0,height:0})},lines:{type:Object,default:()=>({h:[],v:[]})},cornerActive:{type:Boolean,default:!1},isShowReferLine:{type:Boolean,default:!0}};var ce=(()=>`@charset "UTF-8";.style-ruler{position:absolute;z-index:3;width:100%;height:100%;overflow:hidden;font-size:12px;pointer-events:none}.style-ruler span{line-height:1}.corner{position:absolute;top:0;left:0;pointer-events:auto;cursor:pointer;box-sizing:content-box;transition:all .2s ease-in-out}.indicator{position:absolute;pointer-events:none}.indicator .value{position:absolute;background:white}.ruler{width:100%;height:100%;pointer-events:auto}
`)();const _=o.defineComponent({name:"SketchRule",components:{RulerWrapper:D},props:x,emits:["onCornerClick","handleLine"],setup(e,{emit:n}){let i=o.ref(!0);i.value=e.isShowReferLine;const c=o.computed(()=>{function d(a,r){return Object.keys(a).forEach(s=>{s&&a.hasOwnProperty(s)&&(typeof r.key=="object"?a[s]=d(a[s],r[s]):r.hasOwnProperty(s)&&(a[s]=r[s]))}),a}return d({bgColor:"rgba(225,225,225, 0)",longfgColor:"#BABBBC",shortfgColor:"#C8CDD0",fontColor:"#7D8694",shadowColor:"#E8E8E8",lineColor:"#EB5648",borderColor:"#DADADC",cornerActiveColor:"rgb(235, 86, 72, 0.6)",menu:{bgColor:"#fff",dividerColor:"#DBDBDB",listItem:{textColor:"#415058",hoverTextColor:"#298DF8",disabledTextColor:"rgba(65, 80, 88, 0.4)",bgColor:"#fff",hoverBgColor:"#F2F2F2"}}},e.palette||{})}),u=o.computed(()=>e.cornerActive?" active":""),h=o.computed(()=>({backgroundImage:i.value?`url(${e.eyeIcon||j})`:`url(${e.closeEyeIcon||J})`,width:e.thick+"px",height:e.thick+"px",borderRight:`1px solid ${c.value.borderColor}`,borderBottom:`1px solid ${c.value.borderColor}`}));return{showReferLine:i,paletteCpu:c,cornerActiveClass:u,cornerStyle:h,onCornerClick:d=>{i.value=!i.value,n("onCornerClick",d)}}}}),ee={id:"mb-ruler",class:"style-ruler mb-ruler"};function te(e,n,i,c,u,h){const l=t.resolveComponent("RulerWrapper");return t.openBlock(),t.createElementBlock("div",ee,[t.createVNode(l,{vertical:!1,width:e.width,height:e.thick,"is-show-refer-line":e.showReferLine,thick:e.thick,ratio:e.ratio,start:e.startX,lines:e.lines.h,"select-start":e.shadow.x,"select-length":e.shadow.width,scale:e.scale,palette:e.paletteCpu},null,8,["width","height","is-show-refer-line","thick","ratio","start","lines","select-start","select-length","scale","palette"]),t.createVNode(l,{vertical:!0,width:e.thick,height:e.height,"is-show-refer-line":e.showReferLine,thick:e.thick,ratio:e.ratio,start:e.startY,lines:e.lines.v,"select-start":e.shadow.y,"select-length":e.shadow.height,scale:e.scale,palette:e.paletteCpu},null,8,["width","height","is-show-refer-line","thick","ratio","start","lines","select-start","select-length","scale","palette"]),t.createElementVNode("a",{class:t.normalizeClass(["corner",e.cornerActiveClass]),style:t.normalizeStyle(e.cornerStyle),onClick:n[0]||(n[0]=(...d)=>e.onCornerClick&&e.onCornerClick(...d))},null,6)])}var B=S(_,[["render",te]]);v.SketchRule=B,v.default=B,Object.defineProperties(v,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
